import{c as e,P as a,s as t,S as l}from"./index-ZxpkwSGJ.js";import{c as o}from"./chaoxing-system-clock-account-api-DCasCqQB.js";import{C as i,c as s}from"./chaoxing-system-clock-account-operate-modal-CXg7t-Ky.js";import{_ as n}from"./index-wy53HiSK.js";import c from"./clock-in-history-modal-CWtaZAUu.js";import{S as r,a5 as d,P as u,an as p,ao as m}from"./@ant-design-rHMPkvPq.js";import{M as y,b as g}from"./ant-design-vue-DFQN5xdf.js";import{r as k,a as f,e as h,b2 as v,z as x,b,o as w,c as _,bz as I,J as j,u as C,ai as z,y as S,ag as R,be as E,ah as P,F as T,h as F}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const U={class:"smart-table-operate-block"},D={class:"smart-table-setting-block"},N={key:1,class:"permanent"},O={key:2,class:"no-data"},M={class:"smart-query-table-page"},A={__name:"chaoxing-system-clock-account-list",setup(A){const B=k([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"账号",dataIndex:"account",align:"center",width:100,ellipsis:!0},{title:"密码",dataIndex:"password",align:"center",width:100,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:75,ellipsis:!0},{title:"地址",dataIndex:"address",align:"center",width:160,ellipsis:!0},{title:"剩余天数",dataIndex:"dayRemainingDays",align:"center",width:80},{title:"状态",dataIndex:"disabledFlag",align:"center",width:60},{title:"打卡结果",dataIndex:"clockInResult",align:"center",width:80},{title:"最后打卡时间",dataIndex:"lastClockInTime",width:150},{title:"创建人",dataIndex:"createUserName",align:"center",width:80},{title:"创建时间",dataIndex:"createTime",width:120},{title:"操作",dataIndex:"action",width:280}]),L={keywords:"",disabledFlag:void 0,clockInResult:void 0,pageNum:1,pageSize:e,searchCount:!0},V=f({...L}),$=k(!1),q=k([]),J=k(0);function K(){V.pageNum=1,H()}function Q(){Object.assign(V,L),H()}async function H(){try{$.value=!0;let e=await o.pageQuery(V);const a=e.data.list;J.value=e.data.total,a.forEach((e=>{e.lastClockInResult?"SUCCESS"===e.lastClockInResult?e.clockInResult="成功":"FAILED"===e.lastClockInResult?e.clockInResult="失败":e.clockInResult=e.lastClockInResult:e.clockInResult="未打卡"})),q.value=a}catch(e){t.captureError(e)}finally{$.value=!1}}function Y(e){y.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{l.show(),await o.delete(e),g.success("删除成功"),H()}catch(a){t.captureError(a)}finally{l.hide()}}(e)},cancelText:"取消",onCancel(){}})}const G=k();const W=k();async function X(e,a){const i={id:e.id,clockType:a};l.show();try{const e=await o.clockIn(i);e.ok?(g.success(e.data||("上班"===a?"签到":"签退")+"成功"),setTimeout((()=>{H()}),500)):g.error(e.msg||("上班"===a?"签到":"签退")+"失败")}catch(s){t.captureError(s)}finally{l.hide()}}const Z=k("获取中...");async function ee(){try{const e=await s.getCurrentPrice();if(e.ok&&e.data){const a=e.data.price??0,t=e.data.dayPrice??0;Z.value=`单天：${t} 元/天 | 单账号：${a} 元/账号`}else Z.value="未设置"}catch(e){Z.value="获取失败"}}async function ae(){try{const e=await s.getCurrentPrice();let a=0,t=0,l="";e.ok&&e.data&&(a=e.data.price||0,t=e.data.dayPrice||0,l=e.data.remark||"");const o="accountPriceInput",i="dayPriceInput",n="remarkInput";y.confirm({title:"设置单价",content:F("div",[F("div",{style:"margin-bottom: 12px;"},[F("span","单天单价（元/天）："),F("input",{id:i,type:"number",min:"0",step:"0.01",value:t,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单天单价"})]),F("div",{style:"margin-bottom: 12px;"},[F("span","单账号单价（元/账号）："),F("input",{id:o,type:"number",min:"0",step:"0.01",value:a,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单账号单价"})]),F("div",[F("span","备注："),F("input",{id:n,type:"text",value:l,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const e=document.getElementById(o),a=document.getElementById(i),t=document.getElementById(n),l=parseFloat(e?.value||0),c=parseFloat(a?.value||0),r=t?.value||"";!e?.value||l<0?g.error("单账号单价不能为空或负数"):!a?.value||c<0?g.error("单天单价不能为空或负数"):async function(e){try{const a=await s.updatePrice(e);a.ok?(g.success("单价设置成功"),ee()):g.error("单价设置失败："+(a.msg||"未知错误"))}catch(a){g.error("单价设置失败："+(a.response?.data?.msg||a.message))}}({accountPrice:l,dayPrice:c,remark:r})}})}catch(e){g.error("获取单价配置失败")}}return h((()=>{H(),ee()})),(e,t)=>{const l=v("a-input"),o=v("a-form-item"),s=v("a-select-option"),y=v("a-select"),g=v("a-button"),k=v("a-space"),f=v("a-form"),h=v("a-tag"),F=v("a-row"),A=v("a-table"),L=v("a-pagination"),ee=v("a-card"),te=x("privilege");return w(),b(T,null,[_(f,{class:"smart-query-form",layout:"inline"},{default:I((()=>[_(o,{label:"关键字"},{default:I((()=>[_(l,{style:{width:"200px"},value:V.keywords,"onUpdate:value":t[0]||(t[0]=e=>V.keywords=e),placeholder:"姓名/账号/地址","allow-clear":""},null,8,["value"])])),_:1}),_(o,{label:"状态"},{default:I((()=>[_(y,{style:{width:"120px"},value:V.disabledFlag,"onUpdate:value":t[1]||(t[1]=e=>V.disabledFlag=e),placeholder:"请选择状态","allow-clear":""},{default:I((()=>[_(s,{value:!1},{default:I((()=>[j("启用")])),_:1}),_(s,{value:!0},{default:I((()=>[j("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),_(o,{label:"打卡结果"},{default:I((()=>[_(y,{style:{width:"120px"},value:V.clockInResult,"onUpdate:value":t[2]||(t[2]=e=>V.clockInResult=e),placeholder:"请选择结果","allow-clear":""},{default:I((()=>[_(s,{value:"SUCCESS"},{default:I((()=>[j("成功")])),_:1}),_(s,{value:"FAILED"},{default:I((()=>[j("失败")])),_:1}),_(s,{value:"NOT_CLOCKED_IN"},{default:I((()=>[j("未打卡")])),_:1})])),_:1},8,["value"])])),_:1}),_(o,null,{default:I((()=>[_(k,null,{default:I((()=>[_(g,{type:"primary",onClick:K},{icon:I((()=>[_(C(r))])),default:I((()=>[j(" 查询 ")])),_:1}),_(g,{onClick:Q},{icon:I((()=>[_(C(d))])),default:I((()=>[j(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1}),_(ee,{size:"small",bordered:!1,hoverable:!0},{default:I((()=>[_(F,{class:"smart-table-btn-block"},{default:I((()=>[z("div",U,[z("div",null,[_(k,{wrap:""},{default:I((()=>[S((w(),R(g,{onClick:t[3]||(t[3]=e=>{G.value.showModal()}),type:"primary"},{icon:I((()=>[_(C(u))])),default:I((()=>[j(" 添加账号 ")])),_:1})),[[te,"oa:chaoxing-system-clock-account:add"]]),S((w(),R(g,{onClick:t[4]||(t[4]=e=>ae()),type:"default"},{icon:I((()=>[_(C(p))])),default:I((()=>[j(" 设置单价 ")])),_:1})),[[te,"oa:chaoxing-system-clock-account-price:update"]]),_(h,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:I((()=>[_(C(m))])),default:I((()=>[j(" 当前单价："+E(Z.value)+" 元 ",1)])),_:1})])),_:1})])]),z("div",D,[_(n,{modelValue:B.value,"onUpdate:modelValue":t[5]||(t[5]=e=>B.value=e),tableId:700,refresh:H},null,8,["modelValue"])])])),_:1}),_(A,{scroll:{x:1500},size:"small",dataSource:q.value,columns:B.value,rowKey:"id",pagination:!1,loading:$.value,bordered:""},{bodyCell:I((({column:e,record:a,text:t})=>{return["disabledFlag"===e.dataIndex?(w(),R(h,{key:0,color:t?"red":"green"},{default:I((()=>[j(E(t?"禁用":"启用"),1)])),_:2},1032,["color"])):P("",!0),"dayRemainingDays"===e.dataIndex?(w(),b(T,{key:1},["DAY"===a.billingMode?(w(),R(h,{key:0,color:(t||0)>0?"green":"red"},{default:I((()=>[j(E(t||0)+" 天",1)])),_:2},1032,["color"])):"ACCOUNT"===a.billingMode?(w(),b("span",N,"永久")):(w(),b("span",O,"--"))],64)):P("",!0),"clockInResult"===e.dataIndex?(w(),R(h,{key:2,color:(l=t,l?"成功"===l?"green":"失败"===l?"red":"":"")},{default:I((()=>[j(E(t),1)])),_:2},1032,["color"])):P("",!0),"action"===e.dataIndex?(w(),R(k,{key:3},{default:I((()=>[S((w(),R(g,{onClick:e=>{return t=a.id,void G.value.showModal(t);var t},size:"small",type:"link"},{default:I((()=>[j("编辑")])),_:2},1032,["onClick"])),[[te,"oa:chaoxing-system-clock-account:update"]]),S((w(),R(g,{onClick:e=>Y(a.id),size:"small",danger:"",type:"link"},{default:I((()=>[j("删除")])),_:2},1032,["onClick"])),[[te,"oa:chaoxing-system-clock-account:delete"]]),S((w(),R(g,{onClick:e=>X(a,"上班"),size:"small",type:"link"},{default:I((()=>[j("签到")])),_:2},1032,["onClick"])),[[te,"oa:chaoxing-system-clock-account:clockIn"]]),S((w(),R(g,{onClick:e=>X(a,"下班"),size:"small",type:"link"},{default:I((()=>[j("签退")])),_:2},1032,["onClick"])),[[te,"oa:chaoxing-system-clock-account:clockIn"]]),S((w(),R(g,{onClick:e=>function(e){W.value.showModal(e)}(a),size:"small",type:"link"},{default:I((()=>[j("打卡历史")])),_:2},1032,["onClick"])),[[te,"oa:chaoxing-system-clock-account:detail"]])])),_:2},1024)):P("",!0)];var l})),_:1},8,["dataSource","columns","loading"]),z("div",M,[_(L,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:C(a),defaultPageSize:V.pageSize,current:V.pageNum,"onUpdate:current":t[6]||(t[6]=e=>V.pageNum=e),pageSize:V.pageSize,"onUpdate:pageSize":t[7]||(t[7]=e=>V.pageSize=e),total:J.value,onChange:H,onShowSizeChange:H,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),_(i,{ref_key:"operateRef",ref:G,onRefresh:H},null,512)])),_:1}),_(c,{ref_key:"clockInHistoryModalRef",ref:W},null,512)],64)}}};export{A as default};
