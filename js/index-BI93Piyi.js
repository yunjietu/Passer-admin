import{r as e}from"./regular-const-BsnQI0fZ.js";import{_ as a}from"./index-YdqzJmk0.js";import l from"./index-DPBcXeae.js";import{_ as t,z as i,F as r,h as s,A as o,s as n,i as u,S as d}from"./index-ZxpkwSGJ.js";import{b as m}from"./ant-design-vue-DFQN5xdf.js";import{r as c,a as v,e as p,l as f,b2 as g,b,o as y,ai as h,c as j,bz as w,u as _,J as E,ag as x,be as I,aY as C,aW as N}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./department-api-BBQ_I4Vj.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const U=e=>(C("data-v-1e069bf2"),e=e(),N(),e),k={class:"center-container"},F=U((()=>h("div",{class:"header-title"},"个人中心 ",-1))),M={class:"center-form-area"},q={class:"email-input-wrapper"},z={class:"avatar-wrapper"},O={key:0,class:"avatar-container"},$=["src"],A=U((()=>h("div",{class:"overlay"},[h("span",null,"更新头像")],-1))),L={key:1},R=U((()=>h("div",{class:"ant-upload-text"},"上传头像",-1))),D=t({__name:"index",setup(t){const C=c(),N=c();i();const U=c(!1),D=c(!1),B=c(!1),S=c(!1),T=c("获取验证码");let G=null;const J=v({newEmail:"",verificationCode:""}),K={newEmail:[{required:!0,message:"请输入新邮箱地址",trigger:"blur"},{pattern:e.email,message:"请输入正确的邮箱格式",trigger:"blur"}],verificationCode:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"验证码长度为4-6位",trigger:"blur"}]};let W=v({...{employeeId:void 0,avatar:void 0,loginName:"",actualName:"",gender:void 0,phone:"",departmentId:void 0,email:void 0,disabledFlag:void 0}});const Y={actualName:[{required:!0,message:"姓名不能为空"},{max:30,message:"姓名不能大于30个字符",trigger:"blur"}],phone:[{required:!0,message:"手机号不能为空"},{pattern:e.phone,message:"请输入正确的手机号码",trigger:"blur"}],gender:[{required:!0,message:"性别不能为空"}]};let H=c();const P=c("--"),Q=i().employeeId;async function V(){try{let e=(await o.getLoginInfo()).data;i().setUserLoginInfo(e),W.employeeId=e.employeeId,W.loginName=e.loginName,W.actualName=e.actualName,W.gender=e.gender,W.phone=e.phone,W.departmentId=e.departmentId,W.email=e.email,W.disabledFlag=e.disabledFlag,H.value=e.avatar}catch(e){n.captureError(e)}}Q&&s.getBalance(Q).then((e=>{P.value=e.data?.balance??"--"}));const X=c(".jpg,.jpeg,.png,.gif"),Z=c(10),ee=c(r.COMMON.value);let ae=c(!1);function le(e,a){const l=e.name.lastIndexOf("."),t=e.name.substring(l<=-1?0:l);if(-1===X.value.indexOf(t))return m.error(`只支持上传 ${X.value.replaceAll(","," ")} 格式的文件`),!1;return!!(e.size/1024/1024<Z.value)||(m.error(`单个文件大小必须小于 ${Z.value} Mb`),!1)}async function te(e){ae.value=!0;try{const a=new FormData;a.append("file",e.file);let l=(await u.uploadFile(a,ee.value)).data;H.value=l.fileUrl;let t={avatar:l.fileKey};await s.updateAvatar(t),m.success("更新成功"),await V()}catch(a){n.captureError(a)}finally{ae.value=!1}}function ie(){U.value=!0,J.newEmail="",J.verificationCode="",N.value&&N.value.resetFields(),S.value=!1,T.value="获取验证码",G&&(clearInterval(G),G=null)}function re(){U.value=!1,J.newEmail="",J.verificationCode="",N.value&&N.value.resetFields()}async function se(){if(!J.newEmail)return void m.warning("请先输入新邮箱地址");if(e.email.test(J.newEmail))try{B.value=!0,await s.sendUpdateEmailCode(J.newEmail),m.success("验证码已发送，请查收邮件"),function(){S.value=!0;let e=60;T.value=`${e}秒后重新获取`,G=setInterval((()=>{e>1?(e--,T.value=`${e}秒后重新获取`):(clearInterval(G),G=null,S.value=!1,T.value="获取验证码")}),1e3)}()}catch(a){n.captureError(a)}finally{B.value=!1}else m.warning("请输入正确的邮箱格式")}async function oe(){try{await N.value.validate(),D.value=!0,await s.updateEmail({newEmail:J.newEmail,verificationCode:J.verificationCode}),m.success("邮箱修改成功"),U.value=!1,await V()}catch(e){if(e.errorFields)return;n.captureError(e)}finally{D.value=!1}}function ne(){C.value.validate().then((()=>{!async function(){d.show();try{const{email:e,...a}=W;await s.updateCenter(a),m.success("更新成功"),await V()}catch(e){n.captureError(e)}finally{d.hide()}}()})).catch((e=>{m.error("参数验证错误，请仔细填写表单数据!")}))}return p((()=>{V()})),f((()=>{G&&(clearInterval(G),G=null)})),(e,t)=>{const r=g("a-input"),s=g("a-form-item"),o=g("a-button"),n=g("a-form"),u=g("a-col"),d=g("loading-outlined"),m=g("plus-outlined"),c=g("a-upload"),v=g("a-row"),p=g("a-input-group"),f=g("a-modal");return y(),b("div",k,[F,h("div",M,[j(v,{gutter:[16,16],class:"form-row"},{default:w((()=>[j(u,{xs:24,sm:24,md:16,lg:16,xl:16,class:"form-col"},{default:w((()=>[j(n,{ref_key:"formRef",ref:C,model:_(W),rules:Y,layout:"vertical"},{default:w((()=>[j(s,{label:"登录账号",name:"loginName"},{default:w((()=>[j(r,{class:"form-item",value:_(W).loginName,"onUpdate:value":t[0]||(t[0]=e=>_(W).loginName=e),valueModifiers:{trim:!0},placeholder:"请输入登录账号",disabled:""},null,8,["value"])])),_:1}),j(s,{label:"余额",name:"balance"},{default:w((()=>[j(r,{class:"form-item",value:`￥${P.value}`,disabled:""},null,8,["value"])])),_:1}),j(s,{label:"部门",name:"departmentId"},{default:w((()=>[j(a,{class:"form-item",ref:"departmentTreeSelect",width:"100%",init:!1,value:_(W).departmentId,"onUpdate:value":t[1]||(t[1]=e=>_(W).departmentId=e),disabled:""},null,8,["value"])])),_:1}),j(s,{label:"员工名称",name:"actualName"},{default:w((()=>[j(r,{class:"form-item",value:_(W).actualName,"onUpdate:value":t[2]||(t[2]=e=>_(W).actualName=e),valueModifiers:{trim:!0},placeholder:"请输入员工名称"},null,8,["value"])])),_:1}),j(s,{label:"性别",name:"gender"},{default:w((()=>[j(l,{class:"form-item",value:_(W).gender,"onUpdate:value":t[3]||(t[3]=e=>_(W).gender=e),placeholder:"请选择性别","enum-name":"GENDER_ENUM"},null,8,["value"])])),_:1}),j(s,{label:"手机号码",name:"phone"},{default:w((()=>[j(r,{class:"form-item",value:_(W).phone,"onUpdate:value":t[4]||(t[4]=e=>_(W).phone=e),valueModifiers:{trim:!0},placeholder:"请输入手机号码"},null,8,["value"])])),_:1}),j(s,{label:"邮箱",name:"email"},{default:w((()=>[h("div",q,[j(r,{value:_(W).email,"onUpdate:value":t[5]||(t[5]=e=>_(W).email=e),valueModifiers:{trim:!0},placeholder:"请输入邮箱",disabled:"",class:"email-input-disabled"},null,8,["value"]),j(o,{type:"default",onClick:ie,class:"email-edit-btn"},{default:w((()=>[E("修改")])),_:1})])])),_:1})])),_:1},8,["model"]),j(o,{type:"primary",onClick:ne},{default:w((()=>[E("更新个人信息")])),_:1})])),_:1}),j(u,{xs:24,sm:24,md:8,lg:8,xl:8,class:"avatar-col"},{default:w((()=>[j(n,{layout:"vertical",class:"mobile-avatar"},{default:w((()=>[j(s,{name:"avatar"},{default:w((()=>[h("div",z,[j(c,{name:"avatar","list-type":"picture-card",class:"avatar-uploader","show-upload-list":!1,headers:{Authorization:"Bearer "+_(i)().getToken},customRequest:te,"before-upload":le},{default:w((()=>[_(H)?(y(),b("div",O,[h("img",{src:_(H),class:"avatar-image",alt:"avatar"},null,8,$),A])):(y(),b("div",L,[_(ae)?(y(),x(d,{key:0})):(y(),x(m,{key:1})),R]))])),_:1},8,["headers"])])])),_:1})])),_:1})])),_:1})])),_:1})]),j(f,{open:U.value,"onUpdate:open":t[8]||(t[8]=e=>U.value=e),title:"修改邮箱",width:500,onOk:oe,onCancel:re,confirmLoading:D.value},{default:w((()=>[j(n,{ref_key:"updateEmailFormRef",ref:N,model:J,rules:K,layout:"vertical"},{default:w((()=>[j(s,{label:"新邮箱",name:"newEmail"},{default:w((()=>[j(r,{value:J.newEmail,"onUpdate:value":t[6]||(t[6]=e=>J.newEmail=e),valueModifiers:{trim:!0},placeholder:"请输入新邮箱地址",maxlength:100},null,8,["value"])])),_:1}),j(s,{label:"验证码",name:"verificationCode"},{default:w((()=>[j(p,{compact:""},{default:w((()=>[j(r,{value:J.verificationCode,"onUpdate:value":t[7]||(t[7]=e=>J.verificationCode=e),valueModifiers:{trim:!0},placeholder:"请输入验证码",maxlength:6,style:{width:"calc(100% - 120px)"}},null,8,["value"]),j(o,{type:"primary",onClick:se,disabled:S.value||!J.newEmail,loading:B.value,style:{width:"120px"}},{default:w((()=>[E(I(T.value),1)])),_:1},8,["disabled","loading"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["open","confirmLoading"])])}}},[["__scopeId","data-v-1e069bf2"]]);export{D as default};
