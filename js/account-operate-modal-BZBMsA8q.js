import{a as e}from"./account-api-Ia2S-UTU.js";import{s as t,S as a}from"./index-ZxpkwSGJ.js";import{b as o}from"./ant-design-vue-DFQN5xdf.js";import{r as s,a as r,n,m as i,b2 as l,ag as d,o as p,bz as c,c as m,u,ai as h,b as y,ah as f,J as v}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const g={style:{"margin-bottom":"12px"}},b=h("span",{style:{"font-weight":"500"}},"日报开关",-1),j=h("span",{style:{color:"#666","font-size":"12px","margin-left":"8px"}},"每天下午6点自动提交日报",-1),w={style:{"margin-bottom":"12px"}},x=h("span",{style:{"font-weight":"500"}},"周报开关",-1),k=h("span",{style:{color:"#666","font-size":"12px","margin-left":"8px"}},"每周五晚上7点自动提交周报",-1),E={style:{"margin-bottom":"12px"}},R=h("span",{style:{"font-weight":"500"}},"月报开关",-1),_=h("span",{style:{color:"#666","font-size":"12px","margin-left":"8px"}},"每月15号晚上8点自动提交月报",-1),I={key:0,style:{"margin-top":"12px","padding-top":"12px","border-top":"1px solid #e8e8e8"}},U=h("div",{style:{"margin-bottom":"8px"}},[h("span",{style:{"font-weight":"500"}},"报告天数限制")],-1),z=h("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}},[v(" 设置报告提交的天数限制，到期后自动关闭所有报告开关"),h("br"),v(" 范围：1-365天，默认180天 ")],-1),C={__name:"account-operate-modal",emits:["refresh"],setup(v,{expose:C,emit:D}){C({showModal:function(o){Object.assign(O,S),o?async function(o){try{let t=(await e.detail(o)).data;Object.assign(O,t),J.value=!t.disabledFlag}catch(s){t.captureError(s)}finally{a.hide()}}(o):J.value=!0;A.value=!0,n((()=>{const e=document.getElementsByClassName("ant-modal");e&&e.length>0&&Array.from(e).forEach((e=>{e.childNodes&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((e=>{e.setAttribute&&e.setAttribute("aria-hidden","false")}))}))}))}});const L=D,A=s(!1);function F(){A.value=!1}const N=s(),S={id:void 0,account:void 0,password:void 0,school:void 0,major:void 0,contractEnterprise:void 0,internshipStatus:void 0,disabledFlag:!1,dailyReportEnabled:!1,weeklyReportEnabled:!1,monthlyReportEnabled:!1,reportDaysLimit:180,token:void 0,deviceId:void 0};let O=r({...S});const q={account:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}]};function B(){N.value.validate().then((async()=>{a.show();try{O.id||await async function(){if(!O.account||!O.password)throw new Error("请先输入账号和密码");try{const a=await e.getZhixiaoUserInfo({account:O.account,password:O.password});if(a.data){const{uid:s,token:r,deviceId:n,uname:i,schoolname:l,major:d}=a.data;O.token=r,O.deviceId=n,O.userId=s,O.name=i,O.school=l,O.major=d;try{const t=await e.getInternshipInfo({uid:s,token:r,deviceId:n});t.data&&(O.contractEnterprise=t.data.contractEnterprise,O.internshipStatus=t.data.internshipStatus)}catch(t){}o.success("已自动获取并填充个人信息和实习信息")}}catch(a){throw new Error(a?.data?.msg||"获取信息失败")}}(),O.id?await e.update(O):await e.create(O),o.success((O.id?"修改":"添加")+"成功"),F(),L("refresh")}catch(s){t.captureError(s)}finally{a.hide()}})).catch((e=>{}))}const J=s(!0);function M(e){O.disabledFlag=!e}const Z=i((()=>O.dailyReportEnabled||O.weeklyReportEnabled||O.monthlyReportEnabled));function G(){Z.value?O.reportDaysLimit||(O.reportDaysLimit=180):O.reportDaysLimit=null}return(e,t)=>{const a=l("a-input"),o=l("a-form-item"),s=l("a-input-password"),r=l("a-switch"),n=l("a-input-number"),i=l("a-form"),v=l("a-modal");return p(),d(v,{open:A.value,title:u(O).id?"编辑":"添加",width:700,forceRender:"","ok-text":"确认","cancel-text":"取消",onOk:B,onCancel:F},{default:c((()=>[m(i,{ref_key:"formRef",ref:N,model:u(O),rules:q,"label-col":{span:5},"wrapper-col":{span:18}},{default:c((()=>[m(o,{label:"账号",name:"account"},{default:c((()=>[m(a,{value:u(O).account,"onUpdate:value":t[0]||(t[0]=e=>u(O).account=e),placeholder:"请输入账号"},null,8,["value"])])),_:1}),m(o,{label:"密码",name:"password"},{default:c((()=>[m(s,{value:u(O).password,"onUpdate:value":t[1]||(t[1]=e=>u(O).password=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),m(o,{label:"启用状态",name:"disabledFlag"},{default:c((()=>[m(r,{checked:J.value,"onUpdate:checked":t[2]||(t[2]=e=>J.value=e),onChange:M},null,8,["checked"])])),_:1}),m(o,{label:"报告配置"},{default:c((()=>[h("div",null,[h("div",g,[m(r,{checked:u(O).dailyReportEnabled,"onUpdate:checked":t[3]||(t[3]=e=>u(O).dailyReportEnabled=e),onChange:G,style:{"margin-right":"8px"}},null,8,["checked"]),b,j]),h("div",w,[m(r,{checked:u(O).weeklyReportEnabled,"onUpdate:checked":t[4]||(t[4]=e=>u(O).weeklyReportEnabled=e),onChange:G,style:{"margin-right":"8px"}},null,8,["checked"]),x,k]),h("div",E,[m(r,{checked:u(O).monthlyReportEnabled,"onUpdate:checked":t[5]||(t[5]=e=>u(O).monthlyReportEnabled=e),onChange:G,style:{"margin-right":"8px"}},null,8,["checked"]),R,_]),Z.value?(p(),y("div",I,[U,m(n,{value:u(O).reportDaysLimit,"onUpdate:value":t[6]||(t[6]=e=>u(O).reportDaysLimit=e),min:1,max:365,placeholder:"请输入报告天数",style:{width:"200px"}},null,8,["value"]),z])):f("",!0)])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])}}};export{C as default};
