import{p as e,b as a,c as t,P as l,s as o,S as i}from"./index-ZxpkwSGJ.js";import{a as n}from"./account-api-Ia2S-UTU.js";import r from"./account-operate-modal-BZBMsA8q.js";import d from"./internship-detail-modal-D57Ytqv9.js";import s from"./report-submit-modal-DiT94QyL.js";import c from"./report-history-modal--W6XoXW4.js";import u from"./batch-report-modal-Bd7vBZVQ.js";import{d as p}from"./default-time-ranges-uUNYRUiy.js";import{_ as m}from"./index-wy53HiSK.js";import{T as f}from"./table-id-const-CfofKxZg.js";import{S as y,a5 as g,P as h,am as v,an as k,ao as b}from"./@ant-design-rHMPkvPq.js";import{M as x,b as w}from"./ant-design-vue-DFQN5xdf.js";import{r as _,a as j,e as I,b2 as S,z,b as C,o as E,y as R,c as T,ag as D,bz as U,u as M,K as N,J as F,ai as O,be as $,ah as q,F as L,h as A}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const P=()=>a("/admin/oa/account/price/current"),B=a=>e("/admin/oa/account/price/update",a),V={class:"smart-table-operate-block"},H={class:"btn-row-gap"},J={class:"smart-table-setting-block"},K={key:1},Q={key:2,style:{display:"flex","flex-direction":"column",gap:"2px","align-items":"center"}},Y={key:0},Z={key:1,style:{color:"#ff4d4f"}},G={key:2,style:{color:"#ccc"}},W={key:4},X={class:"smart-query-table-page"},ee={__name:"account-list",setup(e){const a=_([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"用户ID",dataIndex:"userId",align:"center",width:125,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:75,ellipsis:!0},{title:"账号",dataIndex:"account",align:"center",width:120,ellipsis:!0},{title:"密码",dataIndex:"password",align:"center",width:120,ellipsis:!0},{title:"学校",dataIndex:"school",align:"center",width:160,ellipsis:!0},{title:"专业",dataIndex:"major",align:"center",width:120,ellipsis:!0},{title:"签约企业",dataIndex:"contractEnterprise",align:"center",width:150,ellipsis:!0},{title:"实习状态",dataIndex:"internshipStatus",align:"center",width:80},{title:"状态",dataIndex:"disabledFlag",align:"center",width:80},{title:"报告开关",dataIndex:"reportSwitches",align:"center",width:120},{title:"报告天数",dataIndex:"reportDaysLimit",align:"center",width:80},{title:"最近提交时间",dataIndex:"lastReportTime",align:"center",width:135},{title:"详细信息",dataIndex:"queryInfo",align:"center",width:90},{title:"创建人",width:60,dataIndex:"createUserName"},{title:"创建时间",dataIndex:"createTime",width:135},{title:"操作",dataIndex:"action",width:340}]),ee={keywords:"",endTime:null,startTime:null,pageNum:1,pageSize:t,searchCount:!0,internshipStatus:"",disabledFlag:void 0},ae=j({...ee}),te=_(!1),le=_([]),oe=_(0);let ie=_();function ne(e,a){ae.startTime=a[0],ae.endTime=a[1]}function re(){ae.pageNum=1,se()}function de(){ie.value=[],Object.assign(ae,ee),se()}async function se(){try{te.value=!0;let e=await n.pageQuery(ae);const a=e.data.list;oe.value=e.data.total,le.value=a}catch(e){o.captureError(e)}finally{te.value=!1}}function ce(e){x.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{i.show(),await n.delete(e),w.success("删除成功"),se()}catch(a){o.captureError(a)}finally{i.hide()}}(e)},cancelText:"取消",onCancel(){}})}const ue=_();const pe=async()=>{const e=await n.queryDuplicateAccount();e.ok&&x.info({title:"重复账号",content:e.data.length?A("div",[A("div",{style:"text-align:center;margin-bottom:10px;"},["共计 ",A("b",e.data.length)," 个重复账号"]),A("div",{style:"max-height:300px;overflow:auto;word-break:break-all;margin-top:8px;"},e.data.join(", "))]):"无重复账号",okText:"知道了",centered:!0})},me=async()=>{x.confirm({title:"确认删除所有重复账号吗？",onOk:async()=>{(await n.deleteDuplicateAccount()).ok&&(w.success("删除成功"),se())}})},fe=_(),ye=_(),ge=_(),he=_();function ve(e){if(!e)return"";try{const a=new Date(e);if(isNaN(a.getTime()))return e;const t=a.getFullYear(),l=String(a.getMonth()+1).padStart(2,"0"),o=String(a.getDate()).padStart(2,"0"),i=String(a.getHours()).padStart(2,"0");return`${t}-${l}-${o} ${i}:${String(a.getMinutes()).padStart(2,"0")}`}catch(a){return e}}function ke(e){return e.dailyReportEnabled||e.weeklyReportEnabled||e.monthlyReportEnabled}function be(e){return ke(e)&&e.reportDaysLimit?e.reportDaysLimit<=0?"已到期":`${e.reportDaysLimit}天`:""}const xe=_("加载中...");async function we(){try{const e=await P();void 0!==e.data?xe.value=e.data||0:xe.value="未设置"}catch(e){xe.value="获取失败"}}async function _e(){try{const e=await P();let a=0,t="";void 0!==e.data&&("number"==typeof e.data?a=e.data:e.data&&"object"==typeof e.data&&(a=e.data.price||0,t=e.data.remark||"")),x.confirm({title:"设置单价",content:A("div",[A("div",{style:"margin-bottom: 12px;"},[A("span","单价（元）："),A("input",{id:"priceInput",type:"number",min:"0",step:"0.01",value:a,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单价"})]),A("div",[A("span","备注："),A("input",{id:"remarkInput",type:"text",value:t,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const e=document.getElementById("priceInput"),a=document.getElementById("remarkInput"),t=parseFloat(e?.value||0),l=a?.value||"";!e?.value||t<=0?w.error("单价必须大于0"):async function(e,a){try{await B({price:e,remark:a}),w.success("单价设置成功"),we()}catch(t){o.captureError(t),w.error("单价设置失败")}}(t,l)}})}catch(e){o.captureError(e),w.error("获取当前单价失败")}}return I((()=>{se(),we()})),(e,t)=>{const x=S("a-input"),_=S("a-form-item"),j=S("a-range-picker"),I=S("a-select-option"),A=S("a-select"),P=S("a-button"),B=S("a-space"),ee=S("a-form"),we=S("a-tag"),je=S("a-row"),Ie=S("a-table"),Se=S("a-pagination"),ze=S("a-card"),Ce=z("privilege");return E(),C(L,null,[R((E(),D(ee,{class:"smart-query-form",layout:"inline"},{default:U((()=>[T(_,{label:"关键字"},{default:U((()=>[T(x,{style:{width:"200px"},value:ae.keywords,"onUpdate:value":t[0]||(t[0]=e=>ae.keywords=e),placeholder:"姓名/账号/学校/专业/签约企业","allow-clear":""},null,8,["value"])])),_:1}),T(_,{label:"创建时间"},{default:U((()=>[T(j,{value:M(ie),"onUpdate:value":t[1]||(t[1]=e=>N(ie)?ie.value=e:ie=e),presets:M(p),onChange:ne,style:{width:"200px"}},null,8,["value","presets"])])),_:1}),T(_,{label:"实习状态"},{default:U((()=>[T(A,{value:ae.internshipStatus,"onUpdate:value":t[2]||(t[2]=e=>ae.internshipStatus=e),style:{width:"120px"},"allow-clear":"",placeholder:"全部"},{default:U((()=>[T(I,{value:""},{default:U((()=>[F("全部")])),_:1}),T(I,{value:"1"},{default:U((()=>[F("正在实习")])),_:1}),T(I,{value:"2"},{default:U((()=>[F("实习结束")])),_:1}),T(I,{value:"3"},{default:U((()=>[F("签约成功")])),_:1}),T(I,{value:"4"},{default:U((()=>[F("未开始")])),_:1})])),_:1},8,["value"])])),_:1}),T(_,{label:"状态"},{default:U((()=>[T(A,{value:ae.disabledFlag,"onUpdate:value":t[3]||(t[3]=e=>ae.disabledFlag=e),style:{width:"120px"},"allow-clear":"",placeholder:"全部"},{default:U((()=>[T(I,{value:"false"},{default:U((()=>[F("启用")])),_:1}),T(I,{value:"true"},{default:U((()=>[F("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),T(_,null,{default:U((()=>[T(B,null,{default:U((()=>[T(P,{type:"primary",onClick:re},{icon:U((()=>[T(M(y))])),default:U((()=>[F(" 查询 ")])),_:1}),T(P,{onClick:de},{icon:U((()=>[T(M(g))])),default:U((()=>[F(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})),[[Ce,"oa:account:query"]]),T(ze,{size:"small",bordered:!1,hoverable:!0},{default:U((()=>[T(je,{class:"smart-table-btn-block"},{default:U((()=>[O("div",V,[O("div",null,[R((E(),D(P,{onClick:t[4]||(t[4]=e=>{ue.value.showModal()}),type:"primary"},{icon:U((()=>[T(M(h))])),default:U((()=>[F(" 添加账号 ")])),_:1})),[[Ce,"oa:account:add"]]),R((E(),D(P,{onClick:t[5]||(t[5]=e=>async function(){await n.exportExcel(ae)}()),type:"primary"},{icon:U((()=>[T(M(v))])),default:U((()=>[F(" 导出账号（带水印） ")])),_:1})),[[Ce,"oa:account:exportExcel"]]),R((E(),D(P,{onClick:t[6]||(t[6]=e=>_e()),type:"default"},{icon:U((()=>[T(M(k))])),default:U((()=>[F(" 设置单价 ")])),_:1})),[[Ce,"oa:account:price:update"]]),T(we,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:U((()=>[T(M(b))])),default:U((()=>[F(" 当前单价："+$(xe.value)+" 元 ",1)])),_:1})]),O("div",H,[R((E(),D(P,{onClick:pe,type:"default",style:{"margin-left":"8px"}},{default:U((()=>[F(" 查询重复账号 ")])),_:1})),[[Ce,"oa:account:queryDuplicate"]]),R((E(),D(P,{onClick:me,type:"primary",danger:"",style:{"margin-left":"8px"}},{default:U((()=>[F(" 删除重复账号 ")])),_:1})),[[Ce,"oa:account:deleteDuplicate"]])])]),O("div",J,[T(m,{modelValue:a.value,"onUpdate:modelValue":t[7]||(t[7]=e=>a.value=e),tableId:M(f).BUSINESS.OA.ACCOUNT,refresh:se},null,8,["modelValue","tableId"])])])),_:1}),T(Ie,{scroll:{x:1400},size:"small",dataSource:le.value,columns:a.value,rowKey:"id",pagination:!1,loading:te.value,bordered:""},{bodyCell:U((({column:a,record:t,text:l})=>["disabledFlag"===a.dataIndex?(E(),D(we,{key:0,color:l?"red":"green"},{default:U((()=>[F($(l?"禁用":"启用"),1)])),_:2},1032,["color"])):"internshipStatus"===a.dataIndex?(E(),C("span",K,$(e.$smartEnumPlugin.getDescByValue("INTERNSHIP_STATUS_ENUM",l)),1)):"reportSwitches"===a.dataIndex?(E(),C("div",Q,[t.dailyReportEnabled?(E(),D(we,{key:0,color:"blue",size:"small"},{default:U((()=>[F(" 日报✓ ")])),_:1})):q("",!0),t.weeklyReportEnabled?(E(),D(we,{key:1,color:"green",size:"small"},{default:U((()=>[F(" 周报✓ ")])),_:1})):q("",!0),t.monthlyReportEnabled?(E(),D(we,{key:2,color:"orange",size:"small"},{default:U((()=>[F(" 月报✓ ")])),_:1})):q("",!0),t.dailyReportEnabled||t.weeklyReportEnabled||t.monthlyReportEnabled?q("",!0):(E(),D(we,{key:3,color:"default",size:"small"},{default:U((()=>[F(" 未开启 ")])),_:1}))])):"reportDaysLimit"===a.dataIndex?(E(),C(L,{key:3},[ke(t)&&l?(E(),C("span",Y,$(be(t)),1)):!ke(t)&&null!==t.reportDaysLimit&&t.reportDaysLimit<=0?(E(),C("span",Z," 已到期 ")):(E(),C("span",G,"-"))],64)):"lastReportTime"===a.dataIndex?(E(),C("span",W,$(l?ve(l):"未提交"),1)):"queryInfo"===a.dataIndex?(E(),D(P,{key:5,type:"primary",size:"small",onClick:e=>async function(e){try{e.loading=!0,i.show();const a=await n.getZhixiaoUserInfo({account:e.account,password:e.password});if(!a.data||!a.data.token||!a.data.deviceId)return w.error("登录失败，请稍后再试"),i.hide(),void(e.loading=!1);const t=a.data.token,l=a.data.deviceId,o=a.data.uid,r=await n.getInternshipInfo({uid:o,token:t,deviceId:l});r.data&&r.data.bmid?fe.value.showModal({uid:o,token:t,deviceId:l,bmid:r.data.bmid}):w.warning("未获取到实习信息，无法查询详情")}catch(a){o.captureError(a),w.error("获取实习信息失败")}finally{e.loading=!1,i.hide()}}(t),loading:t.loading},{default:U((()=>[F(" 查询信息 ")])),_:2},1032,["onClick","loading"])):q("",!0),"action"===a.dataIndex?(E(),D(B,{key:6},{default:U((()=>[R((E(),D(P,{onClick:e=>{return a=t.id,void ue.value.showModal(a);var a},size:"small",type:"link"},{default:U((()=>[F("编辑")])),_:2},1032,["onClick"])),[[Ce,"oa:account:update"]]),R((E(),D(P,{onClick:e=>function(e){const a={userId:e.userId,token:e.token,deviceId:e.deviceId,contractEnterprise:e.contractEnterprise,name:e.name,account:e.account,major:e.major};ye.value.showModal(a)}(t),size:"small",type:"link"},{default:U((()=>[F(" 提交报告 ")])),_:2},1032,["onClick"])),[[Ce,"oa:account:report"]]),R((E(),D(P,{onClick:e=>function(e){ge.value.showModal(e.id,e.name,e.account)}(t),size:"small",type:"link"},{default:U((()=>[F(" 报告历史 ")])),_:2},1032,["onClick"])),[[Ce,"oa:account:report"]]),R((E(),D(P,{onClick:e=>function(e){e&&he.value&&he.value.showModal(e)}(t),size:"small",type:"link"},{default:U((()=>[F(" 补报告 ")])),_:2},1032,["onClick"])),[[Ce,"oa:account:report"]]),R((E(),D(P,{onClick:e=>ce(t.id),size:"small",danger:"",type:"link"},{default:U((()=>[F("删除")])),_:2},1032,["onClick"])),[[Ce,"oa:account:delete"]])])),_:2},1024)):q("",!0)])),_:1},8,["dataSource","columns","loading"]),O("div",X,[T(Se,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:M(l),defaultPageSize:ae.pageSize,current:ae.pageNum,"onUpdate:current":t[8]||(t[8]=e=>ae.pageNum=e),pageSize:ae.pageSize,"onUpdate:pageSize":t[9]||(t[9]=e=>ae.pageSize=e),total:oe.value,onChange:se,onShowSizeChange:se,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),T(r,{ref_key:"operateRef",ref:ue,onRefresh:se},null,512),T(d,{ref_key:"internshipDetailRef",ref:fe},null,512),T(s,{ref_key:"reportModalRef",ref:ye,onRefresh:se},null,512),T(c,{ref_key:"reportHistoryRef",ref:ge},null,512),T(u,{ref_key:"batchReportModalRef",ref:he,onRefresh:se},null,512)])),_:1})],64)}}};export{ee as default};
