import{m as e}from"./moguding-account-api-_EuqUysM.js";import{d as a}from"./dayjs-CSPdbndm.js";import{as as o}from"./@ant-design-rHMPkvPq.js";import{b as t}from"./ant-design-vue-DFQN5xdf.js";import{r,a as s,w as l,b2 as n,ag as m,o as i,bz as u,c as d,ah as p,J as c,ai as v,u as f}from"./@vue-wTDZSr7R.js";import"./index-ZxpkwSGJ.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const j=v("span",{style:{"margin-left":"8px",color:"#666"}},"启用AI自动生成报告内容",-1),w={__name:"moguding-report-submit-modal",emits:["success"],setup(v,{expose:w,emit:y}){const k=y,b=r(!1),Y=r(!1),g=r(!1),T=r(),h=r([]),D=s({accountId:null,name:"",reportType:"day",startTime:"",endTime:"",workAddress:"",jobName:"",useAiGeneration:!0,workContent:"",workSummary:"",workProject:""}),A={accountId:[{required:!0,message:"请选择工学云账号"}],reportType:[{required:!0,message:"请选择报告类型"}],workAddress:[{max:200,message:"工作地址最多200字符"}],jobName:[{max:100,message:"工作岗位最多100字符"}],workContent:[{max:2e3,message:"工作内容最多2000字符"}],workSummary:[{max:2e3,message:"工作总结最多2000字符"}],workProject:[{max:1e3,message:"工作项目最多1000字符"}]},M=e=>e&&e>a().endOf("day"),_=e=>{e&&2===e.length?(D.startTime=e[0].format("YYYY-MM-DD HH:mm:ss"),D.endTime=e[1].format("YYYY-MM-DD HH:mm:ss")):(D.startTime="",D.endTime="")},x=async()=>{if(D.jobName){g.value=!0;try{const a=await e.generateAiReportContent(D.reportType,D.jobName);if(a.ok){const e=a.data;D.workContent=e.workContent||"",D.workSummary=e.workSummary||"",D.workProject=e.workProject||"",t.success("AI内容生成成功")}else t.error("AI内容生成失败")}catch(a){t.error("AI内容生成失败")}finally{g.value=!1}}else t.warning("请先输入工作岗位/专业")};l((()=>D.reportType),(e=>{const o=a();if("day"===e)h.value=[o,o],D.startTime=o.format("YYYY-MM-DD")+" 00:00:00",D.endTime=o.format("YYYY-MM-DD")+" 23:59:59";else if("week"===e){const e=o.startOf("week").add(1,"day"),a=o.endOf("week").add(1,"day");h.value=[e,a],D.startTime=e.format("YYYY-MM-DD")+" 00:00:00",D.endTime=a.format("YYYY-MM-DD")+" 23:59:59"}else if("month"===e){const e=o.startOf("month"),a=o.endOf("month");h.value=[e,a],D.startTime=e.format("YYYY-MM-DD")+" 00:00:00",D.endTime=a.format("YYYY-MM-DD")+" 23:59:59"}}));const C=async()=>{try{let a;await T.value.validate(),Y.value=!0,a="day"===D.reportType?await e.submitDailyReport(D):"week"===D.reportType?await e.submitWeeklyReport(D):"month"===D.reportType?await e.submitMonthlyReport(D):await e.submitReport(D),a.ok?(t.success("报告提交成功"),k("success"),I()):t.error(a.msg||"报告提交失败")}catch(a){t.error("报告提交失败")}finally{Y.value=!1}},I=()=>{b.value=!1,T.value?.resetFields()};return w({show:e=>{b.value=!0,Object.assign(D,{accountId:e.id,name:e.name,reportType:"day",startTime:"",endTime:"",workAddress:e.companyName||"",jobName:e.position||"",useAiGeneration:!0,workContent:"",workSummary:"",workProject:""});const o=a();h.value=[o,o],D.startTime=o.format("YYYY-MM-DD")+" 00:00:00",D.endTime=o.format("YYYY-MM-DD")+" 23:59:59"}}),(e,a)=>{const t=n("a-input"),r=n("a-form-item"),s=n("a-radio"),l=n("a-radio-group"),v=n("a-range-picker"),w=n("a-switch"),y=n("a-textarea"),k=n("a-button"),U=n("a-form"),N=n("a-modal");return i(),m(N,{open:b.value,"onUpdate:open":a[10]||(a[10]=e=>b.value=e),title:"工学云提交报告",width:"800px",confirmLoading:Y.value,onOk:C,onCancel:I},{default:u((()=>[d(U,{ref_key:"formRef",ref:T,model:D,rules:A,"label-col":{span:4},"wrapper-col":{span:20}},{default:u((()=>[d(r,{label:"工学云账号",name:"accountId"},{default:u((()=>[d(t,{value:D.accountId,"onUpdate:value":a[0]||(a[0]=e=>D.accountId=e),disabled:""},null,8,["value"])])),_:1}),d(r,{label:"姓名",name:"name"},{default:u((()=>[d(t,{value:D.name,"onUpdate:value":a[1]||(a[1]=e=>D.name=e),disabled:""},null,8,["value"])])),_:1}),d(r,{label:"报告类型",name:"reportType"},{default:u((()=>[d(l,{value:D.reportType,"onUpdate:value":a[2]||(a[2]=e=>D.reportType=e)},{default:u((()=>[d(s,{value:"day"},{default:u((()=>[c("日报")])),_:1}),d(s,{value:"week"},{default:u((()=>[c("周报")])),_:1}),d(s,{value:"month"},{default:u((()=>[c("月报")])),_:1})])),_:1},8,["value"])])),_:1}),d(r,{label:"时间范围"},{default:u((()=>[d(v,{value:h.value,"onUpdate:value":a[3]||(a[3]=e=>h.value=e),"disabled-date":M,onChange:_},null,8,["value"])])),_:1}),d(r,{label:"工作地址",name:"workAddress"},{default:u((()=>[d(t,{value:D.workAddress,"onUpdate:value":a[4]||(a[4]=e=>D.workAddress=e),placeholder:"请输入工作地址"},null,8,["value"])])),_:1}),d(r,{label:"工作岗位",name:"jobName"},{default:u((()=>[d(t,{value:D.jobName,"onUpdate:value":a[5]||(a[5]=e=>D.jobName=e),placeholder:"请输入工作岗位/专业"},null,8,["value"])])),_:1}),d(r,{label:"AI生成"},{default:u((()=>[d(w,{checked:D.useAiGeneration,"onUpdate:checked":a[6]||(a[6]=e=>D.useAiGeneration=e)},null,8,["checked"]),j])),_:1}),d(r,{label:"工作内容",name:"workContent"},{default:u((()=>[d(y,{value:D.workContent,"onUpdate:value":a[7]||(a[7]=e=>D.workContent=e),placeholder:"请输入工作内容",rows:4,disabled:D.useAiGeneration},null,8,["value","disabled"])])),_:1}),d(r,{label:"工作总结",name:"workSummary"},{default:u((()=>[d(y,{value:D.workSummary,"onUpdate:value":a[8]||(a[8]=e=>D.workSummary=e),placeholder:"请输入工作总结",rows:4,disabled:D.useAiGeneration},null,8,["value","disabled"])])),_:1}),d(r,{label:"工作项目",name:"workProject"},{default:u((()=>[d(t,{value:D.workProject,"onUpdate:value":a[9]||(a[9]=e=>D.workProject=e),placeholder:"请输入工作项目",disabled:D.useAiGeneration},null,8,["value","disabled"])])),_:1}),D.useAiGeneration?(i(),m(r,{key:0},{default:u((()=>[d(k,{onClick:x,loading:g.value},{icon:u((()=>[d(f(o))])),default:u((()=>[c(" 生成AI内容 ")])),_:1},8,["loading"])])),_:1})):p("",!0)])),_:1},8,["model"])])),_:1},8,["open","confirmLoading"])}}};export{w as default};
