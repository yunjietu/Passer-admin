import{c as e}from"./chaoxing-system-clock-account-api-DCasCqQB.js";import{b as a,p as l,_ as t,S as d,s as o}from"./index-ZxpkwSGJ.js";import{b as n}from"./ant-design-vue-DFQN5xdf.js";import{r as s,a as i,n as u,m as r,w as c,e as p,b2 as y,ag as v,o as m,bz as g,c as f,u as h,ah as b,b as x,J as w,ai as _,F as k,be as C,aY as D,aW as A}from"./@vue-wTDZSr7R.js";
/*
 * 学习通系统打卡账号价格配置管理
 *
 * @Author:    1024创新实验室
 * @Date:      2025-01-XX
 * @Wechat:    zhuda1024
 * @Email:     lab1024@163.com
 * @Copyright  1024创新实验室 （ https://1024lab.net ）,Since 2012
 */const E={getCurrentPrice:()=>a("/oa/chaoxing-system-clock-account-price/current"),updatePrice:e=>l("/oa/chaoxing-system-clock-account-price/update",e),updateEnabled:e=>l(`/oa/chaoxing-system-clock-account-price/enabled/${e}`),getCurrentPriceAmount:()=>a("/oa/chaoxing-system-clock-account-price/amount")},M=e=>(D("data-v-a05c665b"),e=e(),A(),e),U={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#666"}},P={class:"day-price-input-row"},j={class:"day-price-tip"},N={class:"day-price-amount"},O=M((()=>_("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 将一次性扣除购买天数对应的费用 ",-1))),Y={style:{"font-weight":"500",color:"#1677ff"}},z=M((()=>_("div",{style:{"margin-top":"4px",color:"#666","font-size":"12px"}}," 成功打卡立即扣减 1 天，扣完后自动禁用账号 ",-1))),F={class:"day-price-input-row"},q={class:"day-price-tip"},R={class:"day-price-amount"},T=M((()=>_("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 追加天数将立即扣费，并增加剩余天数 ",-1))),S=t({__name:"chaoxing-system-clock-account-operate-modal",emits:["refresh"],setup(a,{expose:l,emit:t}){l({showModal:function(a){Object.assign(L,I),a?async function(a){try{d.show();let l=(await e.detail(a)).data;Object.assign(L,l),L.dayExtendDays=0,X.value=!l.disabledFlag}catch(l){o.captureError(l)}finally{d.hide()}}(a):(X.value=!0,L.billingMode="ACCOUNT");A.value=!0,H(),u((()=>{const e=document.getElementsByClassName("ant-modal");e&&e.length>0&&Array.from(e).forEach((e=>{e.childNodes&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((e=>{e.setAttribute&&e.setAttribute("aria-hidden","false")}))}))}))}});const D=t,A=s(!1);function M(){A.value=!1}const S=s(),I={id:void 0,account:void 0,password:void 0,name:void 0,address:void 0,longitude:void 0,latitude:void 0,disabledFlag:!1,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0};let L=i({...I});const B=s(null),J=s(!1);r((()=>"DAY"===L.billingMode));const W=r((()=>null!==B.value&&B.value>0)),$=r((()=>K(L.dayCount))),G=r((()=>K(L.dayExtendDays)));async function H(){J.value=!0;try{const e=await E.getCurrentPrice();e.ok&&e.data&&void 0!==e.data.dayPrice&&null!==e.data.dayPrice?B.value=Number(e.data.dayPrice):B.value=null}catch(e){B.value=null}finally{J.value=!1}}function K(e){if(!W.value)return"";const a=Number(e);return!a||a<=0?"":(a*B.value).toFixed(2)}c((()=>L.billingMode),(e=>{"DAY"!==e&&(L.dayCount=null,L.dayExtendDays=0)}));const Q={account:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}],address:[{required:!0,message:"请输入地址"}],longitude:[{required:!0,message:"请输入经度"}],latitude:[{required:!0,message:"请输入纬度"}],dayCount:[{validator:(e,a)=>L.id||"DAY"!==L.billingMode||a&&!(a<=0)?Promise.resolve():Promise.reject("单天计费需填写购买天数"),trigger:"blur"}],dayExtendDays:[{validator:(e,a)=>L.id&&"DAY"===L.billingMode&&null!=a&&a<0?Promise.reject("追加天数不能为负数"):Promise.resolve(),trigger:"blur"}]};async function V(){S.value.validate().then((async()=>{d.show();try{const l={...L};if(delete l.dayRemainingDays,L.id?delete l.dayCount:delete l.dayExtendDays,L.id)await e.update(l),n.success("修改成功");else try{const a=await e.verifyLogin({account:L.account,password:L.password});if(!a.ok||!a.data)return n.error(a.msg||"登录失败，无法添加账号"),void d.hide();l.name=a.data,await e.create(l),n.success("添加成功")}catch(a){const e=a?.response?.data?.msg||a?.message||"登录失败，无法添加账号";return n.error(e),void d.hide()}M(),D("refresh")}catch(l){o.captureError(l)}finally{d.hide()}})).catch((e=>{}))}const X=s(!0);function Z(e){L.disabledFlag=!e}const ee=s(!1);function ae(e){const a=e.target.value;L.address=a.replace(/\s+/g,"")}async function le(){if(L.address){ee.value=!0;try{const a=L.address.replace(/\s+/g,""),l=await e.getLocationFromAddress({address:a});l.ok&&l.data?(L.longitude=l.data.longitude||"",L.latitude=l.data.latitude||"",n.success("获取经纬度成功")):n.error(l.msg||"获取经纬度失败")}catch(a){n.error("获取经纬度异常")}finally{ee.value=!1}}else n.warning("请先输入地址")}return p((()=>{H()})),(e,a)=>{const l=y("a-input"),t=y("a-form-item"),d=y("a-input-password"),o=y("a-radio"),n=y("a-radio-group"),s=y("a-input-number"),i=y("a-button"),u=y("a-switch"),r=y("a-form"),c=y("a-modal");return m(),v(c,{open:A.value,title:h(L).id?"编辑":"添加",width:700,forceRender:"","ok-text":"确认","cancel-text":"取消",onOk:V,onCancel:M},{default:g((()=>[f(r,{ref_key:"formRef",ref:S,model:h(L),rules:Q,"label-col":{span:5},"wrapper-col":{span:18}},{default:g((()=>[f(t,{label:"账号",name:"account"},{default:g((()=>[f(l,{value:h(L).account,"onUpdate:value":a[0]||(a[0]=e=>h(L).account=e),placeholder:"请输入账号",autocomplete:"username",style:{width:"100%"}},null,8,["value"])])),_:1}),f(t,{label:"密码",name:"password"},{default:g((()=>[f(d,{value:h(L).password,"onUpdate:value":a[1]||(a[1]=e=>h(L).password=e),placeholder:"请输入密码",autocomplete:"current-password",style:{width:"100%"}},null,8,["value"])])),_:1}),f(t,{label:"计费方式",name:"billingMode"},{default:g((()=>[f(n,{value:h(L).billingMode,"onUpdate:value":a[2]||(a[2]=e=>h(L).billingMode=e),disabled:!!h(L).id},{default:g((()=>[f(o,{value:"ACCOUNT"},{default:g((()=>[w("单账号扣费")])),_:1}),f(o,{value:"DAY"},{default:g((()=>[w("单天扣费")])),_:1})])),_:1},8,["value","disabled"]),h(L).id?(m(),x("div",U," 编辑状态下无法修改计费方式，如需调整请新建账号 ")):b("",!0)])),_:1}),h(L).id||"DAY"!==h(L).billingMode?b("",!0):(m(),v(t,{key:0,label:"购买天数",name:"dayCount"},{default:g((()=>[_("div",null,[_("div",P,[f(s,{value:h(L).dayCount,"onUpdate:value":a[3]||(a[3]=e=>h(L).dayCount=e),min:1,max:360,precision:0,placeholder:"输入购买天数",style:{width:"100px"}},null,8,["value"]),_("div",j,[J.value?(m(),x(k,{key:0},[w(" 单价加载中... ")],64)):W.value?(m(),x(k,{key:1},[w(" 预计扣费："),_("span",N,C($.value||"--"),1),w(" 元 ")],64)):(m(),x(k,{key:2},[w(" 未配置单天单价 ")],64))])]),O])])),_:1})),h(L).id&&"DAY"===h(L).billingMode?(m(),x(k,{key:1},[f(t,{label:"剩余天数"},{default:g((()=>[_("div",null,[_("div",Y,C(h(L).dayRemainingDays||0)+" 天 ",1),z])])),_:1}),f(t,{label:"追加天数",name:"dayExtendDays",style:{"margin-bottom":"-15px"}},{default:g((()=>[_("div",null,[_("div",F,[f(s,{value:h(L).dayExtendDays,"onUpdate:value":a[4]||(a[4]=e=>h(L).dayExtendDays=e),min:0,max:360,precision:0,placeholder:"输入追加天数",style:{width:"100px"}},null,8,["value"]),_("div",q,[J.value?(m(),x(k,{key:0},[w(" 单价加载中... ")],64)):W.value?(m(),x(k,{key:1},[w(" 预计扣费："),_("span",R,C(G.value||"--"),1),w(" 元 ")],64)):(m(),x(k,{key:2},[w(" 未配置单天单价 ")],64))])]),T])])),_:1})],64)):b("",!0),f(t,{label:"姓名"},{default:g((()=>[f(l,{value:h(L).name,"onUpdate:value":a[5]||(a[5]=e=>h(L).name=e),placeholder:"请输入姓名",style:{width:"100%"}},null,8,["value"])])),_:1}),f(t,{label:"地址",name:"address"},{default:g((()=>[f(l,{value:h(L).address,"onUpdate:value":a[6]||(a[6]=e=>h(L).address=e),placeholder:"请输入地址",style:{width:"70%","margin-right":"8px"},onInput:ae},null,8,["value"]),f(i,{type:"primary",size:"small",onClick:le,loading:ee.value},{default:g((()=>[w("获取经纬度")])),_:1},8,["loading"])])),_:1}),f(t,{label:"经度",name:"longitude"},{default:g((()=>[f(l,{value:h(L).longitude,"onUpdate:value":a[7]||(a[7]=e=>h(L).longitude=e),placeholder:"请输入经度",style:{width:"100%"}},null,8,["value"])])),_:1}),f(t,{label:"纬度",name:"latitude"},{default:g((()=>[f(l,{value:h(L).latitude,"onUpdate:value":a[8]||(a[8]=e=>h(L).latitude=e),placeholder:"请输入纬度",style:{width:"100%"}},null,8,["value"])])),_:1}),f(t,{label:"启用状态",name:"disabledFlag"},{default:g((()=>[f(u,{checked:X.value,"onUpdate:checked":a[9]||(a[9]=e=>X.value=e),onChange:Z},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])}}},[["__scopeId","data-v-a05c665b"]]),I=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"}));export{S as C,I as a,E as c};
