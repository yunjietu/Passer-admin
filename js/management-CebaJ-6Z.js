import{r as e}from"./recharge-card-api-CADqy6pO.js";import{Y as a,P as t}from"./index-ZxpkwSGJ.js";import{_ as l}from"./index-wy53HiSK.js";import{S as r,a5 as s,P as i,a1 as n}from"./@ant-design-rHMPkvPq.js";import{b as o}from"./ant-design-vue-DFQN5xdf.js";import{a as d,r as u,m as c,e as m,b2 as p,z as v,b as y,o as g,y as f,c as h,ag as b,bz as w,J as _,F as j,b0 as x,be as C,u as k,ai as z,ah as S}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const U={class:"smart-table-operate-block"},N={class:"smart-table-setting-block"},I={key:1,class:"smart-table-operate"},q={class:"smart-query-table-page"},A={__name:"management",setup(A){const T={createUserName:void 0,status:void 0,cardAmount:void 0,cardType:void 0,batchNo:void 0,pageNum:1,pageSize:10},D=d({...T}),O=u([]),R=u(0),L=u([]),P=u([]),B=u([]),E=(e,a)=>{P.value=e,B.value=a},F=c((()=>({selectedRowKeys:P.value,onChange:E}))),V=u(!1),J=u(!1),K=u(),$=d({cardCount:1,cardAmount:100,expireDays:365,remark:"",cardType:a.NORMAL.value}),M={cardCount:[{required:!0,message:"请输入生成数量"},{type:"number",min:1,max:1e3,message:"生成数量必须在1-1000之间"}],cardAmount:[{required:!0,message:"请输入卡密面值"},{type:"number",min:1,message:"卡密面值必须大于0"}],expireDays:[{required:!0,message:"请输入过期天数"},{type:"number",min:1,max:3650,message:"过期天数必须在1-3650之间"}],cardType:[{required:!0,message:"请选择卡密类型"}]},Q=u([{title:"批次号",dataIndex:"batchNo",ellipsis:!0,width:90,align:"center"},{title:"卡密类型",dataIndex:"cardType",ellipsis:!0,width:90,align:"center",customRender:({text:e})=>a[e]?.desc||e},{title:"卡密",dataIndex:"cardNumber",ellipsis:!0,width:180,align:"center"},{title:"面值",dataIndex:"cardAmount",ellipsis:!0,width:80,align:"center"},{title:"状态",dataIndex:"statusDesc",ellipsis:!0,width:100,align:"center"},{title:"使用人",dataIndex:"useEmployeeName",ellipsis:!0,width:80,align:"center"},{title:"使用时间",dataIndex:"useTime",ellipsis:!0,width:150,align:"center"},{title:"创建人",dataIndex:"createUserName",ellipsis:!0,width:80,align:"center"},{title:"创建时间",dataIndex:"createTime",ellipsis:!0,width:150,align:"center"},{title:"过期时间",dataIndex:"expireTime",ellipsis:!0,width:150,align:"center"},{title:"备注",dataIndex:"remark",ellipsis:!0,width:120,align:"center"},{title:"操作",dataIndex:"action",width:90,fixed:"right",align:"center"}]);function Y(){let e=D.pageSize;Object.assign(D,T),D.pageSize=e,H()}function G(){D.pageNum=1,H()}async function H(){try{let a=await e.getCardList(D);O.value=a.data.list||a.data,R.value=a.data.total||a.data.length,P.value=[],B.value=[]}catch(a){}}const W=e=>{switch(e){case 0:return"blue";case 1:return"green";case 2:return"red";case 3:return"orange";default:return"default"}},X=()=>{if(!B.value||0===B.value.length)return void o.warning("请先选择需要导出的卡密");const e=B.value.map((e=>e.cardNumber)).filter(Boolean).join("\n");if(!e)return void o.warning("选择的数据中没有可导出的卡密");const a=new Blob([e],{type:"text/plain;charset=utf-8;"}),t=document.createElement("a"),l=URL.createObjectURL(a);t.setAttribute("href",l),t.setAttribute("download",`选中卡密_${(new Date).getTime()}.txt`),t.style.visibility="hidden",document.body.appendChild(t),t.click(),document.body.removeChild(t),o.success("导出成功")},Z=async()=>{try{await K.value.validate(),V.value=!0;const a=await e.generateCardBatch($);a.data&&(o.success(a.data),J.value=!1,K.value.resetFields(),H())}catch(a){o.error("生成卡密失败")}finally{V.value=!1}};return m((async()=>{await async function(){try{const a=await e.getCardAmountOptions();L.value=a.data||[]}catch(a){}}(),await H()})),(d,u)=>{const c=p("a-input"),m=p("a-form-item"),A=p("a-select-option"),T=p("a-select"),B=p("a-button"),E=p("a-button-group"),ee=p("a-row"),ae=p("a-form"),te=p("a-tag"),le=p("a-table"),re=p("a-pagination"),se=p("a-card"),ie=p("a-input-number"),ne=p("a-textarea"),oe=p("a-modal"),de=v("privilege");return g(),y(j,null,[f((g(),b(ae,{class:"smart-query-form"},{default:w((()=>[h(ee,{class:"smart-query-form-row"},{default:w((()=>[h(m,{label:"创建人",class:"smart-query-form-item"},{default:w((()=>[h(c,{style:{width:"200px"},value:D.createUserName,"onUpdate:value":u[0]||(u[0]=e=>D.createUserName=e),placeholder:"创建人"},null,8,["value"])])),_:1}),h(m,{label:"状态",class:"smart-query-form-item"},{default:w((()=>[h(T,{value:D.status,"onUpdate:value":u[1]||(u[1]=e=>D.status=e),allowClear:"",style:{width:"160px"},placeholder:"选择状态"},{default:w((()=>[h(A,{value:0},{default:w((()=>[_("未使用")])),_:1}),h(A,{value:1},{default:w((()=>[_("已使用")])),_:1}),h(A,{value:2},{default:w((()=>[_("已过期")])),_:1}),h(A,{value:3},{default:w((()=>[_("已禁用")])),_:1})])),_:1},8,["value"])])),_:1}),h(m,{label:"面值",class:"smart-query-form-item"},{default:w((()=>[h(T,{value:D.cardAmount,"onUpdate:value":u[2]||(u[2]=e=>D.cardAmount=e),allowClear:"",style:{width:"160px"},placeholder:"选择面值"},{default:w((()=>[(g(!0),y(j,null,x(L.value,(e=>(g(),b(A,{key:e,value:e},{default:w((()=>[_(C(e)+"元 ",1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),h(m,{label:"卡密类型",class:"smart-query-form-item"},{default:w((()=>[h(T,{value:D.cardType,"onUpdate:value":u[3]||(u[3]=e=>D.cardType=e),allowClear:"",style:{width:"140px"},placeholder:"选择类型"},{default:w((()=>[(g(!0),y(j,null,x(Object.values(k(a)),(e=>(g(),b(A,{value:e.value,key:e.value},{default:w((()=>[_(C(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),h(m,{label:"批次号",class:"smart-query-form-item"},{default:w((()=>[h(c,{value:D.batchNo,"onUpdate:value":u[4]||(u[4]=e=>D.batchNo=e),style:{width:"140px"},placeholder:"输入批次号"},null,8,["value"])])),_:1}),h(m,{class:"smart-query-form-item"},{default:w((()=>[h(E,null,{default:w((()=>[h(B,{type:"primary",onClick:G},{icon:w((()=>[h(k(r))])),default:w((()=>[_(" 查询 ")])),_:1}),h(B,{onClick:Y,class:"smart-margin-left10"},{icon:w((()=>[h(k(s))])),default:w((()=>[_(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})),[[de,"system:rechargeCard:query"]]),h(se,{size:"small",bordered:!1,hoverable:!0},{default:w((()=>[h(ee,{class:"smart-table-btn-block"},{default:w((()=>[z("div",U,[f((g(),b(B,{onClick:u[5]||(u[5]=e=>J.value=!0),type:"primary"},{icon:w((()=>[h(k(i))])),default:w((()=>[_(" 生成卡密 ")])),_:1})),[[de,"system:rechargeCard:generate"]]),h(B,{class:"smart-margin-left10",disabled:0===P.value.length,onClick:X},{icon:w((()=>[h(k(n))])),default:w((()=>[_(" 导出卡密 ")])),_:1},8,["disabled"])]),z("div",N,[h(l,{modelValue:Q.value,"onUpdate:modelValue":u[6]||(u[6]=e=>Q.value=e),tableId:null,refresh:H},null,8,["modelValue"])])])),_:1}),h(le,{size:"small",dataSource:O.value,columns:Q.value,rowKey:"id",bordered:"",pagination:!1,scroll:{x:1200},rowSelection:F.value},{bodyCell:w((({text:a,record:t,column:l})=>["statusDesc"===l.dataIndex?(g(),b(te,{key:0,color:W(t.status)},{default:w((()=>[_(C(t.statusDesc),1)])),_:2},1032,["color"])):S("",!0),"action"===l.dataIndex?(g(),y("div",I,[0===t.status?f((g(),b(B,{key:0,onClick:a=>(async a=>{try{const t=await e.disableCard(a.id);t.data&&(o.success(t.data),H())}catch(t){o.error("禁用卡密失败")}})(t),type:"link",danger:""},{default:w((()=>[_(" 禁用 ")])),_:2},1032,["onClick"])),[[de,"system:rechargeCard:disable"]]):S("",!0),3===t.status?f((g(),b(B,{key:1,onClick:a=>(async a=>{try{const t=await e.enableCard(a.id);t.data&&(o.success(t.data),H())}catch(t){o.error("启用卡密失败")}})(t),type:"link"},{default:w((()=>[_(" 启用 ")])),_:2},1032,["onClick"])),[[de,"system:rechargeCard:enable"]]):S("",!0)])):S("",!0)])),_:1},8,["dataSource","columns","rowSelection"]),z("div",q,[h(re,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:k(t),defaultPageSize:D.pageSize,current:D.pageNum,"onUpdate:current":u[7]||(u[7]=e=>D.pageNum=e),pageSize:D.pageSize,"onUpdate:pageSize":u[8]||(u[8]=e=>D.pageSize=e),total:R.value,onChange:H,onShowSizeChange:H,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])])])),_:1}),h(oe,{open:J.value,"onUpdate:open":u[14]||(u[14]=e=>J.value=e),title:"生成卡密",width:600,onOk:Z,"confirm-loading":V.value},{default:w((()=>[h(ae,{ref_key:"generateFormRef",ref:K,model:$,rules:M,"label-col":{span:6},"wrapper-col":{span:18}},{default:w((()=>[h(m,{label:"生成数量",name:"cardCount"},{default:w((()=>[h(ie,{value:$.cardCount,"onUpdate:value":u[9]||(u[9]=e=>$.cardCount=e),min:1,max:1e3,style:{width:"100%"},placeholder:"请输入生成数量"},null,8,["value"])])),_:1}),h(m,{label:"卡密面值",name:"cardAmount"},{default:w((()=>[h(ie,{value:$.cardAmount,"onUpdate:value":u[10]||(u[10]=e=>$.cardAmount=e),min:1,precision:2,style:{width:"100%"},placeholder:"请输入卡密面值"},null,8,["value"])])),_:1}),h(m,{label:"过期天数",name:"expireDays"},{default:w((()=>[h(ie,{value:$.expireDays,"onUpdate:value":u[11]||(u[11]=e=>$.expireDays=e),min:1,max:3650,style:{width:"100%"},placeholder:"请输入过期天数"},null,8,["value"])])),_:1}),h(m,{label:"卡密类型",name:"cardType"},{default:w((()=>[h(T,{value:$.cardType,"onUpdate:value":u[12]||(u[12]=e=>$.cardType=e),placeholder:"请选择卡密类型"},{default:w((()=>[(g(!0),y(j,null,x(Object.values(k(a)),(e=>(g(),b(A,{value:e.value,key:e.value},{default:w((()=>[_(C(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),h(m,{label:"备注",name:"remark"},{default:w((()=>[h(ne,{value:$.remark,"onUpdate:value":u[13]||(u[13]=e=>$.remark=e),rows:1,placeholder:"请输入备注信息"},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","confirm-loading"])],64)}}};export{A as default};
