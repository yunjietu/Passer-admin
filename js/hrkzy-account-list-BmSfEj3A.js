import{c as e,P as a,s as t,S as l}from"./index-ZxpkwSGJ.js";import{h as i}from"./hrkzy-account-api-DYH7tamM.js";import{H as o,h as n}from"./hrkzy-account-operate-modal-JxHpDFQU.js";import{_ as r}from"./index-wy53HiSK.js";import s from"./clock-history-modal-Dnamb2lR.js";import{S as d,a5 as c,P as u,an as p,ao as m}from"./@ant-design-rHMPkvPq.js";import{M as y,b as g}from"./ant-design-vue-DFQN5xdf.js";import{r as f,a as h,e as v,b2 as k,z as x,b,o as w,c as j,bz as _,J as z,u as C,ai as I,y as S,ag as P,be as R,ah as D,F as E,aR as N,h as U}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const T={class:"smart-table-operate-block"},M={class:"smart-table-setting-block"},A={key:1,class:"permanent"},O={key:2,class:"no-data"},F={class:"smart-query-table-page"},$={__name:"hrkzy-account-list",setup($){const B=f("加载中..."),H=f([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"账号",dataIndex:"account",align:"center",width:100,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:80,ellipsis:!0},{title:"实习单位",dataIndex:"companyName",align:"center",width:120,ellipsis:!0},{title:"职位",dataIndex:"positionName",align:"center",width:100,ellipsis:!0,defaultHidden:!0},{title:"工作地址",dataIndex:"address",align:"center",width:200,ellipsis:!0},{title:"剩余天数",dataIndex:"dayRemainingDays",align:"center",width:90},{title:"状态",dataIndex:"status",align:"center",width:60},{title:"打卡结果",dataIndex:"clockResult",align:"center",width:80},{title:"最后打卡时间",dataIndex:"lastClockTime",width:150},{title:"创建人",dataIndex:"createUserName",align:"center",width:80},{title:"创建时间",dataIndex:"createTime",width:150},{title:"操作",dataIndex:"action",width:250}]),V={account:"",name:"",companyName:"",status:void 0,pageNum:1,pageSize:e,searchCount:!0},q=h({...V}),J=f(!1),L=f([]),Q=f(0);function K(){q.pageNum=1,Y()}function W(){Object.assign(q,V),Y()}async function Y(){try{J.value=!0;let e=await i.pageQuery(q);const a=e.data.list;Q.value=e.data.total,a.forEach((e=>{e.billingMode=e.billingMode||"ACCOUNT",void 0!==e.dayRemainingDays&&null!==e.dayRemainingDays||(e.dayRemainingDays=0)})),L.value=a}catch(e){t.captureError(e)}finally{J.value=!1}}function G(e){y.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{l.show(),await i.delete(e),g.success("删除成功"),Y()}catch(a){t.captureError(a)}finally{l.hide()}}(e)},cancelText:"取消",onCancel(){}})}const X=f();const Z=f();function ee(e){return e?"SUCCESS"===e?"成功":"FAILED"===e?"失败":e:"未打卡"}async function ae(){try{const e=await n.getCurrentPrice();if(e&&e.data){const a=e.data.accountPrice??e.data.price??0,t=e.data.dayPrice??0;B.value=`单天：${t} 元/天 | 单账号：${a} 元/账号`}else B.value="未设置"}catch(e){B.value="获取失败"}}async function te(){try{const e=await n.getCurrentPrice();let a=0,l=0,i="";e&&e.data&&(a=e.data.accountPrice??e.data.price??0,l=e.data.dayPrice??0,i=e.data.remark||"");const o="hrkzyAccountPriceInput",r="hrkzyDayPriceInput",s="hrkzyRemarkInput";y.confirm({title:"设置单价",content:U("div",[U("div",{style:"margin-bottom: 12px;"},[U("span","单天单价（元/天）："),U("input",{id:r,type:"number",min:"0",step:"0.01",value:l,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单天单价"})]),U("div",{style:"margin-bottom: 12px;"},[U("span","单账号单价（元/账号）："),U("input",{id:o,type:"number",min:"0",step:"0.01",value:a,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单账号单价"})]),U("div",[U("span","备注："),U("input",{id:s,type:"text",value:i,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const e=document.getElementById(o),a=document.getElementById(r),l=document.getElementById(s),i=parseFloat(e?.value||0),d=parseFloat(a?.value||0),c=l?.value||"";return i<0||d<0?(g.error("单价不能为负数"),Promise.reject()):async function(e,a,l){try{await n.updatePrice({accountPrice:e,dayPrice:a,remark:l}),g.success("单价设置成功"),ae()}catch(i){t.captureError(i),g.error("单价设置失败")}}(i,d,c)}})}catch(e){t.captureError(e),g.error("获取当前单价失败")}}return v((()=>{Y(),ae()})),(e,n)=>{const y=k("a-input"),f=k("a-form-item"),h=k("a-select-option"),v=k("a-select"),U=k("a-button"),$=k("a-space"),V=k("a-form"),ae=k("a-tag"),le=k("a-row"),ie=k("a-table"),oe=k("a-pagination"),ne=k("a-card"),re=x("privilege");return w(),b(E,null,[j(V,{class:"smart-query-form",layout:"inline"},{default:_((()=>[j(f,{label:"账号"},{default:_((()=>[j(y,{style:{width:"200px"},value:q.account,"onUpdate:value":n[0]||(n[0]=e=>q.account=e),placeholder:"请输入账号","allow-clear":""},null,8,["value"])])),_:1}),j(f,{label:"姓名"},{default:_((()=>[j(y,{style:{width:"200px"},value:q.name,"onUpdate:value":n[1]||(n[1]=e=>q.name=e),placeholder:"请输入姓名","allow-clear":""},null,8,["value"])])),_:1}),j(f,{label:"实习单位"},{default:_((()=>[j(y,{style:{width:"200px"},value:q.companyName,"onUpdate:value":n[2]||(n[2]=e=>q.companyName=e),placeholder:"请输入实习单位","allow-clear":""},null,8,["value"])])),_:1}),j(f,{label:"状态"},{default:_((()=>[j(v,{style:{width:"120px"},value:q.status,"onUpdate:value":n[3]||(n[3]=e=>q.status=e),placeholder:"请选择状态","allow-clear":""},{default:_((()=>[j(h,{value:1},{default:_((()=>[z("启用")])),_:1}),j(h,{value:0},{default:_((()=>[z("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),j(f,null,{default:_((()=>[j($,null,{default:_((()=>[j(U,{type:"primary",onClick:K},{icon:_((()=>[j(C(d))])),default:_((()=>[z(" 查询 ")])),_:1}),j(U,{onClick:W},{icon:_((()=>[j(C(c))])),default:_((()=>[z(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1}),j(ne,{size:"small",bordered:!1,hoverable:!0},{default:_((()=>[j(le,{class:"smart-table-btn-block"},{default:_((()=>[I("div",T,[I("div",null,[S((w(),P(U,{onClick:n[4]||(n[4]=e=>{X.value.showModal()}),type:"primary"},{icon:_((()=>[j(C(u))])),default:_((()=>[z(" 添加账号 ")])),_:1})),[[re,"oa:hrkzy-account:add"]]),S((w(),P(U,{onClick:n[5]||(n[5]=e=>te()),type:"default",style:{"margin-left":"8px"}},{icon:_((()=>[j(C(p))])),default:_((()=>[z(" 设置单价 ")])),_:1})),[[re,"oa:hrkzy-account:price:update"]]),j(ae,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:_((()=>[j(C(m))])),default:_((()=>[z(" 当前单价："+R(B.value),1)])),_:1})])]),I("div",M,[j(r,{modelValue:H.value,"onUpdate:modelValue":n[6]||(n[6]=e=>H.value=e),tableId:700,refresh:Y},null,8,["modelValue"])])])),_:1}),j(ie,{scroll:{x:1500},size:"small",dataSource:L.value,columns:H.value,rowKey:"id",pagination:!1,loading:J.value,bordered:""},{bodyCell:_((({column:e,record:a,text:o})=>{return["status"===e.dataIndex?(w(),P(ae,{key:0,color:1===o?"green":"red"},{default:_((()=>[z(R(1===o?"启用":"禁用"),1)])),_:2},1032,["color"])):D("",!0),"clockResult"===e.dataIndex?(w(),P(ae,{key:1,color:(n=o,n?"SUCCESS"===n?"green":"FAILED"===n?"red":"":"")},{default:_((()=>[z(R(ee(o)),1)])),_:2},1032,["color"])):D("",!0),"dayRemainingDays"===e.dataIndex?(w(),b(E,{key:2},["DAY"===a.billingMode?(w(),b("span",{key:0,style:N({color:(a.dayRemainingDays??0)>0?"#1677ff":"#ff4d4f",fontWeight:500})},R("number"==typeof a.dayRemainingDays?`${a.dayRemainingDays} 天`:"--"),5)):"ACCOUNT"===a.billingMode?(w(),b("span",A,"永久")):(w(),b("span",O,"--"))],64)):D("",!0),"action"===e.dataIndex?(w(),P($,{key:3},{default:_((()=>[S((w(),P(U,{onClick:e=>{return t=a.id,void X.value.showModal(t);var t},size:"small",type:"link"},{default:_((()=>[z("编辑")])),_:2},1032,["onClick"])),[[re,"oa:hrkzy-account:update"]]),S((w(),P(U,{onClick:e=>G(a.id),size:"small",danger:"",type:"link"},{default:_((()=>[z("删除")])),_:2},1032,["onClick"])),[[re,"oa:hrkzy-account:delete"]]),S((w(),P(U,{onClick:e=>async function(e){l.show();try{const a=await i.clock(e.id);a.ok?(g.success(a.data||"打卡成功"),setTimeout((()=>{Y()}),500)):g.error(a.msg||"打卡失败")}catch(a){t.captureError(a)}finally{l.hide()}}(a),size:"small",type:"link"},{default:_((()=>[z("立即打卡")])),_:2},1032,["onClick"])),[[re,"oa:hrkzy-account:clock"]]),S((w(),P(U,{onClick:e=>async function(e){Z.value.showModal(e)}(a),size:"small",type:"link"},{default:_((()=>[z("打卡历史")])),_:2},1032,["onClick"])),[[re,"oa:hrkzy-account:detail"]])])),_:2},1024)):D("",!0)];var n})),_:1},8,["dataSource","columns","loading"]),I("div",F,[j(oe,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:C(a),defaultPageSize:q.pageSize,current:q.pageNum,"onUpdate:current":n[7]||(n[7]=e=>q.pageNum=e),pageSize:q.pageSize,"onUpdate:pageSize":n[8]||(n[8]=e=>q.pageSize=e),total:Q.value,onChange:Y,onShowSizeChange:Y,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),j(o,{ref_key:"operateRef",ref:X,onRefresh:Y},null,512)])),_:1}),j(s,{ref_key:"clockHistoryModalRef",ref:Z},null,512)],64)}}};export{$ as default};
