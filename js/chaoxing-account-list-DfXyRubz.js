import{c as e,P as a,s as t,S as l}from"./index-ZxpkwSGJ.js";import{c as o}from"./chaoxing-account-api-LV_gIdy7.js";import{_ as i,c as n}from"./chaoxing-account-operate-modal-gHUQnCus.js";import{_ as s}from"./index-wy53HiSK.js";import d from"./clock-in-history-modal-2GFa2kIY.js";import{M as r,b as c}from"./ant-design-vue-DFQN5xdf.js";import{r as u,a as p,e as m,b2 as g,z as y,b as f,o as h,c as x,bz as v,J as k,ai as b,y as I,ag as w,be as _,ah as j,F as C,aR as R,u as S,h as z}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const D={class:"smart-table-operate-block"},E={class:"smart-table-setting-block"},P={key:1,class:"permanent"},O={key:2,class:"no-data"},N={class:"smart-query-table-page"},U={__name:"chaoxing-account-list",setup(U){const F=u("加载中..."),M=u([{title:"ID",dataIndex:"id",align:"center",width:55},{title:"账号",dataIndex:"account",align:"center",width:100,ellipsis:!0},{title:"密码",dataIndex:"password",align:"center",width:100,ellipsis:!0},{title:"姓名",dataIndex:"name",align:"center",width:75,ellipsis:!0},{title:"学校ID",dataIndex:"schoolid",align:"center",width:80,ellipsis:!0,defaultHidden:!0},{title:"课程",dataIndex:"course",align:"center",width:80,ellipsis:!0},{title:"剩余天数",dataIndex:"dayRemainingDays",align:"center",width:90},{title:"地址",dataIndex:"address",align:"center",width:160,ellipsis:!0},{title:"状态",dataIndex:"disabledFlag",align:"center",width:60},{title:"打卡结果",dataIndex:"clockInResult",align:"center",width:80},{title:"创建人",dataIndex:"createUserName",align:"center",width:80},{title:"创建时间",dataIndex:"createTime",width:120},{title:"操作",dataIndex:"action",width:220}]),T={keywords:"",disabledFlag:void 0,clockInResult:void 0,pageNum:1,pageSize:e,searchCount:!0},A=p({...T}),$=u(!1),B=u([]),L=u(0);function V(){A.pageNum=1,H()}function q(){Object.assign(A,T),H()}async function H(){try{$.value=!0;let e=await o.pageQuery(A);const a=e.data.list;L.value=e.data.total,a.forEach((e=>{e.lastClockInResult?"SUCCESS"===e.lastClockInResult?e.clockInResult="成功":"FAILED"===e.lastClockInResult||"EXPIRED"===e.lastClockInResult?e.clockInResult="失败":e.clockInResult=e.lastClockInResult:e.clockInResult="未打卡",e.billingMode=e.billingMode||"ACCOUNT",void 0!==e.dayRemainingDays&&null!==e.dayRemainingDays||(e.dayRemainingDays=0)})),B.value=a}catch(e){t.captureError(e)}finally{$.value=!1}}function J(e){r.confirm({title:"确定要删除吗？",content:"删除后，该信息将不可恢复",okText:"删除",okType:"danger",onOk(){!async function(e){try{l.show(),await o.delete(e),c.success("删除成功"),H()}catch(a){t.captureError(a)}finally{l.hide()}}(e)},cancelText:"取消",onCancel(){}})}const K=u();const Q=u();async function W(){try{const e=await n.getCurrentPrice();if(e&&e.data){const a=e.data.accountPrice??e.data.price??0,t=e.data.dayPrice??0;F.value=`单天：${t} 元/天 | 单账号：${a} 元/账号`}else F.value="未设置"}catch(e){F.value="获取失败"}}async function X(){try{const e=await n.getCurrentPrice();let a=0,l=0,o="";e&&e.data&&(a=e.data.accountPrice??e.data.price??0,l=e.data.dayPrice??0,o=e.data.remark||"");const i="chaoxingAccountPriceInput",s="chaoxingDayPriceInput",d="chaoxingRemarkInput";r.confirm({title:"设置单价",content:z("div",[z("div",{style:"margin-bottom: 12px;"},[z("span","单天单价（元/天）："),z("input",{id:s,type:"number",min:"0",step:"0.01",value:l,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单天单价"})]),z("div",{style:"margin-bottom: 12px;"},[z("span","单账号单价（元/账号）："),z("input",{id:i,type:"number",min:"0",step:"0.01",value:a,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单账号单价"})]),z("div",[z("span","备注："),z("input",{id:d,type:"text",value:o,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const e=document.getElementById(i),a=document.getElementById(s),l=document.getElementById(d),o=parseFloat(e?.value||0),r=parseFloat(a?.value||0),u=l?.value||"";return o<0||r<0?(c.error("单价不能为负数"),Promise.reject()):async function(e,a,l){try{await n.updatePrice({accountPrice:e,dayPrice:a,remark:l}),c.success("单价设置成功"),W()}catch(o){t.captureError(o),c.error("单价设置失败")}}(o,r,u)}})}catch(e){t.captureError(e),c.error("获取当前单价失败")}}return m((()=>{H(),W()})),(e,n)=>{const r=g("a-input"),u=g("a-form-item"),p=g("a-select-option"),m=g("a-select"),z=g("SearchOutlined"),U=g("a-button"),T=g("ReloadOutlined"),W=g("a-space"),Y=g("a-form"),G=g("PlusOutlined"),Z=g("SettingOutlined"),ee=g("MoneyCollectOutlined"),ae=g("a-tag"),te=g("a-row"),le=g("a-table"),oe=g("a-pagination"),ie=g("a-card"),ne=y("privilege");return h(),f(C,null,[x(Y,{class:"smart-query-form",layout:"inline"},{default:v((()=>[x(u,{label:"关键字"},{default:v((()=>[x(r,{style:{width:"200px"},value:A.keywords,"onUpdate:value":n[0]||(n[0]=e=>A.keywords=e),placeholder:"姓名/账号/学校ID/课程/地址","allow-clear":""},null,8,["value"])])),_:1}),x(u,{label:"状态"},{default:v((()=>[x(m,{style:{width:"120px"},value:A.disabledFlag,"onUpdate:value":n[1]||(n[1]=e=>A.disabledFlag=e),placeholder:"请选择状态","allow-clear":""},{default:v((()=>[x(p,{value:!1},{default:v((()=>[k("启用")])),_:1}),x(p,{value:!0},{default:v((()=>[k("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),x(u,{label:"打卡结果"},{default:v((()=>[x(m,{style:{width:"120px"},value:A.clockInResult,"onUpdate:value":n[2]||(n[2]=e=>A.clockInResult=e),placeholder:"请选择结果","allow-clear":""},{default:v((()=>[x(p,{value:"SUCCESS"},{default:v((()=>[k("成功")])),_:1}),x(p,{value:"FAILED"},{default:v((()=>[k("失败")])),_:1}),x(p,{value:"NOT_CLOCKED_IN"},{default:v((()=>[k("未打卡")])),_:1})])),_:1},8,["value"])])),_:1}),x(u,null,{default:v((()=>[x(W,null,{default:v((()=>[x(U,{type:"primary",onClick:V},{icon:v((()=>[x(z)])),default:v((()=>[k(" 查询 ")])),_:1}),x(U,{onClick:q},{icon:v((()=>[x(T)])),default:v((()=>[k(" 重置 ")])),_:1})])),_:1})])),_:1})])),_:1}),x(ie,{size:"small",bordered:!1,hoverable:!0},{default:v((()=>[x(te,{class:"smart-table-btn-block"},{default:v((()=>[b("div",D,[b("div",null,[I((h(),w(U,{onClick:n[3]||(n[3]=e=>{K.value.showModal()}),type:"primary"},{icon:v((()=>[x(G)])),default:v((()=>[k(" 添加账号 ")])),_:1})),[[ne,"oa:chaoxing-account:add"]]),I((h(),w(U,{onClick:n[4]||(n[4]=e=>X()),type:"default",style:{"margin-left":"8px"}},{icon:v((()=>[x(Z)])),default:v((()=>[k(" 设置单价 ")])),_:1})),[[ne,"oa:chaoxing-account:price:update"]]),x(ae,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:v((()=>[x(ee)])),default:v((()=>[k(" 当前单价："+_(F.value),1)])),_:1})])]),b("div",E,[x(s,{modelValue:M.value,"onUpdate:modelValue":n[5]||(n[5]=e=>M.value=e),tableId:600,refresh:H},null,8,["modelValue"])])])),_:1}),x(le,{scroll:{x:1500},size:"small",dataSource:B.value,columns:M.value,rowKey:"id",pagination:!1,loading:$.value,bordered:""},{bodyCell:v((({column:e,record:a,text:i})=>{return["disabledFlag"===e.dataIndex?(h(),w(ae,{key:0,color:i?"red":"green"},{default:v((()=>[k(_(i?"禁用":"启用"),1)])),_:2},1032,["color"])):j("",!0),"clockInResult"===e.dataIndex?(h(),w(ae,{key:1,color:(n=i,n?"成功"===n?"green":"失败"===n?"red":"":"")},{default:v((()=>[k(_(i),1)])),_:2},1032,["color"])):j("",!0),"dayRemainingDays"===e.dataIndex?(h(),f(C,{key:2},["DAY"===a.billingMode?(h(),f("span",{key:0,style:R({color:(a.dayRemainingDays??0)>0?"#1677ff":"#ff4d4f",fontWeight:500})},_("number"==typeof a.dayRemainingDays?`${a.dayRemainingDays} 天`:"--"),5)):"ACCOUNT"===a.billingMode?(h(),f("span",P,"永久")):(h(),f("span",O,"--"))],64)):j("",!0),"action"===e.dataIndex?(h(),w(W,{key:3},{default:v((()=>[I((h(),w(U,{onClick:e=>{return t=a.id,void K.value.showModal(t);var t},size:"small",type:"link"},{default:v((()=>[k("编辑")])),_:2},1032,["onClick"])),[[ne,"oa:chaoxing-account:update"]]),I((h(),w(U,{onClick:e=>J(a.id),size:"small",danger:"",type:"link"},{default:v((()=>[k("删除")])),_:2},1032,["onClick"])),[[ne,"oa:chaoxing-account:delete"]]),I((h(),w(U,{onClick:e=>async function(e){const a={account:e.account,password:e.password,course:e.course,courseId:e.courseId,classId:e.classId,className:e.className,schoolid:e.schoolid,name:e.name,address:e.address,latitude:e.latitude,longitude:e.longitude};l.show();try{const e=await o.clockIn(a);e.ok?(c.success(e.data||"打卡成功"),setTimeout((()=>{H()}),500)):c.error(e.msg||"打卡失败")}catch(i){t.captureError(i)}finally{l.hide()}}(a),size:"small",type:"link"},{default:v((()=>[k("立即打卡")])),_:2},1032,["onClick"])),[[ne,"oa:chaoxing-account:clockIn"]]),I((h(),w(U,{onClick:e=>async function(e){const a=e.course;Q.value.showModal({...e,course:a})}(a),size:"small",type:"link"},{default:v((()=>[k("打卡历史")])),_:2},1032,["onClick"])),[[ne,"oa:chaoxing-account:detail"]])])),_:2},1024)):j("",!0)];var n})),_:1},8,["dataSource","columns","loading"]),b("div",N,[x(oe,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:S(a),defaultPageSize:A.pageSize,current:A.pageNum,"onUpdate:current":n[6]||(n[6]=e=>A.pageNum=e),pageSize:A.pageSize,"onUpdate:pageSize":n[7]||(n[7]=e=>A.pageSize=e),total:L.value,onChange:H,onShowSizeChange:H,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),x(i,{ref_key:"operateRef",ref:K,onRefresh:H},null,512)])),_:1}),x(d,{ref_key:"clockInHistoryModalRef",ref:Q},null,512)],64)}}};export{U as default};
