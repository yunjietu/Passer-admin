import{m as e}from"./moguding-account-api-_EuqUysM.js";import{_ as a}from"./index-ZxpkwSGJ.js";import{P as l}from"./@ant-design-rHMPkvPq.js";import{b as t}from"./ant-design-vue-DFQN5xdf.js";import{r as n,a as s,m as o,w as i,e as d,b2 as r,ag as u,o as c,bz as p,c as m,ah as y,b as v,J as g,ai as f,F as b,be as h,u as x,aY as k,aW as w}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const j=e=>(k("data-v-0992bf5a"),e=e(),w(),e),E={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#666"}},_={class:"day-price-input-row"},D={class:"day-price-tip"},C={class:"day-price-amount"},R=j((()=>f("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 将一次性扣除购买天数对应的费用 ",-1))),U={style:{"font-weight":"500",color:"#1677ff"}},A=j((()=>f("div",{style:{"margin-top":"4px",color:"#666","font-size":"12px"}}," 成功打卡立即扣减 1 天，扣完后自动禁用账号 ",-1))),I={class:"day-price-input-row"},z={class:"day-price-tip"},M={class:"day-price-amount"},O=j((()=>f("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 追加天数将立即扣费，并增加剩余天数 ",-1))),N=j((()=>f("span",{class:"account-info-tip"}," 点击获取账号详细信息（可选，如不获取将自动获取） ",-1))),F={style:{display:"flex","align-items":"center",gap:"8px"}},L=j((()=>f("span",{style:{color:"#666","font-size":"12px"}}," 开启后将使用透明图片打卡 ",-1))),P={key:0,style:{"margin-bottom":"16px"}},Y={style:{"margin-bottom":"8px","font-weight":"500",display:"flex","justify-content":"space-between","align-items":"center"}},K={key:0},q=j((()=>f("div",{style:{"margin-top":"8px"}},"上传图片",-1))),T={style:{"margin-top":"8px",color:"#666","font-size":"12px"}},$={key:0,style:{color:"#ff4d4f"}},W={key:1},B={style:{display:"flex","align-items":"center",gap:"8px"}},J=j((()=>f("span",{style:{color:"#666","font-size":"12px"}}," 开启后每天6点自动提交日报 ",-1))),S={style:{display:"flex","align-items":"center",gap:"8px"}},G=j((()=>f("span",{style:{color:"#666","font-size":"12px"}}," 开启后每周五晚上7点自动提交周报 ",-1))),H={style:{display:"flex","align-items":"center",gap:"8px"}},Q=j((()=>f("span",{style:{color:"#666","font-size":"12px"}}," 开启后每月15号晚上8点自动提交月报 ",-1))),V=j((()=>f("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}},[g(" 设置报告提交的天数限制，到期后自动关闭所有报告开关"),f("br"),g(" 范围：1-365天，默认180天 ")],-1))),X={class:"smart-modal-footer"},Z=a({__name:"moguding-account-form-modal",emits:["success"],setup(a,{expose:k,emit:w}){const j=w,Z=n(!1),ee=n(!1),ae=n(!1),le=n(!1),te=n(),ne=n([]),se=n([]),oe=n([]),ie=n(!1),de=n([]),re=s({id:null,account:"",password:"",name:"",position:"",companyName:"",companyAddress:"",status:1,transparentImageEnabled:0,dailyReportEnabled:!1,weeklyReportEnabled:!1,monthlyReportEnabled:!1,reportDaysLimit:null,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0}),ue=n(null),ce=n(!1),pe=o((()=>re.dailyReportEnabled||re.weeklyReportEnabled||re.monthlyReportEnabled)),me=o((()=>ee.value?"详细信息（点击展开）":"详细信息（点击展开，如不填写将自动获取）"));o((()=>"DAY"===re.billingMode));const ye=o((()=>null!==ue.value&&ue.value>0)),ve=o((()=>be(re.dayCount))),ge=o((()=>be(re.dayExtendDays)));async function fe(){ce.value=!0;try{const a=await e.getCurrentPrice();a.ok&&a.data&&void 0!==a.data.dayPrice&&null!==a.data.dayPrice?ue.value=Number(a.data.dayPrice):ue.value=null}catch(a){ue.value=null}finally{ce.value=!1}}function be(e){if(!ye.value)return"";const a=Number(e);return!a||a<=0?"":(a*ue.value).toFixed(2)}function he(){pe.value?re.reportDaysLimit||(re.reportDaysLimit=180):re.reportDaysLimit=null}i((()=>re.billingMode),(e=>{"DAY"!==e&&(re.dayCount=null,re.dayExtendDays=0)})),d((()=>{fe()}));const xe=async()=>{if(re.account&&re.password){le.value=!0;try{const a=await e.getAccountInfo(re.account,re.password);if(a.data){const e=re.billingMode;Object.assign(re,a.data),re.billingMode=e||"ACCOUNT",t.success("获取账号信息成功"),ne.value=["1"]}}catch(a){t.error("获取账号信息失败")}finally{le.value=!1}}else t.warning("请先输入工学云账号和密码")},ke=async()=>{try{await te.value.validate(),ae.value=!0;const l={...re};if(delete l.dayRemainingDays,ee.value?delete l.dayCount:delete l.dayExtendDays,ee.value){if(await e.update(l),t.success("更新成功"),oe.value.length>0)try{const a=new FormData;oe.value.forEach((e=>{e.originFileObj&&a.append("images",e.originFileObj)})),a.has("images")&&(await e.uploadImages(re.id,a),t.success("图片上传成功"))}catch(a){const e=a.response?.data?.msg||a.message||"图片上传失败";t.warning(`账号更新成功，但图片上传失败: ${e}`)}}else{re.name||re.position||re.companyName;const n=await e.add(l);if(t.success("添加成功"),oe.value.length>0)try{const a=new FormData;oe.value.forEach((e=>{e.originFileObj&&a.append("images",e.originFileObj)})),a.has("images")&&(await e.uploadImages(n.data,a),t.success("图片上传成功"))}catch(a){const e=a.response?.data?.msg||a.message||"图片上传失败";t.warning(`账号添加成功，但图片上传失败: ${e}`)}}Z.value=!1,j("success")}catch(a){t.error(ee.value?"更新失败":"添加失败")}finally{ae.value=!1}},we=()=>{Z.value=!1,oe.value=[],de.value=[],te.value?.resetFields()},je=e=>{if(re.transparentImageEnabled)return t.error("透明图片和自定义打卡图片只能选其一，请先关闭透明图片开关"),!1;if(!e.type.startsWith("image/"))return t.error("只能上传图片文件!"),!1;return e.size/1024/1024<10||t.error("图片大小不能超过 10MB!"),!1},Ee=async a=>{const{file:l,onSuccess:n,onError:s}=a;if(ee.value&&re.id){const a=new FormData;a.append("images",l);try{ie.value=!0;const l=await e.uploadImages(re.id,a);l.data&&(t.success("图片上传成功"),n(l.data))}catch(o){const e=o.response?.data?.msg||o.message||"图片上传失败";t.error(`图片上传失败: ${e}`),s(o)}finally{ie.value=!1}}else n("pending")},_e=e=>{const a=oe.value.findIndex((a=>a.uid===e.uid));a>-1&&oe.value.splice(a,1)},De=async a=>{if(a)try{const l=await e.getImages(a);l.data&&l.data.length>0&&(de.value=l.data)}catch(l){}},Ce=async()=>{try{await e.clearAllImages(re.id),de.value=[],t.success("所有图片已清空")}catch(a){t.error("清空图片失败")}},Re=e=>{e?(oe.value=[],ee.value&&re.id&&Ce(),t.info("已切换到透明图片模式，自定义图片已清空")):t.info("已切换到自定义图片模式")};return k({show:async a=>{if(Z.value=!0,fe(),oe.value=[],de.value=[],ne.value=[],se.value=[],a){ee.value=!0;try{const l=await e.getDetail(a.id);l.data&&(Object.assign(re,l.data),re.dayExtendDays=0)}catch(l){Object.assign(re,a)}De(a.id)}else ee.value=!1,Object.assign(re,{id:null,account:"",password:"",name:"",position:"",companyName:"",companyAddress:"",status:1,transparentImageEnabled:0,dailyReportEnabled:!1,weeklyReportEnabled:!1,monthlyReportEnabled:!1,reportDaysLimit:null,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0})}}),(e,a)=>{const t=r("a-input"),n=r("a-form-item"),s=r("a-radio"),o=r("a-radio-group"),i=r("a-input-number"),d=r("a-button"),k=r("a-collapse-panel"),w=r("a-collapse"),j=r("a-switch"),ie=r("a-upload"),ue=r("a-select-option"),fe=r("a-select"),be=r("a-form"),De=r("a-modal");return c(),u(De,{open:Z.value,"onUpdate:open":a[18]||(a[18]=e=>Z.value=e),title:ee.value?"编辑工学云账号":"新建工学云账号",width:800,onOk:ke,onCancel:we},{footer:p((()=>[f("div",X,[m(d,{onClick:we},{default:p((()=>[g("取消")])),_:1}),m(d,{type:"primary",onClick:ke,loading:ae.value},{default:p((()=>[g("确认")])),_:1},8,["loading"])])])),default:p((()=>[m(be,{ref_key:"formRef",ref:te,model:re,rules:{account:[{required:!0,message:"请输入工学云账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}],dayCount:[{validator:(e,a)=>ee.value||"DAY"!==re.billingMode||a&&!(a<=0)?Promise.resolve():Promise.reject("单天计费需填写购买天数"),trigger:"blur"}],dayExtendDays:[{validator:(e,a)=>ee.value&&"DAY"===re.billingMode&&null!=a&&a<0?Promise.reject("追加天数不能为负数"):Promise.resolve(),trigger:"blur"}]},"label-col":{span:6},"wrapper-col":{span:16}},{default:p((()=>[m(n,{label:"工学云账号",name:"account"},{default:p((()=>[m(t,{value:re.account,"onUpdate:value":a[0]||(a[0]=e=>re.account=e),placeholder:"请输入工学云账号",disabled:ee.value,id:"moguding-account-form-account-input"},null,8,["value","disabled"])])),_:1}),m(n,{label:"密码",name:"password"},{default:p((()=>[m(t,{value:re.password,"onUpdate:value":a[1]||(a[1]=e=>re.password=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),m(n,{label:"计费方式",name:"billingMode"},{default:p((()=>[m(o,{value:re.billingMode,"onUpdate:value":a[2]||(a[2]=e=>re.billingMode=e),disabled:ee.value},{default:p((()=>[m(s,{value:"ACCOUNT"},{default:p((()=>[g("单账号扣费")])),_:1}),m(s,{value:"DAY"},{default:p((()=>[g("单天扣费")])),_:1})])),_:1},8,["value","disabled"]),ee.value?(c(),v("div",E," 编辑状态下无法修改计费方式，如需调整请新建账号 ")):y("",!0)])),_:1}),ee.value||"DAY"!==re.billingMode?y("",!0):(c(),u(n,{key:0,label:"购买天数",name:"dayCount"},{default:p((()=>[f("div",null,[f("div",_,[m(i,{value:re.dayCount,"onUpdate:value":a[3]||(a[3]=e=>re.dayCount=e),min:1,max:360,precision:0,style:{width:"100px"}},null,8,["value"]),f("div",D,[ce.value?(c(),v(b,{key:0},[g(" 单价加载中... ")],64)):ye.value?(c(),v(b,{key:1},[g(" 预计扣费："),f("span",C,h(ve.value||"--"),1),g(" 元 ")],64)):(c(),v(b,{key:2},[g(" 未配置单天单价 ")],64))])]),R])])),_:1})),ee.value&&"DAY"===re.billingMode?(c(),v(b,{key:1},[m(n,{label:"剩余天数"},{default:p((()=>[f("div",null,[f("div",U,h(re.dayRemainingDays||0)+" 天 ",1),A])])),_:1}),m(n,{label:"追加天数",name:"dayExtendDays",style:{"margin-bottom":"-15px"}},{default:p((()=>[f("div",null,[f("div",I,[m(i,{value:re.dayExtendDays,"onUpdate:value":a[4]||(a[4]=e=>re.dayExtendDays=e),min:0,max:360,precision:0,placeholder:"输入追加天数",style:{width:"100px"}},null,8,["value"]),f("div",z,[ce.value?(c(),v(b,{key:0},[g(" 单价加载中... ")],64)):ye.value?(c(),v(b,{key:1},[g(" 预计扣费："),f("span",M,h(ge.value||"--"),1),g(" 元 ")],64)):(c(),v(b,{key:2},[g(" 未配置单天单价 ")],64))])]),O])])),_:1})],64)):y("",!0),ee.value?y("",!0):(c(),u(n,{key:2,"wrapper-col":{span:18,offset:3},style:{"margin-bottom":"8px"}},{default:p((()=>[m(d,{type:"primary",onClick:xe,loading:le.value,disabled:!re.account||!re.password},{default:p((()=>[g(" 获取账号信息 ")])),_:1},8,["loading","disabled"]),N])),_:1})),m(w,{activeKey:ne.value,"onUpdate:activeKey":a[9]||(a[9]=e=>ne.value=e),ghost:"",style:{"margin-top":"-8px"}},{default:p((()=>[m(k,{key:"1",header:me.value},{default:p((()=>[m(n,{label:"姓名",name:"name"},{default:p((()=>[m(t,{value:re.name,"onUpdate:value":a[5]||(a[5]=e=>re.name=e),placeholder:"请输入姓名"},null,8,["value"])])),_:1}),m(n,{label:"职位",name:"position"},{default:p((()=>[m(t,{value:re.position,"onUpdate:value":a[6]||(a[6]=e=>re.position=e),placeholder:"请输入职位"},null,8,["value"])])),_:1}),m(n,{label:"公司名称",name:"companyName"},{default:p((()=>[m(t,{value:re.companyName,"onUpdate:value":a[7]||(a[7]=e=>re.companyName=e),placeholder:"请输入公司名称"},null,8,["value"])])),_:1}),m(n,{label:"公司地址",name:"companyAddress"},{default:p((()=>[m(t,{value:re.companyAddress,"onUpdate:value":a[8]||(a[8]=e=>re.companyAddress=e),placeholder:"请输入公司地址"},null,8,["value"])])),_:1})])),_:1},8,["header"])])),_:1},8,["activeKey"]),m(n,{label:"透明图片",name:"transparentImageEnabled"},{default:p((()=>[f("div",F,[m(j,{checked:re.transparentImageEnabled,"onUpdate:checked":a[10]||(a[10]=e=>re.transparentImageEnabled=e),"checked-value":1,"un-checked-value":0,onChange:Re},null,8,["checked"]),L])])),_:1}),m(n,{label:"打卡图片",name:"clockImages"},{default:p((()=>[f("div",null,[ee.value&&de.value.length>0&&!re.transparentImageEnabled?(c(),v("div",P,[f("div",Y,[f("span",null,"已上传的图片："+h(de.value.length)+"张",1),m(d,{type:"primary",danger:"",size:"small",onClick:Ce},{default:p((()=>[g(" 清空所有图片 ")])),_:1})])])):y("",!0),m(ie,{"file-list":oe.value,"onUpdate:fileList":a[11]||(a[11]=e=>oe.value=e),multiple:!0,"before-upload":je,onRemove:_e,"custom-request":Ee,"list-type":"picture-card",accept:"image/*","max-count":10,disabled:!!re.transparentImageEnabled},{default:p((()=>[oe.value.length<10?(c(),v("div",K,[m(x(l)),q])):y("",!0)])),_:1},8,["file-list","disabled"]),f("div",T,[re.transparentImageEnabled?(c(),v("span",$," 透明图片和自定义打卡图片只能选其一，当前已选择透明图片 ")):(c(),v("span",W," 支持上传多张图片，系统会随机选择一张进行带图打卡（最多10张） "))])])])),_:1}),m(w,{activeKey:se.value,"onUpdate:activeKey":a[16]||(a[16]=e=>se.value=e),ghost:""},{default:p((()=>[m(k,{key:"2",header:"报告配置（点击展开，如不配置将默认关闭）"},{default:p((()=>[m(n,{label:"日报开关",name:"dailyReportEnabled"},{default:p((()=>[f("div",B,[m(j,{checked:re.dailyReportEnabled,"onUpdate:checked":a[12]||(a[12]=e=>re.dailyReportEnabled=e),"checked-value":!0,"un-checked-value":!1,onChange:he},null,8,["checked"]),J])])),_:1}),m(n,{label:"周报开关",name:"weeklyReportEnabled"},{default:p((()=>[f("div",S,[m(j,{checked:re.weeklyReportEnabled,"onUpdate:checked":a[13]||(a[13]=e=>re.weeklyReportEnabled=e),"checked-value":!0,"un-checked-value":!1,onChange:he},null,8,["checked"]),G])])),_:1}),m(n,{label:"月报开关",name:"monthlyReportEnabled"},{default:p((()=>[f("div",H,[m(j,{checked:re.monthlyReportEnabled,"onUpdate:checked":a[14]||(a[14]=e=>re.monthlyReportEnabled=e),"checked-value":!0,"un-checked-value":!1,onChange:he},null,8,["checked"]),Q])])),_:1}),pe.value?(c(),u(n,{key:0,label:"报告天数限制",name:"reportDaysLimit"},{default:p((()=>[f("div",null,[m(i,{value:re.reportDaysLimit,"onUpdate:value":a[15]||(a[15]=e=>re.reportDaysLimit=e),min:1,max:365,placeholder:"请输入报告天数",style:{width:"200px"}},null,8,["value"]),V])])),_:1})):y("",!0)])),_:1})])),_:1},8,["activeKey"]),m(n,{label:"状态",name:"status"},{default:p((()=>[m(fe,{value:re.status,"onUpdate:value":a[17]||(a[17]=e=>re.status=e),placeholder:"请选择状态",id:"moguding-account-form-status-select"},{default:p((()=>[m(ue,{value:1},{default:p((()=>[g("启用")])),_:1}),m(ue,{value:0},{default:p((()=>[g("禁用")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["open","title"])}}},[["__scopeId","data-v-0992bf5a"]]);export{Z as default};
