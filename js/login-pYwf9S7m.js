import{u as a}from"./vue-router-BJIyZwNj.js";import{_ as e,O as s,S as l,l as t,A as o,K as i,I as c,z as r,r as n,u,Q as d,s as p}from"./index-ZxpkwSGJ.js";import{l as m,w as v,a as g,d as h,q as f,b as j,f as y,g as b}from"./google-icon-BXU_orIT.js";import{b as w}from"./ant-design-vue-DFQN5xdf.js";import{a as C,r as _,e as k,l as x,b2 as U,b as I,o as E,ai as N,c as q,u as D,bz as z,ag as S,ah as A,J as L,be as M,aY as O,aW as F}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const K=a=>(O("data-v-4be6c62a"),a=a(),F(),a),R={class:"login-container"},T=K((()=>N("div",{class:"box-item desc"},[N("div",{class:"welcome"},[N("p",null,"欢迎登录 SmartAdmin V3"),N("p",{class:"sub-welcome"},"「高质量代码、简洁、安全」的开发平台")])],-1))),$={class:"box-item login"},B=["src"],J=K((()=>N("div",{class:"login-title"},"账号登录",-1))),P=["src"],Q=K((()=>N("span",null," ( 账号：admin, 密码：123456)",-1))),V={class:"more"},W=K((()=>N("div",{class:"title-box"},[N("p",{class:"line"}),N("p",{class:"title"},"其他方式登录"),N("p",{class:"line"})],-1))),Y={class:"login-type"},G=["src"],H=["src"],X=["src"],Z=["src"],aa=["src"],ea=["src"],sa=["src"],la=e({__name:"login",setup(e){const O=C({loginName:"admin",password:"",captchaCode:"",captchaUuid:"",loginDevice:s.PC.value}),F={loginName:[{required:!0,message:"用户名不能为空"}],password:[{required:!0,message:"密码不能为空"}],captchaCode:[{required:!0,message:"验证码不能为空"}]},K=_(!1),la=a(),ta=_(),oa=_(!1);async function ia(){ta.value.validate().then((async()=>{try{l.show();let a=Object.assign({},O,{password:t(O.password)});const e=await o.login(a);null!=na&&(clearInterval(na),na=null),i(c.USER_TOKEN,e.data.token?e.data.token:""),w.success("登录成功"),r().setUserLoginInfo(e.data);const s=await n.getAllDictData();u().initData(s.data),d(),la.push("/home")}catch(a){a.data&&0!==a.data.code&&(O.captchaCode="",ra()),p.captureError(a)}finally{l.hide()}}))}k((()=>{document.onkeyup=a=>{13===a.keyCode&&ia()}})),x((()=>{document.onkeyup=null}));const ca=_("");async function ra(){try{let e=await o.getCaptcha();ca.value=e.data.captchaBase64Image,O.captchaUuid=e.data.captchaUuid,a=e.data.expireSeconds,null===na&&(na=setInterval(ra,1e3*(a-5)))}catch(e){}var a}let na=null;k((()=>{ra(),async function(){try{let a=await o.getTwoFactorLoginFlag();ua.value=a.data}catch(a){p.captureError(a)}}()}));const ua=_(!1);let da=_("获取邮箱验证码"),pa=_(!1),ma=null;async function va(){try{l.show();await o.sendLoginEmailCode(O.loginName);w.success("验证码发送成功!请登录邮箱查看验证码~"),function(){pa.value=!0;let a=60;da.value=`${a}秒后重新获取`,ma=setInterval((()=>{a>1?(a--,da.value=`${a}秒后重新获取`):(clearInterval(ma),pa.value=!1,da.value="获取验证码")}),1e3)}()}catch(a){p.captureError(a)}finally{l.hide()}}return(a,e)=>{const s=U("a-input"),l=U("a-form-item"),t=U("a-button"),o=U("a-input-group"),i=U("a-input-password"),c=U("a-checkbox"),r=U("a-form");return E(),I("div",R,[T,N("div",$,[N("img",{class:"login-qr",src:D(m)},null,8,B),J,q(r,{ref_key:"formRef",ref:ta,class:"login-form",model:O,rules:F},{default:z((()=>[q(l,{name:"loginName"},{default:z((()=>[q(s,{value:O.loginName,"onUpdate:value":e[0]||(e[0]=a=>O.loginName=a),valueModifiers:{trim:!0},placeholder:"请输入用户名"},null,8,["value"])])),_:1}),ua.value?(E(),S(l,{key:0,name:"emailCode"},{default:z((()=>[q(o,{compact:""},{default:z((()=>[q(s,{style:{width:"calc(100% - 110px)"},value:O.emailCode,"onUpdate:value":e[1]||(e[1]=a=>O.emailCode=a),autocomplete:"on",placeholder:"请输入邮箱验证码"},null,8,["value"]),q(t,{onClick:va,class:"code-btn",type:"primary",disabled:D(pa)},{default:z((()=>[L(M(D(da)),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):A("",!0),q(l,{name:"password"},{default:z((()=>[q(i,{value:O.password,"onUpdate:value":e[2]||(e[2]=a=>O.password=a),autocomplete:"on",type:K.value?"text":"password",placeholder:"请输入密码"},null,8,["value","type"])])),_:1}),q(l,{name:"captchaCode"},{default:z((()=>[q(s,{class:"captcha-input",value:O.captchaCode,"onUpdate:value":e[3]||(e[3]=a=>O.captchaCode=a),valueModifiers:{trim:!0},placeholder:"请输入验证码"},null,8,["value"]),N("img",{class:"captcha-img",src:ca.value,onClick:ra},null,8,P)])),_:1}),q(l,null,{default:z((()=>[q(c,{checked:oa.value,"onUpdate:checked":e[4]||(e[4]=a=>oa.value=a)},{default:z((()=>[L("记住密码")])),_:1},8,["checked"]),Q])),_:1}),q(l,null,{default:z((()=>[N("div",{class:"btn",onClick:ia},"登录")])),_:1})])),_:1},8,["model"]),N("div",V,[W,N("div",Y,[N("img",{src:D(v)},null,8,G),N("img",{src:D(g)},null,8,H),N("img",{src:D(h)},null,8,X),N("img",{src:D(f)},null,8,Z),N("img",{src:D(j)},null,8,aa),N("img",{src:D(y)},null,8,ea),N("img",{src:D(b)},null,8,sa)])])])])}}},[["__scopeId","data-v-4be6c62a"]]);export{la as default};
