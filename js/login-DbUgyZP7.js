import{u as a}from"./vue-router-BJIyZwNj.js";import{_ as e,O as s,S as l,l as t,A as o,K as i,I as c,z as r,r as n,u,Q as d,s as p}from"./index-ZxpkwSGJ.js";import{l as m,w as v,a as g,d as f,q as h,b as j,f as y,g as w}from"./google-icon-BXU_orIT.js";import{_ as b}from"./login-min-CFM8YJwT.js";import{b as _}from"./ant-design-vue-DFQN5xdf.js";import{a as C,r as k,e as x,l as U,b2 as I,b as N,o as E,ai as q,be as D,u as z,c as L,bz as M,ag as O,ah as S,J as A,aY as F,aW as K}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const R=a=>(F("data-v-74f2fd98"),a=a(),K(),a),T={class:"login-container"},$={class:"box-item desc"},B={class:"welcome"},J=R((()=>q("p",{class:"sub-welcome"},"高质量、简洁、高效、安全",-1))),P=["src"],Q={class:"box-item login"},W=["src"],Y={class:"mobile-welcome"},G=R((()=>q("div",{class:"login-title"},"账号登录",-1))),H=["src"],V={class:"register-tip"},X=R((()=>q("span",null,"还没有账号？",-1))),Z={class:"more"},aa=R((()=>q("div",{class:"title-box"},[q("p",{class:"line"}),q("p",{class:"title"},"其他方式登录"),q("p",{class:"line"})],-1))),ea={class:"login-type"},sa=["src"],la=["src"],ta=["src"],oa=["src"],ia=["src"],ca=["src"],ra=["src"],na=e({__name:"login",setup(e){const F="高端定制打卡系统",K=C({loginName:"",password:"",captchaCode:"",captchaUuid:"",loginDevice:s.PC.value}),R={loginName:[{required:!0,message:"用户名不能为空"}],password:[{required:!0,message:"密码不能为空"}],captchaCode:[{required:!0,message:"验证码不能为空"}]},na=k(!1),ua=a(),da=k(),pa=k(!1);async function ma(){da.value.validate().then((async()=>{try{l.show();let a=Object.assign({},K,{password:t(K.password)});const e=await o.login(a);null!=fa&&(clearInterval(fa),fa=null),i(c.USER_TOKEN,e.data.token?e.data.token:""),_.success("登录成功"),r().setUserLoginInfo(e.data);const s=await n.getAllDictData();u().initData(s.data),d(),ua.push("/home")}catch(a){a.data&&0!==a.data.code&&(K.captchaCode="",ga()),p.captureError(a)}finally{l.hide()}}))}x((()=>{document.onkeyup=a=>{13===a.keyCode&&ma()}})),U((()=>{document.onkeyup=null}));const va=k("");async function ga(){try{let e=await o.getCaptcha();va.value=e.data.captchaBase64Image,K.captchaUuid=e.data.captchaUuid,a=e.data.expireSeconds,null===fa&&(fa=setInterval(ga,1e3*(a-5)))}catch(e){}var a}let fa=null;x((()=>{ga(),async function(){try{let a=await o.getTwoFactorLoginFlag();ha.value=a.data}catch(a){p.captureError(a)}}()}));const ha=k(!1);let ja=k("获取邮箱验证码"),ya=k(!1),wa=null;async function ba(){try{l.show();await o.sendLoginEmailCode(K.loginName);_.success("验证码发送成功!请登录邮箱查看验证码~"),function(){ya.value=!0;let a=60;ja.value=`${a}秒后重新获取`,wa=setInterval((()=>{a>1?(a--,ja.value=`${a}秒后重新获取`):(clearInterval(wa),ya.value=!1,ja.value="获取验证码")}),1e3)}()}catch(a){p.captureError(a)}finally{l.hide()}}return(a,e)=>{const s=I("a-input"),l=I("a-form-item"),t=I("a-button"),o=I("a-input-group"),i=I("a-input-password"),c=I("a-checkbox"),r=I("a-form"),n=I("router-link");return E(),N("div",T,[q("div",$,[q("div",B,[q("p",null,"欢迎登录"+D(z(F)),1),J]),q("img",{class:"welcome-img",src:z(b)},null,8,P)]),q("div",Q,[q("img",{class:"login-qr",src:z(m)},null,8,W),q("div",Y,"欢迎登录"+D(z(F)),1),G,L(r,{ref_key:"formRef",ref:da,class:"login-form",model:K,rules:R},{default:M((()=>[L(l,{name:"loginName"},{default:M((()=>[L(s,{value:K.loginName,"onUpdate:value":e[0]||(e[0]=a=>K.loginName=a),valueModifiers:{trim:!0},placeholder:"请输入账号"},null,8,["value"])])),_:1}),ha.value?(E(),O(l,{key:0,name:"emailCode"},{default:M((()=>[L(o,{compact:""},{default:M((()=>[L(s,{style:{width:"calc(100% - 110px)"},value:K.emailCode,"onUpdate:value":e[1]||(e[1]=a=>K.emailCode=a),autocomplete:"on",placeholder:"请输入邮箱验证码"},null,8,["value"]),L(t,{onClick:ba,class:"code-btn",type:"primary",disabled:z(ya)},{default:M((()=>[A(D(z(ja)),1)])),_:1},8,["disabled"])])),_:1})])),_:1})):S("",!0),L(l,{name:"password"},{default:M((()=>[L(i,{value:K.password,"onUpdate:value":e[2]||(e[2]=a=>K.password=a),autocomplete:"on",type:na.value?"text":"password",placeholder:"请输入密码：至少三种字符，最小 8 位"},null,8,["value","type"])])),_:1}),L(l,{name:"captchaCode"},{default:M((()=>[L(s,{class:"captcha-input",value:K.captchaCode,"onUpdate:value":e[3]||(e[3]=a=>K.captchaCode=a),valueModifiers:{trim:!0},placeholder:"请输入验证码"},null,8,["value"]),q("img",{class:"captcha-img",src:va.value,onClick:ga},null,8,H)])),_:1}),L(l,null,{default:M((()=>[L(c,{checked:pa.value,"onUpdate:checked":e[4]||(e[4]=a=>pa.value=a)},{default:M((()=>[A("记住密码")])),_:1},8,["checked"])])),_:1}),L(l,null,{default:M((()=>[q("div",{class:"btn",onClick:ma},"登录")])),_:1})])),_:1},8,["model"]),q("div",V,[X,L(n,{to:"/register",class:"register-link"},{default:M((()=>[A("立即注册")])),_:1})]),q("div",Z,[aa,q("div",ea,[q("img",{src:z(v)},null,8,sa),q("img",{src:z(g)},null,8,la),q("img",{src:z(f)},null,8,ta),q("img",{src:z(h)},null,8,oa),q("img",{src:z(j)},null,8,ia),q("img",{src:z(y)},null,8,ca),q("img",{src:z(w)},null,8,ra)])])])])}}},[["__scopeId","data-v-74f2fd98"]]);export{na as default};
