import{a as e}from"./account-api-Ia2S-UTU.js";import{_ as a,s as t}from"./index-ZxpkwSGJ.js";import{d as r}from"./dayjs-CSPdbndm.js";import{ap as o}from"./@ant-design-rHMPkvPq.js";import{b as s}from"./ant-design-vue-DFQN5xdf.js";import{r as n,a as l,m as i,b2 as u,ag as m,o as d,bz as p,c,ah as w,J as y,u as k,n as v,ai as g,aY as h,aW as j}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const f=(e=>(h("data-v-49d73202"),e=e(),j(),e))((()=>g("span",{style:{"margin-left":"8px",color:"#666"}}," 开启后将自动生成报告内容，也可手动修改 ",-1))),b=a({__name:"report-submit-modal",emits:["close","refresh"],setup(a,{expose:g,emit:h}){const j=n(),b=h,T=n(!1),A=n(!1),_=n(!1),R={reportType:"day",startTime:null,timeRange:null,workAddress:"",workContent:"",workSummary:"",workProject:"",useAiGeneration:!0,uid:"",token:"",deviceId:"",major:""},C=l({...R}),x=l({show:!1,type:"success",message:"",description:""}),G=i((()=>({reportType:[{required:!0,message:"请选择报告类型"}],startTime:[{required:!0,message:"请选择报告日期",trigger:"change"}],timeRange:[{required:!0,message:"请选择报告时间段",trigger:"change"}],workAddress:[{required:!0,message:"请输入工作地址"}],workContent:C.useAiGeneration?[]:[{required:!0,message:"请输入工作内容"}],workSummary:C.useAiGeneration?[]:[{required:!0,message:"请输入工作总结"}],workProject:C.useAiGeneration?[]:[{required:!0,message:"请输入工作项目"}]}))),Y=i((()=>({day:"提交日报",week:"提交周报",month:"提交月报"}[C.reportType]||"提交报告"))),P=()=>{C.useAiGeneration&&(C.workContent="",C.workSummary="",C.workProject=""),v((()=>{j.value?.clearValidate(["workContent","workSummary","workProject"])}))},I=e=>e&&e>r().endOf("day");function S(){T.value=!1,b("close")}function U(){C.startTime=null,C.timeRange=null,v((()=>{j.value?.clearValidate(["startTime","timeRange"])}))}async function q(){try{_.value=!0;const a=await e.generateAiReportContent({reportType:C.reportType,jobName:C.major||"实习岗位"});a.data&&(C.workContent=a.data.workContent||"",C.workSummary=a.data.workSummary||"",C.workProject=a.data.workProject||"",s.success("AI内容生成成功"))}catch(a){s.error("AI内容生成失败："+a.message),t.captureError(a)}finally{_.value=!1}}async function D(){try{await j.value.validate(),A.value=!0;let a={...C};"day"===C.reportType?a.startTime=C.startTime?r(C.startTime).format("YYYY-MM-DD"):null:C.timeRange&&2===C.timeRange.length&&(a.startTime=r(C.timeRange[0]).format("YYYY-MM-DD"),a.endTime=r(C.timeRange[1]).format("YYYY-MM-DD")),delete a.timeRange,C.useAiGeneration&&(a.workContent="",a.workSummary="",a.workProject=""),a.jobName=C.major||"实习岗位";const t=await e.submitReport(a);t.data&&t.data.success?(x.show=!0,x.type="success",x.message="报告提交成功",x.description=`${"day"===t.data.reportType?"日报":"week"===t.data.reportType?"周报":"月报"} 已成功提交，时间段：${t.data.reportPeriod}`,s.success("报告提交成功"),b("refresh"),setTimeout((()=>{S()}),3e3)):(x.show=!0,x.type="error",x.message="报告提交失败",x.description=t.data?.message||"未知错误")}catch(a){x.show=!0,x.type="error",x.message="报告提交失败",x.description=a.message||"网络错误，请稍后重试",t.captureError(a)}finally{A.value=!1}}return g({showModal:function(e){e&&e.userId?(Object.assign(C,{...R,uid:e.userId,token:e.token,deviceId:e.deviceId,workAddress:e.contractEnterprise||"",major:e.major||""}),x.show=!1,T.value=!0,v((()=>{j.value?.clearValidate()}))):s.error("账号信息不完整，请先登录账号获取信息")}}),(e,a)=>{const t=u("a-select-option"),r=u("a-select"),s=u("a-form-item"),n=u("a-date-picker"),l=u("a-range-picker"),i=u("a-switch"),v=u("a-button"),g=u("a-input"),h=u("a-textarea"),b=u("a-form"),R=u("a-modal");return d(),m(R,{open:T.value,title:Y.value,width:700,forceRender:"","ok-text":"确认","cancel-text":"取消","confirm-loading":A.value,onOk:D,onCancel:S},{default:p((()=>[c(b,{ref_key:"formRef",ref:j,model:C,rules:G.value,"label-col":{span:5},"wrapper-col":{span:18}},{default:p((()=>[c(s,{label:"报告类型",name:"reportType"},{default:p((()=>[c(r,{value:C.reportType,"onUpdate:value":a[0]||(a[0]=e=>C.reportType=e),placeholder:"请选择报告类型",onChange:U},{default:p((()=>[c(t,{value:"day"},{default:p((()=>[y("日报")])),_:1}),c(t,{value:"week"},{default:p((()=>[y("周报")])),_:1}),c(t,{value:"month"},{default:p((()=>[y("月报")])),_:1})])),_:1},8,["value"])])),_:1}),"day"===C.reportType?(d(),m(s,{key:0,label:"报告日期",name:"startTime"},{default:p((()=>[c(n,{value:C.startTime,"onUpdate:value":a[1]||(a[1]=e=>C.startTime=e),placeholder:"选择报告日期",style:{width:"100%"},"disabled-date":I},null,8,["value"])])),_:1})):"week"===C.reportType?(d(),m(s,{key:1,label:"报告周期",name:"timeRange"},{default:p((()=>[c(l,{value:C.timeRange,"onUpdate:value":a[2]||(a[2]=e=>C.timeRange=e),placeholder:"选择报告周期",style:{width:"100%"},"disabled-date":I},null,8,["value"])])),_:1})):"month"===C.reportType?(d(),m(s,{key:2,label:"报告月份",name:"timeRange"},{default:p((()=>[c(l,{value:C.timeRange,"onUpdate:value":a[3]||(a[3]=e=>C.timeRange=e),placeholder:"选择报告月份",style:{width:"100%"},"disabled-date":I},null,8,["value"])])),_:1})):w("",!0),c(s,{label:"内容生成",name:"useAiGeneration"},{default:p((()=>[c(i,{checked:C.useAiGeneration,"onUpdate:checked":a[4]||(a[4]=e=>C.useAiGeneration=e),"checked-children":"AI生成","un-checked-children":"手动填写",onChange:P},null,8,["checked"]),f])),_:1}),C.useAiGeneration?w("",!0):(d(),m(s,{key:3,label:"快速生成"},{default:p((()=>[c(v,{type:"dashed",loading:_.value,onClick:q,style:{width:"100%"}},{icon:p((()=>[c(k(o))])),default:p((()=>[y(" 使用AI生成报告内容 ")])),_:1},8,["loading"])])),_:1})),c(s,{label:"工作地址",name:"workAddress"},{default:p((()=>[c(g,{value:C.workAddress,"onUpdate:value":a[5]||(a[5]=e=>C.workAddress=e),placeholder:"请输入工作地址",maxlength:200,"show-count":""},null,8,["value"])])),_:1}),C.useAiGeneration?w("",!0):(d(),m(s,{key:4,label:"工作内容",name:"workContent"},{default:p((()=>[c(h,{value:C.workContent,"onUpdate:value":a[6]||(a[6]=e=>C.workContent=e),placeholder:"请输入工作内容",rows:4,maxlength:2e3,"show-count":""},null,8,["value"])])),_:1})),C.useAiGeneration?w("",!0):(d(),m(s,{key:5,label:"工作总结",name:"workSummary"},{default:p((()=>[c(h,{value:C.workSummary,"onUpdate:value":a[7]||(a[7]=e=>C.workSummary=e),placeholder:"请输入工作总结",rows:3,maxlength:2e3,"show-count":""},null,8,["value"])])),_:1})),C.useAiGeneration?w("",!0):(d(),m(s,{key:6,label:"工作项目",name:"workProject"},{default:p((()=>[c(g,{value:C.workProject,"onUpdate:value":a[8]||(a[8]=e=>C.workProject=e),placeholder:"请输入工作项目",maxlength:1e3,"show-count":""},null,8,["value"])])),_:1}))])),_:1},8,["model","rules"])])),_:1},8,["open","title","confirm-loading"])}}},[["__scopeId","data-v-49d73202"]]);export{b as default};
