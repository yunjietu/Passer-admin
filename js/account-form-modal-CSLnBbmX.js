import{j as e}from"./jwxt-account-api-qQmGFGXi.js";import{_ as a}from"./index-ZxpkwSGJ.js";import{b as l}from"./ant-design-vue-DFQN5xdf.js";import{r as s,a as i,m as d,w as t,e as o,b2 as r,ag as n,o as u,bz as c,c as p,ah as m,ai as y,b as v,J as g,F as b,be as f,n as j,aY as x,aW as w}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const C=e=>(x("data-v-5f1789ca"),e=e(),w(),e),D={key:0,style:{"margin-top":"6px",color:"#666","font-size":"12px"}},_={class:"day-price-input-row"},h={class:"day-price-tip"},P={class:"day-price-amount"},E=C((()=>y("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 将一次性扣除购买天数对应的费用 ",-1))),k={style:{"font-weight":"600",color:"#1677ff"}},M=C((()=>y("div",{style:{"margin-top":"4px",color:"#666","font-size":"12px"}}," 签到成功会自动扣减 1 天，天数耗尽将自动禁用账号 ",-1))),U={class:"day-price-input-row"},F={class:"day-price-tip"},N={class:"day-price-amount"},A=C((()=>y("div",{style:{"margin-top":"8px",color:"#666","font-size":"12px"}}," 追加天数将立即扣费，并增加剩余天数 ",-1))),O=a({__name:"account-form-modal",emits:["close","success"],setup(a,{expose:x,emit:w}){const C=w,O=s(!1),z=s(!1),I=s(),R=i({id:null,userCode:"",password:"",semesterId:"",disabledFlag:!1,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0}),T=d((()=>!!R.id)),Y=d((()=>"DAY"===R.billingMode)),q=i({accountPrice:null,dayPrice:null}),J=s(!1),V=d((()=>null!==q.dayPrice&&Number(q.dayPrice)>0)),W=d((()=>H(R.dayCount))),B=d((()=>H(R.dayExtendDays)));t((()=>R.billingMode),(e=>{"DAY"!==e&&(R.dayCount=null,R.dayExtendDays=0)}));const G={userCode:[{required:!0,message:"请输入学号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],billingMode:[{required:!0,message:"请选择计费方式",trigger:"change"}],dayCount:[{validator:(e,a)=>!Y.value||T.value?Promise.resolve():!a||a<=0?Promise.reject(new Error("请输入购买天数")):Promise.resolve(),trigger:"change"}],dayExtendDays:[{validator:(e,a)=>Y.value&&T.value&&a&&(a<=0||!Number.isInteger(Number(a)))?Promise.reject(new Error("追加天数必须为正整数")):Promise.resolve(),trigger:"change"}]};function H(e){if(!Y.value||!V.value)return"";const a=Number(e);return!a||a<=0?"":(a*Number(q.dayPrice)).toFixed(2)}async function K(){J.value=!0;try{const a=await e.getCurrentPrice();a.ok&&a.data?(q.accountPrice=a.data.price??null,q.dayPrice=a.data.dayPrice??null):(q.accountPrice=null,q.dayPrice=null)}catch(a){q.accountPrice=null,q.dayPrice=null}finally{J.value=!1}}async function L(){try{await I.value.validate(),z.value=!0;const a={userCode:R.userCode,password:R.password,semesterId:R.semesterId,disabledFlag:R.disabledFlag,billingMode:R.billingMode,dayCount:!T.value&&Y.value&&R.dayCount?R.dayCount:null,dayExtendDays:T.value&&Y.value&&R.dayExtendDays?R.dayExtendDays:null};R.id&&(a.id=R.id),R.id?(await e.update(a),l.success("编辑成功")):(await e.createAccount(a),l.success("添加成功")),C("success"),Q()}catch(a){}finally{z.value=!1}}function Q(){O.value=!1,C("close")}return o((()=>{K()})),x({show:function(e){Object.assign(R,{id:null,userCode:"",password:"",semesterId:"",disabledFlag:!1,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0}),e&&e.id?Object.assign(R,{...e,password:e.password||"",billingMode:e.billingMode||"ACCOUNT",dayRemainingDays:e.dayRemainingDays??0,dayExtendDays:0}):e&&Object.assign(R,e),O.value=!0,j((()=>{I.value?.clearValidate()})),K()}}),(e,a)=>{const l=r("a-input"),s=r("a-form-item"),i=r("a-input-password"),d=r("a-radio"),t=r("a-radio-group"),o=r("a-input-number"),j=r("a-form"),x=r("a-modal");return u(),n(x,{title:T.value?"编辑账号":"新建账号",open:O.value,onOk:L,onCancel:Q,"confirm-loading":z.value,width:"640px"},{default:c((()=>[p(j,{ref_key:"formRef",ref:I,model:R,rules:G,"label-col":{span:6},"wrapper-col":{span:16}},{default:c((()=>[p(s,{label:"学号",name:"userCode"},{default:c((()=>[p(l,{id:"jwxt-modal-user-code",value:R.userCode,"onUpdate:value":a[0]||(a[0]=e=>R.userCode=e),placeholder:"请输入学号"},null,8,["value"])])),_:1}),p(s,{label:"密码",name:"password"},{default:c((()=>[p(i,{value:R.password,"onUpdate:value":a[1]||(a[1]=e=>R.password=e),placeholder:"请输入密码"},null,8,["value"])])),_:1}),p(s,{label:"计费方式",name:"billingMode"},{default:c((()=>[y("div",null,[p(t,{value:R.billingMode,"onUpdate:value":a[2]||(a[2]=e=>R.billingMode=e),disabled:T.value},{default:c((()=>[p(d,{value:"ACCOUNT"},{default:c((()=>[g("单账号扣费")])),_:1}),p(d,{value:"DAY"},{default:c((()=>[g("单天扣费")])),_:1})])),_:1},8,["value","disabled"]),T.value?(u(),v("div",D," 编辑状态下无法修改计费方式，如需调整请新建账号 ")):m("",!0)])])),_:1}),!T.value&&Y.value?(u(),n(s,{key:0,label:"购买天数",name:"dayCount"},{default:c((()=>[y("div",null,[y("div",_,[p(o,{value:R.dayCount,"onUpdate:value":a[3]||(a[3]=e=>R.dayCount=e),min:1,max:360,precision:0,placeholder:"请输入天数",style:{width:"150px"}},null,8,["value"]),y("div",h,[J.value?(u(),v(b,{key:0},[g(" 单价加载中... ")],64)):V.value?(u(),v(b,{key:1},[g(" 预计扣费："),y("span",P,f(W.value||"--"),1),g(" 元 ")],64)):(u(),v(b,{key:2},[g(" 未配置单天单价，请先在单价设置 ")],64))])]),E])])),_:1})):m("",!0),T.value&&Y.value?(u(),n(s,{key:1,label:"剩余天数"},{default:c((()=>[y("div",null,[y("div",k,f(R.dayRemainingDays??0)+" 天",1),M])])),_:1})):m("",!0),T.value&&Y.value?(u(),n(s,{key:2,label:"追加天数",name:"dayExtendDays"},{default:c((()=>[y("div",null,[y("div",U,[p(o,{value:R.dayExtendDays,"onUpdate:value":a[4]||(a[4]=e=>R.dayExtendDays=e),min:0,max:360,precision:0,placeholder:"输入追加天数",style:{width:"150px"}},null,8,["value"]),y("div",F,[J.value?(u(),v(b,{key:0},[g(" 单价加载中... ")],64)):V.value?(u(),v(b,{key:1},[g(" 预计扣费："),y("span",N,f(B.value||"--"),1),g(" 元 ")],64)):(u(),v(b,{key:2},[g(" 未配置单天单价，请先在单价设置 ")],64))])]),A])])),_:1})):m("",!0),p(s,{label:"状态",name:"disabledFlag"},{default:c((()=>[p(t,{value:R.disabledFlag,"onUpdate:value":a[5]||(a[5]=e=>R.disabledFlag=e)},{default:c((()=>[p(d,{value:!1},{default:c((()=>[g("启用")])),_:1}),p(d,{value:!0},{default:c((()=>[g("禁用")])),_:1})])),_:1},8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open","confirm-loading"])}}},[["__scopeId","data-v-5f1789ca"]]);export{O as default};
