import{r as e,a as l,b2 as a,b as t,o as i,c as o,bz as s,y as n,F as u,b0 as r,ag as d,J as c,be as m,ai as p,E as v,u as f,n as h}from"./@vue-wTDZSr7R.js";import{_ as b}from"./lodash-DJa03WnC.js";import{d as y}from"./dayjs-CSPdbndm.js";import{_ as g,U as j,F as _,s as T,S as w}from"./index-ZxpkwSGJ.js";import{n as F}from"./notice-api-DZe8g0W4.js";import{W as I}from"./index-C8zfmN9n.js";import k from"./notice-form-visible-modal-DmgOFmPh.js";import{M as x,b as C}from"./ant-design-vue-DFQN5xdf.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./@wangeditor-next-BWE1cd2r.js";import"./notice-form-visible-transfer-department-Cm7ljbE1.js";import"./department-api-BBQ_I4Vj.js";import"./notice-form-visible-transfer-employee-DBBfDgVM.js";const V={class:"visible-list"},L="YYYY-MM-DD HH:mm:ss",U=g({__name:"notice-form-drawer",emits:["reloadList"],setup(g,{expose:U,emit:N}){const E=N,H=e(!1);function R(){H.value=!1}const M=e(),q=e(),z=e(),O={noticeId:void 0,noticeTypeId:void 0,title:void 0,categoryId:void 0,source:void 0,documentNumber:void 0,author:void 0,allVisibleFlag:1,visibleRangeList:[],scheduledPublishFlag:!1,publishTime:void 0,attachment:[],contentHtml:"",contentText:""},S=l({...O}),P={title:[{required:!0,message:"请输入"}],noticeTypeId:[{required:!0,message:"请选择分类"}],allVisibleFlag:[{required:!0,message:"请选择"}],source:[{required:!0,message:"请输入来源"}],author:[{required:!0,message:"请输入作者"}],contentHtml:[{required:!0,message:"请输入内容"}]};async function Y(){try{S.contentHtml=q.value.getHtml(),S.contentText=q.value.getText(),await M.value.validateFields(),async function(){try{w.show(),S.allVisibleFlag&&(S.visibleRangeList=[]),S.publishTime||(S.publishTime=y().format(L)),S.noticeId?await F.updateNotice(S):await F.addNotice(S),C.success("保存成功"),E("reloadList"),R()}catch(e){T.captureError(e)}finally{w.hide()}}()}catch(e){C.error("参数验证错误，请仔细填写表单数据!")}}const A=e([]);function D(){const e=S.visibleRangeList||[];z.value.showModal(e)}function J(e){S.visibleRangeList=e}const W=e(null);function B(e,l){S.publishTime=l}function G(e){W.value=e?y():null,S.publishTime=e?y().format(L):null}const K=e([]);function Q(e){K.value=e,S.attachment=b.isEmpty(e)?[]:e}return U({showModal:function(e){Object.assign(S,O),W.value=null,K.value=[],async function(){try{const e=await F.getAllNoticeTypeList();A.value=e.data,A.value.length>0&&!S.noticeId&&(S.noticeTypeId=A.value[0].noticeTypeId)}catch(e){T.captureError(e)}}(),e&&async function(e){try{w.show();const l=await F.getUpdateNoticeInfo(e),a=l.data.attachment;b.isEmpty(a)?K.value=[]:K.value=a,Object.assign(S,l.data),S.allVisibleFlag=S.allVisibleFlag?1:0,W.value=y(l.data.publishTime),H.value=!0}catch(l){T.captureError(l)}finally{w.hide()}}(e),H.value=!0,h((()=>{M.value.clearValidate()}))}}),(e,l)=>{const h=a("a-input"),b=a("a-form-item"),y=a("a-select-option"),g=a("a-select"),T=a("a-button"),w=a("close-outlined"),F=a("a-tag"),C=a("a-switch"),U=a("a-date-picker"),N=a("a-form"),E=a("a-space"),O=a("a-drawer");return i(),t(u,null,[o(O,{title:S.noticeId?"编辑":"新建",open:H.value,width:1e3,footerStyle:{textAlign:"right"},onClose:R,destroyOnClose:!0},{footer:s((()=>[o(E,null,{default:s((()=>[o(T,{onClick:R},{default:s((()=>[c("取消")])),_:1}),o(T,{type:"primary",onClick:Y},{default:s((()=>[c("保存")])),_:1})])),_:1})])),default:s((()=>[o(N,{ref_key:"formRef",ref:M,model:S,rules:P,"label-col":{span:3},"wrapper-col":{span:20}},{default:s((()=>[o(b,{label:"公告标题",name:"title"},{default:s((()=>[o(h,{value:S.title,"onUpdate:value":l[0]||(l[0]=e=>S.title=e),placeholder:"请输入公告标题"},null,8,["value"])])),_:1}),o(b,{label:"分类",name:"noticeTypeId"},{default:s((()=>[o(g,{value:S.noticeTypeId,"onUpdate:value":l[1]||(l[1]=e=>S.noticeTypeId=e),style:{width:"100%"},showSearch:!0,allowClear:!0},{default:s((()=>[(i(!0),t(u,null,r(A.value,(e=>(i(),d(y,{key:e.noticeTypeId,value:e.noticeTypeId},{default:s((()=>[c(m(e.noticeTypeName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),o(b,{label:"文号"},{default:s((()=>[o(h,{value:S.documentNumber,"onUpdate:value":l[2]||(l[2]=e=>S.documentNumber=e),placeholder:"文号，如：1024创新实验室发〔2022〕字第36号"},null,8,["value"])])),_:1}),o(b,{label:"作者",name:"author"},{default:s((()=>[o(h,{value:S.author,"onUpdate:value":l[3]||(l[3]=e=>S.author=e),placeholder:"请输入作者"},null,8,["value"])])),_:1}),o(b,{label:"来源",name:"source"},{default:s((()=>[o(h,{value:S.source,"onUpdate:value":l[4]||(l[4]=e=>S.source=e),placeholder:"请输入来源"},null,8,["value"])])),_:1}),o(b,{label:"可见范围",name:"allVisibleFlag"},{default:s((()=>[o(g,{value:S.allVisibleFlag,"onUpdate:value":l[5]||(l[5]=e=>S.allVisibleFlag=e),placeholder:"请选择可见范围"},{default:s((()=>[o(y,{value:1},{default:s((()=>[c("全部可见")])),_:1}),o(y,{value:0},{default:s((()=>[c("部分可见")])),_:1})])),_:1},8,["value"])])),_:1}),n(o(b,{label:"可见员工/部门"},{default:s((()=>[o(T,{type:"primary",onClick:D},{default:s((()=>[c("选择")])),_:1}),p("div",V,[(i(!0),t(u,null,r(S.visibleRangeList,((e,l)=>(i(),t("div",{class:"visible-item",key:e.dataId},[o(F,null,{default:s((()=>[p("span",null,m(e.dataName),1),o(w,{onClick:e=>function(e){x.confirm({title:"提示",content:"确定移除吗？",onOk(){S.visibleRangeList.splice(e,1)}})}(l)},null,8,["onClick"])])),_:2},1024)])))),128))])])),_:1},512),[[v,!S.allVisibleFlag]]),o(b,{label:"定时发布"},{default:s((()=>[o(C,{checked:S.scheduledPublishFlag,"onUpdate:checked":l[6]||(l[6]=e=>S.scheduledPublishFlag=e),"checked-children":"开","un-checked-children":"关",onChange:G},null,8,["checked"])])),_:1}),n(o(b,{label:"发布时间"},{default:s((()=>[o(U,{value:W.value,"onUpdate:value":l[7]||(l[7]=e=>W.value=e),format:L,showTime:"",allowClear:!1,placeholder:"请选择发布时间",style:{width:"200px"},onChange:B},null,8,["value"])])),_:1},512),[[v,S.scheduledPublishFlag]]),o(b,{label:"公告内容",name:"contentHtml"},{default:s((()=>[o(I,{ref_key:"contentRef",ref:q,modelValue:S.contentHtml,height:300},null,8,["modelValue"])])),_:1}),o(b,{label:"附件"},{default:s((()=>[o(j,{defaultFileList:K.value,maxUploadSize:10,folder:f(_).NOTICE.value,buttonText:"上传附件",listType:"text",extraMsg:"最多上传10个附件",onChange:Q},null,8,["defaultFileList","folder"])])),_:1})])),_:1},8,["model"])])),_:1},8,["title","open"]),o(k,{ref_key:"noticeFormVisibleModal",ref:z,onSelectedFinish:J},null,512)],64)}}},[["__scopeId","data-v-a68c0951"]]);export{U as default};
