import{j as e}from"./job-api-BuFufgo2.js";import{T as a,P as t,s as l,S as o}from"./index-ZxpkwSGJ.js";import{_ as i}from"./index-wy53HiSK.js";import{T as s}from"./table-id-const-CfofKxZg.js";import r from"./deleted-job-list-BIpYjin6.js";import n from"./job-form-modal-BBlTInEV.js";import d from"./job-log-list-modal-DdTjiuq2.js";import{b as u,M as c}from"./ant-design-vue-DFQN5xdf.js";import{r as p,a as m,e as g,b2 as b,z as y,b as f,o as j,c as h,bz as v,ai as k,F as x,b0 as _,ag as w,J as I,be as C,y as T,u as S,ah as z}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const J={class:"smart-table-setting-block smart-margin-bottom10"},E={key:0},F=k("div",null,"下次执行(预估时间)",-1),L={key:5,class:"smart-table-operate"},q={class:"smart-query-table-page"},O={__name:"job-list",setup(O){const U=p("1"),N=p([{title:"id",width:50,dataIndex:"jobId"},{title:"任务名称",dataIndex:"jobName",minWidth:150,ellipsis:!0},{title:"执行类",dataIndex:"jobClass",minWidth:180,ellipsis:!0},{title:"触发类型",dataIndex:"triggerType",width:110},{title:"触发配置",dataIndex:"triggerValue",width:150},{title:"上次执行",width:180,dataIndex:"lastJob"},{title:"下次执行",width:150,dataIndex:"nextJob"},{title:"启用状态",dataIndex:"enabledFlag",width:100},{title:"执行参数",dataIndex:"param",ellipsis:!0},{title:"任务描述",dataIndex:"remark",ellipsis:!0},{title:"排序",dataIndex:"sort",width:65},{title:"更新人",dataIndex:"updateName",width:90},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",dataIndex:"action",fixed:"right",width:170}]),D={searchWord:"",enabledFlag:null,triggerType:null,deletedFlag:!1,pageNum:1,pageSize:10},P=m({...D}),R=p(!1),M=p([]),W=p(0);function V(){Object.assign(P,D),$()}function K(){P.pageNum=1,$()}async function $(){try{R.value=!0;let a=await e.queryJob(P);const t=a.data.list;W.value=a.data.total,M.value=t}catch(a){l.captureError(a)}finally{R.value=!1}}async function A(a,t){t.enabledLoading=!0;try{let o={jobId:t.jobId,enabledFlag:a};await e.updateJobEnabled(o);let i=await async function(a){try{return(await e.queryJobInfo(a)).data}catch(t){l.captureError(t)}}(t.jobId);Object.assign(t,i),u.success("更新成功")}catch(o){t.enabledFlag=!a,l.captureError(o)}finally{t.enabledLoading=!1}}g($);const G=p();function Y(a,t){c.confirm({title:"警告",content:`确定要删除【${t}】任务吗?`,okText:"删除",okType:"danger",onOk(){!async function(a){try{o.show(),await e.deleteJob(a),u.success("删除成功!"),$()}catch(t){l.captureError(t)}finally{o.hide()}}(a)},cancelText:"取消",onCancel(){}})}const B=p();function Q(e){B.value.openUpdateModal(e)}return(e,l)=>{const o=b("a-input"),u=b("a-form-item"),c=b("a-select-option"),p=b("a-select"),m=b("SearchOutlined"),g=b("a-button"),O=b("ReloadOutlined"),D=b("a-button-group"),X=b("plus-outlined"),H=b("a-row"),Z=b("a-form"),ee=b("a-flex"),ae=b("a-tooltip"),te=b("a-tag"),le=b("CheckOutlined"),oe=b("WarningOutlined"),ie=b("a-switch"),se=b("a-table"),re=b("a-pagination"),ne=b("a-tab-pane"),de=b("a-tabs"),ue=b("a-card"),ce=y("privilege");return j(),f("div",null,[h(ue,{size:"small",bordered:!1,hoverable:!0},{default:v((()=>[h(de,{activeKey:U.value,"onUpdate:activeKey":l[7]||(l[7]=e=>U.value=e)},{default:v((()=>[h(ne,{key:"1",tab:"有效任务"},{default:v((()=>[h(Z,{class:"smart-query-form"},{default:v((()=>[h(H,{class:"smart-query-form-row"},{default:v((()=>[h(u,{label:"关键字",class:"smart-query-form-item"},{default:v((()=>[h(o,{style:{width:"200px"},value:P.searchWord,"onUpdate:value":l[0]||(l[0]=e=>P.searchWord=e),placeholder:"请输入关键字",maxlength:30},null,8,["value"])])),_:1}),h(u,{label:"触发类型",class:"smart-query-form-item"},{default:v((()=>[h(p,{style:{width:"155px"},value:P.triggerType,"onUpdate:value":l[1]||(l[1]=e=>P.triggerType=e),placeholder:"请选择触发类型",allowClear:""},{default:v((()=>[(j(!0),f(x,null,_(e.$smartEnumPlugin.getValueDescList("TRIGGER_TYPE_ENUM"),(e=>(j(),w(c,{key:e.value,value:e.value},{default:v((()=>[I(C(e.desc),1)])),_:2},1032,["value"])))),128))])),_:1},8,["value"])])),_:1}),h(u,{label:"状态",class:"smart-query-form-item"},{default:v((()=>[h(p,{style:{width:"150px"},value:P.enabledFlag,"onUpdate:value":l[2]||(l[2]=e=>P.enabledFlag=e),placeholder:"请选择状态",allowClear:""},{default:v((()=>[(j(),w(c,{key:1},{default:v((()=>[I(" 开启 ")])),_:1})),(j(),w(c,{key:0},{default:v((()=>[I(" 停止 ")])),_:1}))])),_:1},8,["value"])])),_:1}),h(u,{class:"smart-query-form-item smart-margin-left10"},{default:v((()=>[h(D,null,{default:v((()=>[T((j(),w(g,{type:"primary",onClick:K},{icon:v((()=>[h(m)])),default:v((()=>[I(" 查询 ")])),_:1})),[[ce,"support:job:query"]]),T((j(),w(g,{onClick:V},{icon:v((()=>[h(O)])),default:v((()=>[I(" 重置 ")])),_:1})),[[ce,"support:job:query"]])])),_:1}),T((j(),w(g,{class:"smart-margin-left20",type:"primary",onClick:l[3]||(l[3]=e=>Q())},{icon:v((()=>[h(X)])),default:v((()=>[I(" 添加任务 ")])),_:1})),[[ce,"support:job:add"]])])),_:1})])),_:1})])),_:1}),h(ee,{align:"end",vertical:""},{default:v((()=>[k("div",J,[h(i,{class:"smart-margin-bottom5 pull-right",modelValue:N.value,"onUpdate:modelValue":l[4]||(l[4]=e=>N.value=e),tableId:S(s).SUPPORT.JOB,refresh:$},null,8,["modelValue","tableId"])])])),_:1}),h(se,{scroll:{x:1800},size:"small",loading:R.value,bordered:"",dataSource:M.value,columns:N.value,rowKey:"jobId",pagination:!1},{bodyCell:v((({record:e,column:t})=>["jobClass"===t.dataIndex?(j(),w(ae,{key:0},{title:v((()=>[I(C(e.jobClass),1)])),default:v((()=>{return[I(" "+C((a=e.jobClass,a.split(".").pop())),1)];var a})),_:2},1024)):z("",!0),"triggerType"===t.dataIndex?(j(),f(x,{key:1},[e.triggerType===S(a).CRON.value?(j(),w(te,{key:0,color:"success"},{default:v((()=>[I(C(e.triggerTypeDesc),1)])),_:2},1024)):e.triggerType===S(a).FIXED_DELAY.value?(j(),w(te,{key:1,color:"processing"},{default:v((()=>[I(C(e.triggerTypeDesc),1)])),_:2},1024)):(j(),w(te,{key:2,color:"pink"},{default:v((()=>[I(C(e.triggerTypeDesc),1)])),_:2},1024))],64)):z("",!0),"lastJob"===t.dataIndex?(j(),f(x,{key:2},[e.lastJobLog?(j(),f("div",E,[h(ae,null,{title:v((()=>{return[I(C((a=e.lastJobLog.executeResult,a?a.substring(0,400)+(a.length>400?" ...":""):"")),1)];var a})),default:v((()=>[e.lastJobLog.successFlag?(j(),w(le,{key:0,style:{color:"#39c710"}})):(j(),w(oe,{key:1,style:{color:"#f50"}})),I(" "+C(e.lastJobLog.executeStartTime),1)])),_:2},1024)])):z("",!0)],64)):z("",!0),"nextJob"===t.dataIndex?(j(),f(x,{key:3},[e.enabledFlag&&e.nextJobExecuteTimeList?(j(),w(ae,{key:0},{title:v((()=>[F,(j(!0),f(x,null,_(e.nextJobExecuteTimeList,(e=>(j(),f("div",{key:e},C(e),1)))),128))])),default:v((()=>[I(" "+C(e.nextJobExecuteTimeList[0]),1)])),_:2},1024)):z("",!0)],64)):z("",!0),"enabledFlag"===t.dataIndex?(j(),w(ie,{key:4,checked:e.enabledFlag,"onUpdate:checked":a=>e.enabledFlag=a,"checked-children":"已启用","un-checked-children":"已禁用",onChange:a=>A(a,e),loading:e.enabledLoading},null,8,["checked","onUpdate:checked","onChange","loading"])):z("",!0),"action"===t.dataIndex?(j(),f("div",L,[T((j(),w(g,{onClick:a=>Q(e),type:"link"},{default:v((()=>[I("编辑")])),_:2},1032,["onClick"])),[[ce,"support:job:update"]]),T((j(),w(g,{type:"link",onClick:a=>function(e){B.value.openExecuteModal(e)}(e)},{default:v((()=>[I("执行")])),_:2},1032,["onClick"])),[[ce,"support:job:execute"]]),T((j(),w(g,{onClick:a=>{return t=e.jobId,l=e.jobName,void G.value.show(t,l);var t,l},type:"link"},{default:v((()=>[I("记录")])),_:2},1032,["onClick"])),[[ce,"support:job:log:query"]]),T((j(),w(g,{danger:"",onClick:a=>Y(e.jobId,e.jobName),type:"link"},{default:v((()=>[I("删除")])),_:2},1032,["onClick"])),[[ce,"support:job:log:delete"]])])):z("",!0)])),_:1},8,["loading","dataSource","columns"]),k("div",q,[h(re,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:S(t),defaultPageSize:P.pageSize,current:P.pageNum,"onUpdate:current":l[5]||(l[5]=e=>P.pageNum=e),pageSize:P.pageSize,"onUpdate:pageSize":l[6]||(l[6]=e=>P.pageSize=e),total:W.value,onChange:$,onShowSizeChange:$,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])])])),_:1}),h(ne,{key:"2",tab:"已删除任务"},{default:v((()=>[h(r)])),_:1})])),_:1},8,["activeKey"])])),_:1}),h(n,{ref_key:"jobFormModal",ref:B,onReloadList:$},null,512),h(d,{ref_key:"jobLogModal",ref:G},null,512)])}}};export{O as default};
