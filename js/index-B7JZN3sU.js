import{_ as e}from"./lodash-DJa03WnC.js";import{_ as a,z as t,c as l,d as o,P as i,h as n,s,S as r}from"./index-ZxpkwSGJ.js";import d from"./index-DnJ8FIYP.js";import p from"./index-CcsMhlr_.js";import c from"./index-BeKZG1Ep.js";import{_ as u}from"./index-wy53HiSK.js";import{T as m}from"./table-id-const-CfofKxZg.js";import{b as y,M as f}from"./ant-design-vue-DFQN5xdf.js";import{E as v}from"./@ant-design-rHMPkvPq.js";import{r as g,a as h,w as x,m as b,b2 as w,z as k,ag as I,o as j,bz as _,ai as C,c as N,J as z,y as E,u as S,b as F,ah as P,F as M,be as T,aY as O,aW as U,h as D}from"./@vue-wTDZSr7R.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";import"./role-api-w0pDqSQW.js";import"./index-YdqzJmk0.js";import"./department-api-BBQ_I4Vj.js";import"./index-DPBcXeae.js";import"./position-api-DEFSEgaB.js";import"./regular-const-BsnQI0fZ.js";import"./index-TGTmduvH.js";import"./department-mitt-CEUna344.js";import"./clipboard-W6UwraYJ.js";import"./sortablejs-CRp0PNdb.js";/* empty css                                                                                 */const $={class:"header"},L={class:"query-operate"},R={class:"btn-group"},B={class:"smart-table-column-operate"},q={key:2},V={key:3,class:"smart-table-operate"},A={class:"smart-query-table-page"},Y=(e=>(O("data-v-596902f6"),e=e(),U(),e))((()=>C("p",{style:{"margin-top":"5px",color:"#bfbfbf","font-size":"12px"}},"邀请码必须是4位数字",-1))),G=a({__name:"index",props:{departmentId:Number,breadcrumb:Array},setup(a){const O=t().administratorFlag,U=a;let G=g();function J(e,a){G.value.showModal(e,a)}const W=g([{title:"姓名",dataIndex:"actualName",width:85},{title:"性别",dataIndex:"gender",width:70},{title:"登录账号",dataIndex:"loginName",width:100},{title:"手机号",dataIndex:"phone",width:85},{title:"邮箱",dataIndex:"email",width:100,ellipsis:!0},{title:"超管",dataIndex:"administratorFlag",width:60},{title:"状态",dataIndex:"disabledFlag",width:60},{title:"职务",dataIndex:"positionName",width:100,ellipsis:!0},{title:"角色",dataIndex:"roleNameList",width:100},{title:"部门",dataIndex:"departmentName",ellipsis:!0,width:200},{title:"余额",dataIndex:"balance",width:120,customRender:({record:e})=>D("span",[D("span",void 0!==e.balance?e.balance:"--"),D("a",{style:"margin-left: 8px; color: #1890ff; cursor: pointer;",onClick:()=>function(e){if(!e?.employeeId)return void y.error("未找到员工ID，无法查询余额明细");const a={employeeId:e.employeeId,pageNum:1,pageSize:50};n.getBalanceLogs(a).then((a=>{const t=a.data?.list||[],l=Math.min(820,Math.round(.95*window.innerWidth));f.info({title:`余额明细 - ${e.actualName}`,width:l,centered:!0,okText:"知道了",content:D("div",{style:"text-align:left; max-height: 60vh; overflow-y: auto;"},[D("div",{style:"display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;"},[D("div",{style:"font-weight:600;"},"当前余额："),D("div",{style:"font-size:16px;color:#1890ff;font-weight:600;"},`￥${Number(e.balance??0).toFixed(2)}`)]),D("table",{class:"ant-table",style:"width:100%;margin-top:8px;border-collapse:collapse;font-size:12px;"},[D("thead",{},[D("tr",{},[D("th",{style:"padding:8px 12px;text-align:center;background:#fafafa;position:sticky;top:0;"},"时间"),D("th",{style:"padding:8px 12px;text-align:center;background:#fafafa;position:sticky;top:0;"},"类型"),D("th",{style:"padding:8px 12px;text-align:right;background:#fafafa;position:sticky;top:0;"},"变动金额"),D("th",{style:"padding:8px 12px;text-align:right;background:#fafafa;position:sticky;top:0;"},"变动后余额"),D("th",{style:"padding:8px 12px;text-align:left;background:#fafafa;position:sticky;top:0;"},"备注")])]),D("tbody",{},t.map(((e,a)=>{const t=Number(e.amount||0),l=Number(e.afterBalance||0);return D("tr",{style:`background:${a%2==1?"#fafafa":"#fff"};`},[D("td",{style:"padding:8px 12px;text-align:center;white-space:nowrap;"},e.createTime),D("td",{style:"padding:8px 12px;text-align:center;"},1===e.type?"充值":"消费"),D("td",{style:`padding:8px 12px;text-align:right;color:${t>=0?"#52c41a":"#cf1322"};font-weight:600;`},`${t>=0?"+":""}￥${Math.abs(t).toFixed(2)}`),D("td",{style:"padding:8px 12px;text-align:right;"},`￥${l.toFixed(2)}`),D("td",{style:"padding:8px 12px;text-align:left;max-width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"},e.remark||"")])})))])])})}))}(e)},"明细"),O&&D("a",{style:"margin-left: 8px; color: #52c41a; cursor: pointer;",onClick:()=>function(e){ve=e.employeeId,me.value="",ue.value=!0}(e)},"充值"),O&&D("a",{style:"margin-left: 8px; color: #ff4d4f; cursor: pointer;",onClick:()=>function(e){ve=e.employeeId,fe.value="",ye.value=!0}(e)},"扣除")])},{title:"邀请码",dataIndex:"inviteCode",width:120,customRender:({record:e})=>D("span",[D("span",e.inviteCode||"未设置"),O&&D("a",{style:"margin-left: 8px; color: #1890ff; cursor: pointer;",onClick:()=>function(e){xe=e.employeeId,he.value=e.inviteCode||"",ge.value=!0}(e)},"编辑")])},{title:"邀请权限",dataIndex:"invitePermission",width:120,customRender:({record:e})=>D("span",[D("a-tag",{color:e.invitePermission?"success":"default"},e.invitePermission?"已开启":"未开启"),D("a",{style:"margin-left: 8px; color: #1890ff; cursor: pointer;",onClick:()=>async function(e){try{await n.updateInvitePermission(e.employeeId,!e.invitePermission),y.success("权限更新成功"),ae()}catch(a){s.captureError(a)}}(e)},e.invitePermission?"关闭":"开启")])},{title:"操作",dataIndex:"operate",width:140}]),H=g();let K={departmentId:void 0,disabledFlag:!1,keyword:void 0,searchCount:void 0,pageNum:1,pageSize:l,sortItemList:void 0};const Q=h({...K}),X=g(0);function Z(){Object.assign(Q,K),ae()}const ee=g(!1);async function ae(){ee.value=!0;try{Q.departmentId=U.departmentId;let a=await n.queryEmployee(Q);for(const l of a.data.list)l.roleNameList=e.join(l.roleNameList,",");const t={};await Promise.all(a.data.list.map((async e=>{try{const a=await n.getBalance(e.employeeId);t[e.employeeId]=a.data?.balance??"--"}catch{t[e.employeeId]="--"}}))),a.data.list.forEach((e=>{e.balance=t[e.employeeId]})),H.value=a.data.list,X.value=a.data.total,le.value=[],oe.value=[]}catch(a){s.captureError(a)}finally{ee.value=!1}}async function te(a){ee.value=!0;try{Q.pageNum=1,Q.departmentId=a?void 0:U.departmentId;let t=await n.queryEmployee(Q);for(const a of t.data.list)a.roleNameList=e.join(a.roleNameList,",");const l={};await Promise.all(t.data.list.map((async e=>{try{const a=await n.getBalance(e.employeeId);l[e.employeeId]=a.data?.balance??"--"}catch{l[e.employeeId]="--"}}))),t.data.list.forEach((e=>{e.balance=l[e.employeeId]})),H.value=t.data.list,X.value=t.data.total,le.value=[],oe.value=[]}catch(t){s.captureError(t)}finally{ee.value=!1}}x((()=>U.departmentId),(()=>{U.departmentId!==Q.departmentId&&(Q.pageNum=1,ae())}),{immediate:!0});let le=g([]),oe=g([]);const ie=b((()=>le.value.length>0));function ne(e,a){le.value=e,oe.value=a}function se(){if(!ie.value)return void y.warning("请选择要删除的员工");const a=oe.value.map((e=>e.actualName)),t=oe.value.map((e=>e.employeeId));f.confirm({title:"确定要删除如下员工吗?",icon:N(v),content:e.join(a,","),okText:"删除",okType:"danger",async onOk(){r.show();try{await n.batchDeleteEmployee(t),y.success("删除成功"),ae(),le.value=[],oe.value=[]}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}})}const re=g();function de(){if(!ie.value)return void y.warning("请选择要调整部门的员工");const e=oe.value.map((e=>e.employeeId));re.value.showModal(e)}const pe=g();function ce(a){let t={};a?(t=e.cloneDeep(a),t.disabledFlag=t.disabledFlag?1:0):U.departmentId&&(t.departmentId=U.departmentId),pe.value.showDrawer(t)}const ue=g(!1),me=g(""),ye=g(!1),fe=g("");let ve=null;const ge=g(!1),he=g("");let xe=null;async function be(){!me.value||isNaN(me.value)||Number(me.value)<=0?y.error("请输入有效金额"):(await n.recharge(ve,me.value,"管理员充值"),y.success("充值成功"),ue.value=!1,ae())}async function we(){!fe.value||isNaN(fe.value)||Number(fe.value)<=0?y.error("请输入有效金额"):(await n.consume(ve,fe.value,"管理员扣除"),y.success("扣除成功"),ye.value=!1,ae())}async function ke(){const e=String(he.value||"").trim();if(/^\d{4}$/.test(e))try{await n.updateInviteCode(xe,e),y.success("邀请码更新成功"),ge.value=!1,he.value="",ae()}catch(a){s.captureError(a)}else y.error("邀请码必须是4位数字")}return(e,a)=>{const t=w("a-typography-title"),l=w("a-radio-button"),g=w("a-radio-group"),h=w("SearchOutlined"),x=w("a-button"),b=w("a-input-search"),O=w("ReloadOutlined"),U=w("a-tag"),D=w("a-table"),K=w("a-pagination"),oe=w("a-input"),ie=w("a-modal"),ve=w("a-form-item"),xe=w("a-card"),Ie=k("privilege");return j(),I(xe,{class:"employee-container"},{default:_((()=>[C("div",$,[N(t,{level:5},{default:_((()=>[z("部门人员")])),_:1}),C("div",L,[N(g,{value:Q.disabledFlag,"onUpdate:value":a[0]||(a[0]=e=>Q.disabledFlag=e),style:{margin:"8px","flex-shrink":"0"},onChange:a[1]||(a[1]=e=>te(!1))},{default:_((()=>[N(l,{value:void 0},{default:_((()=>[z("全部")])),_:1}),N(l,{value:!1},{default:_((()=>[z("启用")])),_:1}),N(l,{value:!0},{default:_((()=>[z("禁用")])),_:1})])),_:1},8,["value"]),N(b,{value:Q.keyword,"onUpdate:value":a[2]||(a[2]=e=>Q.keyword=e),valueModifiers:{trim:!0},placeholder:"姓名/手机号/登录账号",onSearch:a[3]||(a[3]=e=>te(!0))},{enterButton:_((()=>[N(x,{type:"primary"},{icon:_((()=>[N(h)])),default:_((()=>[z(" 查询 ")])),_:1})])),_:1},8,["value"]),N(x,{onClick:Z,class:"smart-margin-left10"},{icon:_((()=>[N(O)])),default:_((()=>[z(" 重置 ")])),_:1})])]),C("div",R,[E((j(),I(x,{class:"btn",type:"primary",onClick:ce},{default:_((()=>[z("添加成员")])),_:1})),[[Ie,"system:employee:add"]]),E((j(),I(x,{class:"btn",onClick:de},{default:_((()=>[z("调整部门")])),_:1})),[[Ie,"system:employee:department:update"]]),E((j(),I(x,{class:"btn",onClick:se},{default:_((()=>[z("批量删除")])),_:1})),[[Ie,"system:employee:delete"]]),C("span",B,[N(u,{modelValue:W.value,"onUpdate:modelValue":a[4]||(a[4]=e=>W.value=e),tableId:S(m).SYSTEM.EMPLOYEE,refresh:ae},null,8,["modelValue","tableId"])])]),N(D,{"row-selection":{selectedRowKeys:S(le),onChange:ne},size:"small",columns:W.value,"data-source":H.value,pagination:!1,loading:ee.value,scroll:{x:1500},"row-key":"employeeId",bordered:""},{bodyCell:_((({text:a,record:t,index:l,column:o})=>["administratorFlag"===o.dataIndex?(j(),F(M,{key:0},[a?(j(),I(U,{key:0,color:"error"},{default:_((()=>[z("超管")])),_:1})):P("",!0)],64)):P("",!0),"disabledFlag"===o.dataIndex?(j(),I(U,{key:1,color:a?"error":"processing"},{default:_((()=>[z(T(a?"禁用":"启用"),1)])),_:2},1032,["color"])):"gender"===o.dataIndex?(j(),F("span",q,T(e.$smartEnumPlugin.getDescByValue("GENDER_ENUM",a)),1)):"operate"===o.dataIndex?(j(),F("div",V,[E((j(),I(x,{type:"link",size:"small",onClick:e=>ce(t)},{default:_((()=>[z("编辑")])),_:2},1032,["onClick"])),[[Ie,"system:employee:update"]]),E((j(),I(x,{type:"link",size:"small",onClick:e=>{return a=t.employeeId,l=t.loginName,void f.confirm({title:"提醒",icon:N(v),content:"确定要重置密码吗?",okText:"确定",okType:"danger",async onOk(){r.show();try{let{data:e}=await n.resetPassword(a);y.success("重置成功"),G.value.showModal(l,e),ae()}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var a,l}},{default:_((()=>[z("重置密码")])),_:2},1032,["onClick"])),[[Ie,"system:employee:password:reset"]]),E((j(),I(x,{type:"link",onClick:e=>{return a=t.employeeId,l=t.disabledFlag,void f.confirm({title:"提醒",icon:N(v),content:`确定要${l?"启用":"禁用"}吗?`,okText:"确定",okType:"danger",async onOk(){r.show();try{await n.updateDisabled(a),y.success((l?"启用":"禁用")+"成功"),ae()}catch(e){s.captureError(e)}finally{r.hide()}},cancelText:"取消",onCancel(){}});var a,l}},{default:_((()=>[z(T(t.disabledFlag?"启用":"禁用"),1)])),_:2},1032,["onClick"])),[[Ie,"system:employee:disabled"]])])):P("",!0)])),_:1},8,["row-selection","columns","data-source","loading"]),C("div",A,[N(K,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:S(i),defaultPageSize:Q.pageSize,current:Q.pageNum,"onUpdate:current":a[5]||(a[5]=e=>Q.pageNum=e),pageSize:Q.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>Q.pageSize=e),total:X.value,onChange:ae,onShowSizeChange:ae,"show-total":S(o)},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])]),N(d,{ref_key:"employeeFormModal",ref:pe,onRefresh:ae,onShowAccount:J},null,512),N(p,{ref_key:"employeeDepartmentFormModal",ref:re,onRefresh:ae},null,512),N(c,{ref_key:"employeePasswordDialog",ref:G},null,512),N(ie,{open:ue.value,"onUpdate:open":a[8]||(a[8]=e=>ue.value=e),title:"充值",onOk:be,onCancel:a[9]||(a[9]=()=>{ue.value=!1})},{default:_((()=>[N(oe,{value:me.value,"onUpdate:value":a[7]||(a[7]=e=>me.value=e),placeholder:"请输入充值金额",type:"number"},null,8,["value"])])),_:1},8,["open"]),N(ie,{open:ye.value,"onUpdate:open":a[11]||(a[11]=e=>ye.value=e),title:"扣除",onOk:we,onCancel:a[12]||(a[12]=()=>{ye.value=!1})},{default:_((()=>[N(oe,{value:fe.value,"onUpdate:value":a[10]||(a[10]=e=>fe.value=e),placeholder:"请输入扣除金额",type:"number"},null,8,["value"])])),_:1},8,["open"]),N(ie,{open:ge.value,"onUpdate:open":a[14]||(a[14]=e=>ge.value=e),title:"编辑邀请码",onOk:ke,onCancel:a[15]||(a[15]=()=>{ge.value=!1,he.value=""})},{default:_((()=>[N(ve,{label:"邀请码",required:!0},{default:_((()=>[N(oe,{value:he.value,"onUpdate:value":a[13]||(a[13]=e=>he.value=e),placeholder:"请输入4位数字邀请码",maxlength:4},null,8,["value"]),Y])),_:1})])),_:1},8,["open"])])),_:1})}}},[["__scopeId","data-v-596902f6"]]);export{G as default};
