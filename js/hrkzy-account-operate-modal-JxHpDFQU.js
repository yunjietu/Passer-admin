import{h as e}from"./hrkzy-account-api-DYH7tamM.js";import{p as a,b as l,_ as t,s as d,S as o}from"./index-ZxpkwSGJ.js";import{b as n}from"./ant-design-vue-DFQN5xdf.js";import{r as s,a as i,n as u,m as r,w as c,e as p,b2 as y,ag as v,o as m,bz as f,c as g,u as h,ah as b,b as w,ai as _,J as x,F as k,be as N,aY as C,aW as D}from"./@vue-wTDZSr7R.js";
/*
 * 哈科职院账号单价管理
 *
 * @Author:    1024创新实验室
 * @Date:      2025-01-XX
 * @Wechat:    zhuda1024
 * @Email:     lab1024@163.com
 * @Copyright  1024创新实验室 （ https://1024lab.net ）,Since 2012
 */const A={getCurrentPrice:()=>l("/oa/hrkzy-account-price/get"),updatePrice:e=>a("/oa/hrkzy-account-price/update",e)},U={key:0,style:{"margin-top":"4px","font-size":"12px",color:"#666"}},E={style:{display:"flex","align-items":"center",gap:"12px"}},M={style:{"font-size":"12px",color:"#666"}},P={style:{color:"#1677ff","font-weight":"500"}},j={style:{"font-weight":"500",color:"#1677ff"}},z={style:{display:"flex","align-items":"center",gap:"12px"}},O={style:{"font-size":"12px",color:"#666"}},Y={style:{color:"#1677ff","font-weight":"500"}},I=(e=>(C("data-v-5bd081e0"),e=e(),D(),e))((()=>_("span",{class:"account-info-tip"}," 点击获取账号详细信息（可选，如不获取将自动获取） ",-1))),R={style:{display:"flex","align-items":"center",gap:"8px"}},S=360,T=t({__name:"hrkzy-account-operate-modal",emits:["refresh"],setup(a,{expose:l,emit:t}){l({showModal:function(a){Object.assign(K,F),le(),Q.value=[],a?async function(a){try{let l=(await e.detail(a)).data;Object.assign(K,l),K.billingMode=l.billingMode||"ACCOUNT",K.dayRemainingDays=l.dayRemainingDays??0,K.dayExtendDays=0,J.value=1===l.status}catch(l){d.captureError(l)}finally{o.hide()}}(a):J.value=!0;D.value=!0,u((()=>{const e=document.getElementsByClassName("ant-modal");e&&e.length>0&&Array.from(e).forEach((e=>{e.childNodes&&e.childNodes.length>0&&Array.from(e.childNodes).forEach((e=>{e.setAttribute&&e.setAttribute("aria-hidden","false")}))}))}))}});const C=t,D=s(!1);function T(){D.value=!1}const q=s(),F={id:void 0,account:void 0,password:void 0,name:void 0,companyName:void 0,positionName:void 0,address:void 0,longitude:void 0,latitude:void 0,planStudentId:void 0,status:1,billingMode:"ACCOUNT",dayCount:null,dayRemainingDays:0,dayExtendDays:0};let K=i({...F});const B={account:[{required:!0,message:"请输入账号"}],password:[{required:!0,message:"请输入密码"}],billingMode:[{required:!0,message:"请选择计费方式"}],dayCount:[{validator:(e,a)=>K.id||"DAY"!==K.billingMode?Promise.resolve():!a||a<=0?Promise.reject("请输入购买天数"):Promise.resolve(),trigger:"change"}],dayExtendDays:[{validator:(e,a)=>K.id&&"DAY"===K.billingMode?!a||a<=0?Promise.resolve():a>S?Promise.reject("追加天数不能超过360"):Promise.resolve():Promise.resolve(),trigger:"change"}]};function H(){q.value.validate().then((async()=>{o.show();try{K.id?await e.update(K):await e.create(K),n.success((K.id?"修改":"添加")+"成功"),T(),C("refresh")}catch(a){d.captureError(a)}finally{o.hide()}})).catch((e=>{}))}const J=s(!0);function L(e){K.status=e?1:0}const W=s(!1),G=s(!1),Q=s([]),V=s(null),X=s(!1);r((()=>"DAY"===K.billingMode));const Z=r((()=>null!==V.value&&Number(V.value)>0)),$=r((()=>te(K.dayCount))),ee=r((()=>te(K.dayExtendDays))),ae=r((()=>K.id?"详细信息（点击展开）":"详细信息（点击展开，如不填写将自动获取）"));async function le(){X.value=!0;try{const e=await A.getCurrentPrice();e&&e.data&&void 0!==e.data.dayPrice&&null!==e.data.dayPrice?V.value=Number(e.data.dayPrice):V.value=null}catch(e){V.value=null}finally{X.value=!1}}function te(e){if(!Z.value)return"";const a=Number(e);return!a||a<=0?"":(a*Number(V.value)).toFixed(2)}function de(e){const a=e.target.value;K.address=a.replace(/\s+/g,"")}async function oe(){if(K.address){W.value=!0;try{const a=K.address.replace(/\s+/g,""),l=await e.getLocationFromAddress({address:a});l.ok&&l.data?(K.longitude=l.data.longitude||"",K.latitude=l.data.latitude||"",n.success("获取经纬度成功")):n.error(l.msg||"获取经纬度失败，请手动输入")}catch(a){d.captureError(a),n.error("获取经纬度异常")}finally{W.value=!1}}else n.warning("请先输入工作地址")}async function ne(){if(K.account&&K.password){G.value=!0;try{const a=await e.getAccountInfo(K.account,K.password);a.ok&&a.data?(K.name=a.data.name||"",K.companyName=a.data.companyName||"",K.positionName=a.data.positionName||"",K.address=a.data.address||"",K.longitude=a.data.longitude||"",K.latitude=a.data.latitude||"",K.planStudentId=a.data.planStudentId||"",n.success("获取账号信息成功"),Q.value=["1"]):n.error(a.msg||"获取账号信息失败")}catch(a){d.captureError(a),n.error("获取账号信息异常")}finally{G.value=!1}}else n.warning("请先输入账号和密码")}return c((()=>K.billingMode),(e=>{"DAY"!==e&&(K.dayCount=null,K.dayExtendDays=0)})),p((()=>{le()})),(e,a)=>{const l=y("a-input"),t=y("a-form-item"),d=y("a-input-password"),o=y("a-radio"),n=y("a-radio-group"),s=y("a-input-number"),i=y("a-button"),u=y("a-collapse-panel"),r=y("a-collapse"),c=y("a-switch"),p=y("a-form"),C=y("a-modal");return m(),v(C,{open:D.value,title:h(K).id?"编辑":"添加",width:700,forceRender:"","ok-text":"确认","cancel-text":"取消",onOk:H,onCancel:T},{default:f((()=>[g(p,{ref_key:"formRef",ref:q,model:h(K),rules:B,"label-col":{span:5},"wrapper-col":{span:18}},{default:f((()=>[g(t,{label:"账号",name:"account"},{default:f((()=>[g(l,{value:h(K).account,"onUpdate:value":a[0]||(a[0]=e=>h(K).account=e),placeholder:"请输入学号",autocomplete:"username",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"密码",name:"password"},{default:f((()=>[g(d,{value:h(K).password,"onUpdate:value":a[1]||(a[1]=e=>h(K).password=e),placeholder:"请输入密码",autocomplete:"current-password",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"计费方式",name:"billingMode"},{default:f((()=>[_("div",null,[g(n,{value:h(K).billingMode,"onUpdate:value":a[2]||(a[2]=e=>h(K).billingMode=e),disabled:!!h(K).id},{default:f((()=>[g(o,{value:"ACCOUNT"},{default:f((()=>[x("单账号扣费")])),_:1}),g(o,{value:"DAY"},{default:f((()=>[x("单天扣费")])),_:1})])),_:1},8,["value","disabled"]),h(K).id?(m(),w("div",U," 编辑状态下无法修改计费方式，如需调整请新建账号 ")):b("",!0)])])),_:1}),h(K).id||"DAY"!==h(K).billingMode?b("",!0):(m(),v(t,{key:0,label:"购买天数",name:"dayCount"},{default:f((()=>[_("div",E,[g(s,{value:h(K).dayCount,"onUpdate:value":a[3]||(a[3]=e=>h(K).dayCount=e),min:1,max:S,precision:0,style:{width:"100px"}},null,8,["value"]),_("div",M,[X.value?(m(),w(k,{key:0},[x(" 单价加载中... ")],64)):Z.value?(m(),w(k,{key:1},[x(" 预计扣费："),_("span",P,N($.value||"--"),1),x(" 元 ")],64)):(m(),w(k,{key:2},[x(" 尚未配置单天单价 ")],64))])])])),_:1})),h(K).id&&"DAY"===h(K).billingMode?(m(),w(k,{key:1},[g(t,{label:"剩余天数"},{default:f((()=>[_("div",j,N(h(K).dayRemainingDays||0)+" 天 ",1)])),_:1}),g(t,{label:"追加天数",name:"dayExtendDays"},{default:f((()=>[_("div",z,[g(s,{value:h(K).dayExtendDays,"onUpdate:value":a[4]||(a[4]=e=>h(K).dayExtendDays=e),min:0,max:S,precision:0,placeholder:"输入追加天数",style:{width:"100px"}},null,8,["value"]),_("div",O,[X.value?(m(),w(k,{key:0},[x(" 单价加载中... ")],64)):Z.value?(m(),w(k,{key:1},[x(" 预计扣费："),_("span",Y,N(ee.value||"--"),1),x(" 元 ")],64)):(m(),w(k,{key:2},[x(" 尚未配置单天单价 ")],64))])])])),_:1})],64)):b("",!0),h(K).id?b("",!0):(m(),v(t,{key:2,"wrapper-col":{span:18,offset:3},style:{"margin-bottom":"8px"}},{default:f((()=>[g(i,{type:"primary",onClick:ne,loading:G.value,disabled:!h(K).account||!h(K).password},{default:f((()=>[x(" 获取账号信息 ")])),_:1},8,["loading","disabled"]),I])),_:1})),g(r,{activeKey:Q.value,"onUpdate:activeKey":a[11]||(a[11]=e=>Q.value=e),ghost:"",style:{"margin-top":"-8px"}},{default:f((()=>[g(u,{key:"1",header:ae.value},{default:f((()=>[g(t,{label:"工作地址",name:"address"},{default:f((()=>[_("div",R,[g(l,{value:h(K).address,"onUpdate:value":a[5]||(a[5]=e=>h(K).address=e),placeholder:"请输入工作地址",style:{width:"70%"},onInput:de},null,8,["value"]),g(i,{type:"primary",size:"small",onClick:oe,loading:W.value},{default:f((()=>[x("获取坐标")])),_:1},8,["loading"])])])),_:1}),g(t,{label:"经度",name:"longitude"},{default:f((()=>[g(l,{value:h(K).longitude,"onUpdate:value":a[6]||(a[6]=e=>h(K).longitude=e),placeholder:"请输入经度",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"纬度",name:"latitude"},{default:f((()=>[g(l,{value:h(K).latitude,"onUpdate:value":a[7]||(a[7]=e=>h(K).latitude=e),placeholder:"请输入纬度",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"姓名"},{default:f((()=>[g(l,{value:h(K).name,"onUpdate:value":a[8]||(a[8]=e=>h(K).name=e),placeholder:"请输入姓名",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"实习单位"},{default:f((()=>[g(l,{value:h(K).companyName,"onUpdate:value":a[9]||(a[9]=e=>h(K).companyName=e),placeholder:"请输入实习单位",style:{width:"70%"}},null,8,["value"])])),_:1}),g(t,{label:"职位名称"},{default:f((()=>[g(l,{value:h(K).positionName,"onUpdate:value":a[10]||(a[10]=e=>h(K).positionName=e),placeholder:"请输入职位名称",style:{width:"70%"}},null,8,["value"])])),_:1})])),_:1},8,["header"])])),_:1},8,["activeKey"]),g(t,{label:"启用状态",name:"status"},{default:f((()=>[g(c,{checked:J.value,"onUpdate:checked":a[12]||(a[12]=e=>J.value=e),onChange:L},null,8,["checked"])])),_:1})])),_:1},8,["model"])])),_:1},8,["open","title"])}}},[["__scopeId","data-v-5bd081e0"]]),q=Object.freeze(Object.defineProperty({__proto__:null,default:T},Symbol.toStringTag,{value:"Module"}));export{T as H,q as a,A as h};
