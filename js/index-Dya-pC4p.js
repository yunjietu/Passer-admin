import{m as e}from"./moguding-account-api-_EuqUysM.js";import{_ as a,c as t,P as l}from"./index-ZxpkwSGJ.js";import o from"./moguding-account-form-modal-nAbK6wLd.js";import i from"./moguding-clock-record-modal-C-eJQ7fO.js";import n from"./moguding-report-submit-modal-Cv6FW-Vy.js";import s from"./moguding-report-history-modal-D7bpCjJm.js";import{S as r,a5 as d,P as c,an as u,ao as p}from"./@ant-design-rHMPkvPq.js";import{b as m,M as y}from"./ant-design-vue-DFQN5xdf.js";import{r as g,a as k,e as f,b2 as h,z as v,b as w,o as x,ai as b,c as _,bz as j,J as C,u as z,y as S,ag as R,be as I,ah as P,F as E,aP as N,aR as U,h as D}from"./@vue-wTDZSr7R.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./dayjs-CSPdbndm.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./vue-DiME50Ru.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./@ctrl-B1U3vBhl.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const $={class:"smart-container"},M={class:"smart-container-body"},O={class:"smart-query-form"},T={class:"smart-query-table-container"},F={class:"smart-query-table-operation"},q={key:1,class:"permanent"},A={key:2,class:"no-data"},B={key:3,style:{display:"flex","flex-direction":"column",gap:"2px","align-items":"center"}},G={key:0,class:"success"},J={key:1,class:"failed"},L={key:2,class:"no-data"},Q={class:"smart-query-table-page"},H={__name:"index",setup(a){const H=g(),K=k({account:"",name:"",status:null,clockResult:null}),W=g([]),Y=g(!1),V=k({current:1,pageSize:t,total:0,showSizeChanger:!0,showQuickJumper:!0}),X=g("获取中..."),Z=[{title:"ID",dataIndex:"id",key:"id",width:70,align:"center"},{title:"账号",dataIndex:"account",key:"account",width:100},{title:"姓名",dataIndex:"name",key:"name",width:100},{title:"职位",dataIndex:"position",key:"position",width:150},{title:"公司名称",dataIndex:"companyName",key:"companyName",width:200,ellipsis:!0},{title:"公司地址",dataIndex:"companyAddress",key:"companyAddress",width:250,ellipsis:!0},{title:"状态",key:"status",width:80,align:"center"},{title:"剩余天数",dataIndex:"dayRemainingDays",key:"dayRemainingDays",width:110,align:"center"},{title:"报告开关",key:"reportSwitches",width:120,align:"center"},{title:"最后打卡时间",dataIndex:"lastClockTime",key:"lastClockTime",width:150,align:"center"},{title:"打卡结果",key:"clockResult",width:100,align:"center"},{title:"创建人",dataIndex:"createUserName",key:"createUserName",width:100,align:"center"},{title:"创建时间",dataIndex:"createTime",key:"createTime",width:150},{title:"操作",key:"action",width:460}],ee=async()=>{Y.value=!0;try{const a=await e.queryPage({...K,pageNum:V.current,pageSize:V.pageSize});W.value=a.data.list,V.total=a.data.total}catch(a){m.error("查询失败")}finally{Y.value=!1}},ae=()=>{H.value?.resetFields(),ee()},te=g(),le=()=>{te.value?.show()},oe=(a,t)=>{const l="SIGN_IN"===t?"签到":"签退";y.confirm({title:`确认${l}`,content:`确定要对"${a.name}"执行${l}操作吗？`,onOk:async()=>{try{await e.clock(a.id,t),m.success(`${l}成功`),ee()}catch(o){m.error(`${l}失败`)}}})},ie=g(),ne=g(),se=g();async function re(){try{const a=await e.getCurrentPrice();if(a.ok&&a.data){const e=a.data.price??0,t=a.data.dayPrice??0;X.value=`单天：${t} 元/天 | 单账号：${e} 元/账号`}else X.value="未设置"}catch(a){X.value="获取失败"}}async function de(){try{const a=await e.getCurrentPrice();let t=0,l=0,o="";a.ok&&a.data&&(t=a.data.price||0,l=a.data.dayPrice||0,o=a.data.remark||"");const i="accountPriceInput",n="dayPriceInput",s="remarkInput";y.confirm({title:"设置单价",content:D("div",[D("div",{style:"margin-bottom: 12px;"},[D("span","单天单价（元/天）："),D("input",{id:n,type:"number",min:"0",step:"0.01",value:l,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单天单价"})]),D("div",{style:"margin-bottom: 12px;"},[D("span","单账号单价（元/账号）："),D("input",{id:i,type:"number",min:"0",step:"0.01",value:t,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单价"})]),D("div",[D("span","备注："),D("input",{id:s,type:"text",value:o,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const a=document.getElementById(i),t=document.getElementById(n),l=document.getElementById(s),o=parseFloat(a?.value||0),r=parseFloat(t?.value||0),d=l?.value||"";return o<0||r<0?(m.error("单价不能为负数"),Promise.reject()):async function(a){try{const t=await e.updatePrice(a);if(t.ok)return m.success("单价设置成功"),void re();const l=t.msg||"未知错误";throw m.error("单价设置失败："+l),new Error(l)}catch(t){const e=t.response?.data?.msg||t.message||"单价设置失败";throw m.error("单价设置失败："+e),t}}({accountPrice:o,dayPrice:r,remark:d})}})}catch(a){m.error("获取单价配置失败")}}return f((()=>{ee(),re()})),(a,t)=>{const g=h("a-input"),k=h("a-form-item"),f=h("a-select-option"),D=h("a-select"),re=h("a-button"),ce=h("a-form"),ue=h("a-tag"),pe=h("a-space"),me=h("a-table"),ye=h("a-pagination"),ge=v("privilege");return x(),w("div",$,[b("div",M,[b("div",O,[_(ce,{ref_key:"queryFormRef",ref:H,model:K,layout:"inline"},{default:j((()=>[_(k,{label:"工学云账号",name:"account"},{default:j((()=>[_(g,{value:K.account,"onUpdate:value":t[0]||(t[0]=e=>K.account=e),placeholder:"请输入工学云账号",style:{width:"150px"}},null,8,["value"])])),_:1}),_(k,{label:"姓名",name:"name"},{default:j((()=>[_(g,{value:K.name,"onUpdate:value":t[1]||(t[1]=e=>K.name=e),placeholder:"请输入姓名",style:{width:"150px"}},null,8,["value"])])),_:1}),_(k,{label:"状态",name:"status"},{default:j((()=>[_(D,{value:K.status,"onUpdate:value":t[2]||(t[2]=e=>K.status=e),placeholder:"请选择状态",style:{width:"120px"},allowClear:""},{default:j((()=>[_(f,{value:1},{default:j((()=>[C("启用")])),_:1}),_(f,{value:0},{default:j((()=>[C("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),_(k,{label:"打卡结果",name:"clockResult"},{default:j((()=>[_(D,{value:K.clockResult,"onUpdate:value":t[3]||(t[3]=e=>K.clockResult=e),placeholder:"请选择打卡结果",style:{width:"120px"},allowClear:""},{default:j((()=>[_(f,{value:"SUCCESS"},{default:j((()=>[C("成功")])),_:1}),_(f,{value:"FAILED"},{default:j((()=>[C("失败")])),_:1}),_(f,{value:"NO_CLOCK"},{default:j((()=>[C("未打卡")])),_:1})])),_:1},8,["value"])])),_:1}),_(k,null,{default:j((()=>[_(re,{type:"primary",onClick:ee},{icon:j((()=>[_(z(r))])),default:j((()=>[C(" 查询 ")])),_:1}),_(re,{onClick:ae,style:{"margin-left":"10px"}},{icon:j((()=>[_(z(d))])),default:j((()=>[C(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])]),b("div",T,[b("div",F,[_(pe,{wrap:""},{default:j((()=>[S((x(),R(re,{type:"primary",onClick:le},{icon:j((()=>[_(z(c))])),default:j((()=>[C(" 新建账号 ")])),_:1})),[[ge,"oa:moguding-account:add"]]),S((x(),R(re,{onClick:t[4]||(t[4]=e=>de()),type:"default"},{icon:j((()=>[_(z(u))])),default:j((()=>[C(" 设置单价 ")])),_:1})),[[ge,"oa:moguding-account:price:update"]]),_(ue,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:j((()=>[_(z(p))])),default:j((()=>[C(" 当前单价: "+I(X.value),1)])),_:1})])),_:1})]),_(me,{columns:Z,"data-source":W.value,loading:Y.value,pagination:!1,bordered:"",size:"small",scroll:{x:2e3}},{bodyCell:j((({column:a,record:t,index:l})=>["index"===a.key?(x(),w(E,{key:0},[C(I(l+1),1)],64)):"status"===a.key?(x(),w("span",{key:1,class:N(1===t.status?"enabled":"disabled")},I(1===t.status?"启用":"禁用"),3)):"dayRemainingDays"===a.key?(x(),w(E,{key:2},["DAY"===t.billingMode?(x(),w("span",{key:0,style:U({color:(t.dayRemainingDays??0)>0?"#1677ff":"#ff4d4f",fontWeight:500})},I("number"==typeof t.dayRemainingDays?`${t.dayRemainingDays} 天`:"--"),5)):"ACCOUNT"===t.billingMode?(x(),w("span",q,"永久")):(x(),w("span",A,"--"))],64)):"reportSwitches"===a.key?(x(),w("div",B,[t.dailyReportEnabled?(x(),R(ue,{key:0,color:"blue",size:"small"},{default:j((()=>[C(" 日报✓ ")])),_:1})):P("",!0),t.weeklyReportEnabled?(x(),R(ue,{key:1,color:"green",size:"small"},{default:j((()=>[C(" 周报✓ ")])),_:1})):P("",!0),t.monthlyReportEnabled?(x(),R(ue,{key:2,color:"orange",size:"small"},{default:j((()=>[C(" 月报✓ ")])),_:1})):P("",!0),t.dailyReportEnabled||t.weeklyReportEnabled||t.monthlyReportEnabled?P("",!0):(x(),R(ue,{key:3,color:"default",size:"small"},{default:j((()=>[C(" 未开启 ")])),_:1}))])):"clockResult"===a.key?(x(),w(E,{key:4},["SUCCESS"===t.clockResult?(x(),w("span",G,"成功")):"FAILED"===t.clockResult?(x(),w("span",J,"失败")):(x(),w("span",L,"未打卡"))],64)):"action"===a.key?(x(),R(pe,{key:5},{default:j((()=>[S((x(),R(re,{type:"link",size:"small",onClick:e=>(e=>{te.value?.show(e)})(t)},{default:j((()=>[C(" 编辑 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:update"]]),S((x(),R(re,{type:"link",size:"small",onClick:e=>oe(t,"SIGN_IN")},{default:j((()=>[C(" 签到 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:clock"]]),S((x(),R(re,{type:"link",size:"small",onClick:e=>oe(t,"SIGN_OUT")},{default:j((()=>[C(" 签退 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:clock"]]),S((x(),R(re,{type:"link",size:"small",onClick:e=>(e=>{ie.value?.showModal(e.id,e.name,e)})(t)},{default:j((()=>[C(" 打卡记录 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:clock-records"]]),S((x(),R(re,{type:"link",size:"small",onClick:e=>(e=>{ne.value?.show(e)})(t)},{default:j((()=>[C(" 提交报告 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:report"]]),S((x(),R(re,{type:"link",size:"small",onClick:e=>(e=>{se.value?.showModal(e.id,e.name,e)})(t)},{default:j((()=>[C(" 报告历史 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:report"]]),S((x(),R(re,{type:"link",size:"small",danger:"",onClick:a=>(a=>{y.confirm({title:"确认删除",content:`确定要删除"${a.name}"吗？`,onOk:async()=>{try{await e.delete(a.id),m.success("删除成功"),ee()}catch(t){m.error("删除失败")}}})})(t)},{default:j((()=>[C(" 删除 ")])),_:2},1032,["onClick"])),[[ge,"oa:moguding-account:delete"]])])),_:2},1024)):P("",!0)])),_:1},8,["data-source","loading"]),b("div",Q,[_(ye,{showSizeChanger:"",showQuickJumper:"","show-less-items":"",pageSizeOptions:z(l),defaultPageSize:V.pageSize,current:V.current,"onUpdate:current":t[5]||(t[5]=e=>V.current=e),pageSize:V.pageSize,"onUpdate:pageSize":t[6]||(t[6]=e=>V.pageSize=e),total:V.total,onChange:ee,onShowSizeChange:ee,"show-total":e=>`共${e}条`},null,8,["pageSizeOptions","defaultPageSize","current","pageSize","total","show-total"])])])]),_(o,{ref_key:"formModalRef",ref:te,onSuccess:ee},null,512),_(i,{ref_key:"clockRecordModalRef",ref:ie},null,512),_(n,{ref_key:"reportSubmitModalRef",ref:ne,onSuccess:ee},null,512),_(s,{ref_key:"reportHistoryModalRef",ref:se},null,512)])}}},K=a(H,[["__scopeId","data-v-992c2cb1"]]);export{K as default};
