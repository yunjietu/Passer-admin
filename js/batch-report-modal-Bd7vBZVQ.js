import{a as e}from"./account-api-Ia2S-UTU.js";import{d as a}from"./dayjs-CSPdbndm.js";import{_ as r}from"./index-ZxpkwSGJ.js";import{b as t}from"./ant-design-vue-DFQN5xdf.js";import{r as o,a as l,b2 as s,ag as u,o as n,bz as i,ai as p,c as d,J as c,be as m,b as v}from"./@vue-wTDZSr7R.js";import"./@ant-design-rHMPkvPq.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const f={class:"batch-report-form"},y={class:"account-info"},j={key:1,style:{color:"#999"}},h=r({__name:"batch-report-modal",emits:["refresh"],setup(r,{expose:h,emit:b}){const g=o(!1),_=o(!1),w=o({}),T=o([]),Y=l({reportType:"day"}),k=e=>e&&e>a().endOf("day"),D=()=>{if(!T.value||2!==T.value.length)return 0;const e=T.value[0];return T.value[1].diff(e,"day")+1},M=()=>{if(!T.value||2!==T.value.length)return 0;const e=T.value[0],a=T.value[1];return Math.ceil(a.diff(e,"day")/7)+1},$=()=>{if(!T.value||2!==T.value.length)return 0;const e=T.value[0];return T.value[1].diff(e,"month")+1},x=()=>{switch(Y.reportType){case"day":return"预计天数";case"week":return"预计周数";case"month":return"预计月数";default:return"预计数量"}},z=()=>{if(!T.value||2!==T.value.length)return"请选择日期范围";switch(Y.reportType){case"day":return`共 ${D()} 天`;case"week":return`共 ${M()} 周`;case"month":return`共 ${$()} 月`;default:return"请选择报告类型"}},C=e=>{Y.reportType=e},U=async()=>{if(!Y.reportType)return void t.error("请选择报告类型");if(!T.value||2!==T.value.length)return void t.error("请选择补报告日期范围");const a=T.value[0],r=T.value[1];if(a.isAfter(r))t.error("开始日期不能晚于结束日期");else try{_.value=!0;const o={accountId:w.value.id,startDate:a.format("YYYY-MM-DD"),endDate:r.format("YYYY-MM-DD"),reportType:Y.reportType};await e.batchReport(o);const l="day"===Y.reportType?"日报":"week"===Y.reportType?"周报":"月报",s="day"===Y.reportType?`${D()} 天`:"week"===Y.reportType?`${M()} 周`:`${$()} 月`;t.success(`补${l}任务已提交，共 ${s}，正在后台处理中，请稍后在报告历史中查看结果`),q(),I("refresh")}catch(o){t.error("补报告失败，请重试")}finally{_.value=!1}},q=()=>{g.value=!1,T.value=[],Y.reportType="day",w.value={}},I=b;return h({showModal:e=>{e?(w.value={id:e.id,name:e.name,account:e.account},T.value=[],Y.reportType="day",g.value=!0):t.error("账号信息不能为空")}}),(e,a)=>{const r=s("a-tag"),t=s("a-form-item"),o=s("a-select-option"),l=s("a-select"),h=s("a-range-picker"),b=s("a-form"),D=s("a-modal");return n(),u(D,{open:g.value,"onUpdate:open":a[2]||(a[2]=e=>g.value=e),title:"补报告",width:600,onOk:U,onCancel:q,confirmLoading:_.value},{default:i((()=>[p("div",f,[d(b,{model:Y,"label-col":{span:6},"wrapper-col":{span:18}},{default:i((()=>[d(t,{label:"账号信息"},{default:i((()=>[p("div",y,[d(r,{color:"blue"},{default:i((()=>[c(m(w.value.name),1)])),_:1}),d(r,{color:"green"},{default:i((()=>[c(m(w.value.account),1)])),_:1})])])),_:1}),d(t,{label:"报告类型",required:""},{default:i((()=>[d(l,{value:Y.reportType,"onUpdate:value":a[0]||(a[0]=e=>Y.reportType=e),placeholder:"请选择报告类型",style:{width:"100%"},onChange:C},{default:i((()=>[d(o,{value:"day"},{default:i((()=>[c("日报")])),_:1}),d(o,{value:"week"},{default:i((()=>[c("周报")])),_:1}),d(o,{value:"month"},{default:i((()=>[c("月报")])),_:1})])),_:1},8,["value"])])),_:1}),d(t,{label:"补报告日期",required:""},{default:i((()=>[d(h,{value:T.value,"onUpdate:value":a[1]||(a[1]=e=>T.value=e),"disabled-date":k,format:"YYYY-MM-DD",style:{width:"100%"},placeholder:["开始日期","结束日期"]},null,8,["value"])])),_:1}),d(t,{label:x()},{default:i((()=>[T.value&&2===T.value.length?(n(),u(r,{key:0,color:"orange"},{default:i((()=>[c(m(z()),1)])),_:1})):(n(),v("span",j,"请选择日期范围"))])),_:1},8,["label"])])),_:1},8,["model"])])])),_:1},8,["open","confirmLoading"])}}},[["__scopeId","data-v-2c4134d9"]]);export{h as default};
