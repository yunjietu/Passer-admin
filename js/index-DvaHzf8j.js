import{j as e}from"./jwxt-account-api-qQmGFGXi.js";import a from"./account-form-modal-CSLnBbmX.js";import t from"./signin-record-modal-BhM79u0F.js";import{d as l}from"./dayjs-CSPdbndm.js";import{_ as i,c as n,S as s}from"./index-ZxpkwSGJ.js";import{S as o,a5 as r,P as d,an as u,ao as c}from"./@ant-design-rHMPkvPq.js";import{b as p,M as m}from"./ant-design-vue-DFQN5xdf.js";import{r as y,a as g,e as f,b2 as v,z as k,b as h,o as x,ai as w,c as b,bz as j,J as _,u as C,y as I,ag as S,be as N,ah as z,F as R,aR as P,h as D}from"./@vue-wTDZSr7R.js";import"./vue-DiME50Ru.js";import"./@ctrl-B1U3vBhl.js";import"./lodash-DJa03WnC.js";import"./vue3-json-viewer-BcgvkQJY.js";import"./vue-i18n-DNlNJnDH.js";import"./@intlify-BXJl0ReV.js";import"./pinia-BY_IhmGU.js";import"./axios-BlN9Xwzv.js";import"./crypto-js-VShT-BxW.js";import"./sm-crypto-BtLvRUKc.js";import"./jsbn-qAKIvbVZ.js";import"./nprogress-DmlD4NmX.js";import"./vue-router-BJIyZwNj.js";import"./mitt-CNZ6avp8.js";import"./@babel-rSvM8Ko2.js";import"./resize-observer-polyfill-OVnto9HH.js";import"./@emotion-COtJ1lvC.js";import"./stylis-Bzr8AwGH.js";import"./vue-types-BvQfMnDx.js";import"./dom-align-CCb293uS.js";import"./lodash-es-DiERF9Dp.js";import"./async-validator-BTKOuuO-.js";import"./throttle-debounce-w9OM8Bxz.js";const F={class:"smart-container"},T={class:"smart-container-body"},E={class:"smart-query-form"},U={class:"smart-query-table-container"},q={class:"smart-query-table-operation"},A={key:1,class:"permanent"},M={key:2,class:"no-data"},Y={key:0},$={key:1,style:{color:"#999"}},B={key:3,style:{color:"#999"}},O={class:"smart-query-table-page"},G={__name:"index",setup(i){const G=y(),H=g({userCode:"",userName:"",signinResult:null,disabledFlag:void 0,pageNum:1,pageSize:n}),J=y([]),L=y(0),Q=y(!1),W=y("加载中..."),K=y(null),V=y(null),X=[{title:"ID",dataIndex:"id",key:"id",width:70,align:"center"},{title:"学号",dataIndex:"userCode",width:120},{title:"学生姓名",dataIndex:"userName",width:100},{title:"学院",dataIndex:"departName",width:150,ellipsis:!0},{title:"学期ID",dataIndex:"semesterId",width:80,align:"center"},{title:"实习地址",dataIndex:"practiceAddr",width:200,ellipsis:!0},{title:"最后签到",key:"lastSigninTime",width:150,align:"center"},{title:"签到结果",key:"signinResult",width:100,align:"center"},{title:"状态",key:"disabledFlag",width:80,align:"center"},{title:"剩余天数",key:"dayRemainingDays",width:110,align:"center"},{title:"创建人",dataIndex:"createUserName",width:100},{title:"创建时间",dataIndex:"createTime",width:150},{title:"操作",key:"action",width:290}];async function Z(){try{Q.value=!0;const a=await e.queryByPage(H);J.value=a.data.list||[],L.value=a.data.total||0}catch(a){p.error("查询失败")}finally{Q.value=!1}}function ee(){G.value?.resetFields(),H.pageNum=1,H.pageSize=n,Z()}const ae=y();function te(){ae.value?.show()}const le=y();async function ie(){try{const a=await e.getCurrentPrice();if(a.ok&&a.data){K.value=a.data.price??null,V.value=a.data.dayPrice??null;const e=null!==K.value?K.value:"--",t=null!==V.value?V.value:"--";W.value=`单天：${t} 元/天 | 单账号：${e} 元`}else W.value="未设置",K.value=null,V.value=null}catch(a){W.value="获取失败",K.value=null,V.value=null}}async function ne(){try{const a=await e.getCurrentPrice();let t=K.value??0,l=V.value??0,i="";a.ok&&a.data&&(t=a.data.price??t,l=a.data.dayPrice??l,i=a.data.remark||""),m.confirm({title:"设置单价",content:D("div",[D("div",{style:"margin-bottom: 12px;"},[D("span","单天单价（元/天）："),D("input",{id:"dayPriceInput",type:"number",min:"0",step:"0.01",value:l,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单天单价"})]),D("div",{style:"margin-bottom: 12px;"},[D("span","单账号单价（元）："),D("input",{id:"accountPriceInput",type:"number",min:"0",step:"0.01",value:t,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入单账号单价"})]),D("div",[D("span","备注："),D("input",{id:"remarkInput",type:"text",value:i,style:"width: 100%; padding: 4px 8px; margin-top: 4px; border: 1px solid #d9d9d9; border-radius: 4px;",placeholder:"请输入备注（可选）"})])]),okText:"确定",cancelText:"取消",onOk(){const a=document.getElementById("accountPriceInput"),t=document.getElementById("dayPriceInput"),l=document.getElementById("remarkInput"),i=parseFloat(a?.value??"0"),n=parseFloat(t?.value??"0"),o=l?.value||"";return Number.isNaN(i)||i<0?(p.error("单账号单价不能为负数"),Promise.reject()):Number.isNaN(n)||n<0?(p.error("单天单价不能为负数"),Promise.reject()):async function(a){try{s.show();const t=await e.updatePrice(a);t.ok?(p.success("单价设置成功"),ie()):p.error("单价设置失败："+(t.msg||"未知错误"))}catch(t){p.error("单价设置失败："+(t.response?.data?.msg||t.message))}finally{s.hide()}}({accountPrice:i,dayPrice:n,remark:o})}})}catch(a){p.error("获取单价配置失败")}}return f((()=>{Z(),ie()})),(i,n)=>{const s=v("a-input"),y=v("a-form-item"),g=v("a-select-option"),f=v("a-select"),D=v("a-button"),K=v("a-form"),V=v("a-tag"),ie=v("a-space"),se=v("a-table"),oe=v("a-pagination"),re=k("privilege");return x(),h("div",F,[w("div",T,[w("div",E,[b(K,{ref_key:"queryFormRef",ref:G,model:H,layout:"inline"},{default:j((()=>[b(y,{label:"学号",name:"userCode"},{default:j((()=>[b(s,{id:"jwxt-query-user-code",value:H.userCode,"onUpdate:value":n[0]||(n[0]=e=>H.userCode=e),placeholder:"请输入学号",style:{width:"150px"}},null,8,["value"])])),_:1}),b(y,{label:"学生姓名",name:"userName"},{default:j((()=>[b(s,{value:H.userName,"onUpdate:value":n[1]||(n[1]=e=>H.userName=e),placeholder:"请输入学生姓名",style:{width:"150px"}},null,8,["value"])])),_:1}),b(y,{label:"状态",name:"disabledFlag"},{default:j((()=>[b(f,{value:H.disabledFlag,"onUpdate:value":n[2]||(n[2]=e=>H.disabledFlag=e),placeholder:"请选择状态",style:{width:"120px"},allowClear:""},{default:j((()=>[b(g,{value:!1},{default:j((()=>[_("启用")])),_:1}),b(g,{value:!0},{default:j((()=>[_("禁用")])),_:1})])),_:1},8,["value"])])),_:1}),b(y,{label:"签到结果",name:"signinResult"},{default:j((()=>[b(f,{value:H.signinResult,"onUpdate:value":n[3]||(n[3]=e=>H.signinResult=e),placeholder:"请选择签到结果",style:{width:"120px"},allowClear:""},{default:j((()=>[b(g,{value:"SUCCESS"},{default:j((()=>[_("成功")])),_:1}),b(g,{value:"FAILED"},{default:j((()=>[_("失败")])),_:1}),b(g,{value:"PENDING"},{default:j((()=>[_("待签到")])),_:1})])),_:1},8,["value"])])),_:1}),b(y,null,{default:j((()=>[b(D,{type:"primary",onClick:Z},{icon:j((()=>[b(C(o))])),default:j((()=>[_(" 查询 ")])),_:1}),b(D,{onClick:ee,style:{"margin-left":"10px"}},{icon:j((()=>[b(C(r))])),default:j((()=>[_(" 重置 ")])),_:1})])),_:1})])),_:1},8,["model"])]),w("div",U,[w("div",q,[b(ie,{wrap:""},{default:j((()=>[I((x(),S(D,{type:"primary",onClick:te},{icon:j((()=>[b(C(d))])),default:j((()=>[_(" 新建账号 ")])),_:1})),[[re,"oa:jwxt-account:add"]]),I((x(),S(D,{onClick:n[4]||(n[4]=e=>ne()),type:"default"},{icon:j((()=>[b(C(u))])),default:j((()=>[_(" 设置单价 ")])),_:1})),[[re,"oa:jwxt-account:price:update"]]),b(V,{color:"blue",style:{"margin-left":"8px","font-size":"14px",padding:"4px 12px"}},{icon:j((()=>[b(C(c))])),default:j((()=>[_(" 当前单价："+N(W.value),1)])),_:1})])),_:1})]),b(se,{columns:X,"data-source":J.value,loading:Q.value,pagination:!1,bordered:"",size:"small",scroll:{x:1900}},{bodyCell:j((({column:a,record:t,index:i})=>["index"===a.key?(x(),h(R,{key:0},[_(N(i+1),1)],64)):"disabledFlag"===a.key?(x(),S(V,{key:1,color:t.disabledFlag?"red":"green"},{default:j((()=>[_(N(t.disabledFlag?"禁用":"启用"),1)])),_:2},1032,["color"])):"dayRemainingDays"===a.key?(x(),h(R,{key:2},["DAY"===t.billingMode?(x(),h("span",{key:0,style:P({color:(t.dayRemainingDays??0)>0?"#1677ff":"#ff4d4f",fontWeight:500})},N("number"==typeof t.dayRemainingDays?`${t.dayRemainingDays} 天`:"--"),5)):"ACCOUNT"===t.billingMode?(x(),h("span",A,"永久")):(x(),h("span",M,"--"))],64)):"lastSigninTime"===a.key?(x(),h(R,{key:3},[t.lastSigninTime?(x(),h("span",Y,N(C(l)(t.lastSigninTime).format("YYYY-MM-DD HH:mm:ss")),1)):(x(),h("span",$,"-"))],64)):"signinResult"===a.key?(x(),h(R,{key:4},["SUCCESS"===t.signinResult?(x(),S(V,{key:0,color:"green"},{default:j((()=>[_("✓ 已签到")])),_:1})):"FAILED"===t.signinResult?(x(),S(V,{key:1,color:"red"},{default:j((()=>[_("✗ 失败")])),_:1})):"PENDING"===t.signinResult?(x(),S(V,{key:2,color:"blue"},{default:j((()=>[_("⏳ 待签到")])),_:1})):(x(),h("span",B,"-"))],64)):"action"===a.key?(x(),S(ie,{key:5},{default:j((()=>[I((x(),S(D,{type:"link",size:"small",onClick:a=>async function(a){try{const t=await e.getDetail(a.id);t.data?ae.value?.show(t.data):p.error("获取账号详情失败")}catch(t){p.error("获取账号详情失败")}}(t)},{default:j((()=>[_(" 编辑 ")])),_:2},1032,["onClick"])),[[re,"oa:jwxt-account:update"]]),I((x(),S(D,{type:"link",size:"small",onClick:a=>async function(a){try{const t=await e.manualSignin({jwxtAccountId:a.id,withImage:0});p.success("签到操作完成："+t.data),Z()}catch(t){Z()}}(t)},{default:j((()=>[_(" 签到 ")])),_:2},1032,["onClick"])),[[re,"oa:jwxt-account:signin"]]),I((x(),S(D,{type:"link",size:"small",onClick:e=>function(e){le.value?.show(e)}(t)},{default:j((()=>[_(" 签到记录 ")])),_:2},1032,["onClick"])),[[re,"oa:jwxt-account:signin-records"]]),I((x(),S(D,{type:"link",size:"small",danger:"",onClick:a=>function(a){m.confirm({title:"提示",content:`确定要删除学号为"${a.userCode}"的账号吗？`,okText:"删除",okType:"danger",async onOk(){try{await e.deleteAccount(a.id),p.success("删除成功"),Z()}catch(t){p.error("删除失败")}}})}(t)},{default:j((()=>[_(" 删除 ")])),_:2},1032,["onClick"])),[[re,"oa:jwxt-account:delete"]])])),_:2},1024)):z("",!0)])),_:1},8,["data-source","loading"]),w("div",O,[b(oe,{showSizeChanger:"",showQuickJumper:"","show-total":"",current:H.pageNum,"onUpdate:current":n[5]||(n[5]=e=>H.pageNum=e),pageSize:H.pageSize,"onUpdate:pageSize":n[6]||(n[6]=e=>H.pageSize=e),total:L.value,onChange:Z,onShowSizeChange:Z,showTotal:e=>`共${e}条`},null,8,["current","pageSize","total","showTotal"])])])]),b(a,{ref_key:"accountFormModalRef",ref:ae,onSuccess:Z},null,512),b(t,{ref_key:"signinRecordModalRef",ref:le},null,512)])}}},H=i(G,[["__scopeId","data-v-65212045"]]);export{H as default};
